{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"lodash\"","webpack:///./datasource-zabbix/constants.ts","webpack:///./datasource-zabbix/utils.ts","webpack:///external \"@grafana/data\"","webpack:///external \"@grafana/ui\"","webpack:///external \"@emotion/css\"","webpack:///./datasource-zabbix/types.ts","webpack:///external \"@grafana/runtime\"","webpack:///external \"moment\"","webpack:///../node_modules/semver/classes/semver.js","webpack:///./panel-triggers/utils.ts","webpack:///external \"app/core/utils/datemath\"","webpack:///external \"jquery\"","webpack:///../node_modules/semver/functions/compare.js","webpack:///../node_modules/semver/classes/range.js","webpack:///external \"app/plugins/sdk\"","webpack:///./panel-triggers/migrations.ts","webpack:///../node_modules/semver/internal/re.js","webpack:///../node_modules/semver/functions/parse.js","webpack:///../node_modules/semver/index.js","webpack:///../node_modules/semver/internal/constants.js","webpack:///../node_modules/semver/internal/debug.js","webpack:///../node_modules/semver/internal/parse-options.js","webpack:///../node_modules/semver/functions/gt.js","webpack:///../node_modules/semver/classes/comparator.js","webpack:///../node_modules/semver/functions/satisfies.js","webpack:///external \"app/core/core_module\"","webpack:///../node_modules/semver/internal/identifiers.js","webpack:///../node_modules/semver/functions/eq.js","webpack:///../node_modules/semver/functions/compare-build.js","webpack:///../node_modules/semver/functions/lt.js","webpack:///../node_modules/semver/functions/gte.js","webpack:///../node_modules/semver/functions/lte.js","webpack:///../node_modules/semver/ranges/outside.js","webpack:///external \"app/core/core\"","webpack:///external \"app/core/table_model\"","webpack:///external \"app/core/utils/kbn\"","webpack:///../node_modules/semver/functions/neq.js","webpack:///../node_modules/semver/functions/cmp.js","webpack:///external \"app/core/config\"","webpack:///external \"angular\"","webpack:///../node_modules/semver/functions/valid.js","webpack:///../node_modules/semver/functions/clean.js","webpack:///../node_modules/semver/functions/inc.js","webpack:///../node_modules/semver/functions/diff.js","webpack:///../node_modules/semver/functions/major.js","webpack:///../node_modules/semver/functions/minor.js","webpack:///../node_modules/semver/functions/patch.js","webpack:///../node_modules/semver/functions/prerelease.js","webpack:///../node_modules/semver/functions/rcompare.js","webpack:///../node_modules/semver/functions/compare-loose.js","webpack:///../node_modules/semver/functions/sort.js","webpack:///../node_modules/semver/functions/rsort.js","webpack:///../node_modules/semver/functions/coerce.js","webpack:///../node_modules/semver/node_modules/lru-cache/index.js","webpack:///../node_modules/yallist/yallist.js","webpack:///../node_modules/yallist/iterator.js","webpack:///../node_modules/semver/ranges/to-comparators.js","webpack:///../node_modules/semver/ranges/max-satisfying.js","webpack:///../node_modules/semver/ranges/min-satisfying.js","webpack:///../node_modules/semver/ranges/min-version.js","webpack:///../node_modules/semver/ranges/valid.js","webpack:///../node_modules/semver/ranges/gtr.js","webpack:///../node_modules/semver/ranges/ltr.js","webpack:///../node_modules/semver/ranges/intersects.js","webpack:///../node_modules/semver/ranges/simplify.js","webpack:///../node_modules/semver/ranges/subset.js","webpack:///./datasource-zabbix/migrations.ts","webpack:///./datasource-zabbix/metricFunctions.ts","webpack:///./datasource-zabbix/dataProcessor.ts","webpack:///./datasource-zabbix/responseHandler.ts","webpack:///./datasource-zabbix/problemsHandler.ts","webpack:///./datasource-zabbix/zabbix/proxy/cachingProxy.ts","webpack:///./datasource-zabbix/zabbix/connectors/dbConnector.ts","webpack:///./datasource-zabbix/zabbix/connectors/zabbix_api/zabbixAPIConnector.ts","webpack:///./datasource-zabbix/zabbix/connectors/sql/mysql.ts","webpack:///./datasource-zabbix/zabbix/connectors/sql/postgres.ts","webpack:///./datasource-zabbix/zabbix/connectors/sql/sqlConnector.ts","webpack:///./datasource-zabbix/zabbix/connectors/influxdb/influxdbConnector.ts","webpack:///./datasource-zabbix/zabbix/zabbix.ts","webpack:///./datasource-zabbix/datasource.ts","webpack:///./datasource-zabbix/query.controller.ts","webpack:///./datasource-zabbix/components/ZabbixInput.tsx","webpack:///./datasource-zabbix/components/VariableQueryEditor.tsx","webpack:///./datasource-zabbix/components/ConfigEditor.tsx","webpack:///./datasource-zabbix/add-metric-function.directive.js","webpack:///./datasource-zabbix/components/FunctionEditorControls.tsx","webpack:///./datasource-zabbix/components/FunctionEditor.tsx","webpack:///./datasource-zabbix/metric-function-editor.directive.ts","webpack:///./datasource-zabbix/react2angular.ts","webpack:///./datasource-zabbix/module.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","ZABBIX_PROBLEMS_PANEL_ID","DATAPOINT_VALUE","DATAPOINT_TS","MODE_METRICS","MODE_ITSERVICE","MODE_TEXT","MODE_ITEMID","MODE_TRIGGERS","MODE_PROBLEMS","ZBX_ACK_ACTION_NONE","ZBX_ACK_ACTION_CLOSE","ZBX_ACK_ACTION_ACK","ZBX_ACK_ACTION_ADD_MESSAGE","ZBX_ACK_ACTION_CHANGE_SEVERITY","TRIGGER_SEVERITY","val","text","MIN_SLA_INTERVAL","RANGE_VARIABLE_VALUE","DEFAULT_ZABBIX_PROBLEMS_LIMIT","variableRegex","expandItemName","paramStr","params","quoted","in_array","param","key_params_str","substring","indexOf","lastIndexOf","key_params","forEach","symbol","push","length","replace","expandItems","items","item","key_","MACRO_PATTERN","containsMacro","itemName","test","replaceMacro","macros","isTriggerItem","url","item_macros","match","macro","host_macros","filter","hostid","hosts","h","macro_def","find","macro_value","macro_regex","RegExp","escapeMacro","parseLegacyVariableQuery","query","queryType","parts","each","split","isContainsBraces","result","map","part","trim","splitTemplateQuery","template","zipObject","app","Group","Host","Application","Item","group","host","application","regexPattern","isRegex","str","isTemplateVariable","templateVariables","variables","variable","includes","getRangeScopedVars","range","msRange","to","diff","from","sRange","Math","round","regularRange","secondsToHms","__range_ms","__range_s","__range","__range_series","buildRegex","matches","pattern","flags","undefined","escapeRegex","parseItemInterval","interval","normalizedInterval","parsedInterval","exec","normalizeZabbixInterval","parseInterval","momentInterval","duration","Number","valueOf","parseTimeShiftInterval","formatAcknowledges","acknowledges","ack","unix","clock","format","alias","surname","message","concat","sequence","funcsArray","this","compactQuery","isNumeric","isNaN","parseFloat","isFinite","parseTags","tagStr","tags","tag","tagParts","itemTagToString","mustArray","unitsMap","knownGrafanaUnits","units","submenu","unit","getKnownGrafanaUnits","convertZabbixUnit","zabbixUnit","getValueMapping","valueMappings","valuemapid","mapping","mappings","type","ValueToText","options","newvalue","isProblemsDataFrame","data","fields","other","config","custom","__WEBPACK_EXTERNAL_MODULE__5__","__WEBPACK_EXTERNAL_MODULE__6__","__WEBPACK_EXTERNAL_MODULE__7__","VariableQueryTypes","ShowProblemTypes","__WEBPACK_EXTERNAL_MODULE__10__","__WEBPACK_EXTERNAL_MODULE__11__","debug","MAX_LENGTH","MAX_SAFE_INTEGER","re","parseOptions","compareIdentifiers","SemVer","version","loose","includePrerelease","TypeError","LOOSE","FULL","raw","major","minor","patch","prerelease","id","num","build","join","compareMain","comparePre","a","b","release","identifier","inc","Error","isNewProblem","problem","highlightNewerThan","highlightIntervalMs","Date","now","timestamp","e","formatLastChange","lastchangeUnix","customFormat","getNextRefIdChar","queries","refId","every","__WEBPACK_EXTERNAL_MODULE__14__","__WEBPACK_EXTERNAL_MODULE__15__","compare","Range","Comparator","set","parseRange","first","isNullSet","isAny","comps","memoKey","keys","cached","cache","hr","HYPHENRANGELOOSE","HYPHENRANGE","hyphenReplace","COMPARATORTRIM","comparatorTrimReplace","TILDETRIM","tildeTrimReplace","CARETTRIM","caretTrimReplace","compRe","COMPARATORLOOSE","COMPARATOR","rangeList","comp","parseComparator","replaceGTE0","rangeMap","Map","size","has","delete","values","some","thisComparators","isSatisfiable","rangeComparators","thisComparator","rangeComparator","intersects","er","testSet","max","comparators","remainingComparators","slice","testComparator","pop","otherComparator","replaceCarets","replaceTildes","replaceXRanges","replaceStars","isX","toLowerCase","replaceTilde","TILDELOOSE","TILDE","_","M","pr","ret","replaceCaret","CARETLOOSE","CARET","z","replaceXRange","XRANGELOOSE","XRANGE","gtlt","xM","xm","xp","anyX","STAR","GTE0PRE","GTE0","incPr","$0","fM","fm","fp","fpr","fb","tM","tm","tp","tpr","tb","semver","ANY","allowed","__WEBPACK_EXTERNAL_MODULE__18__","CURRENT_SCHEMA_VERSION","migratePanelSchema","panel","targets","target","trigger","isDefaultTarget","isDefaultPanel","datasource","datasources","triggers","isArray","isEmpty","isEmptyPanel","schemaVersion","getSchemaVersion","lastChangeField","infoField","scroll","hideHostsInMaintenance","defaultsDeep","proxy","showEvents","updatedTargets","targetKey","isEmptyTarget","isInvalidTarget","showProblems","migrateShowEvents","migrateOptions","defaults","hostsInMaintenance","sortProblems","sortTriggersBy","showTriggers","acknowledged","limit","minSeverity","Problems","History","MAX_SAFE_COMPONENT_LENGTH","src","R","createToken","isGlobal","index","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","BUILDIDENTIFIER","MAINVERSION","PRERELEASE","BUILD","FULLPLAIN","MAINVERSIONLOOSE","PRERELEASELOOSE","LOOSEPLAIN","XRANGEIDENTIFIER","XRANGEIDENTIFIERLOOSE","GTLT","XRANGEPLAIN","XRANGEPLAINLOOSE","COERCE","LONETILDE","LONECARET","internalRe","tokens","SEMVER_SPEC_VERSION","rcompareIdentifiers","parse","valid","clean","rcompare","compareLoose","compareBuild","sort","rsort","gt","lt","eq","neq","gte","lte","cmp","coerce","satisfies","toComparators","maxSatisfying","minSatisfying","minVersion","validRange","outside","gtr","ltr","simplifyRange","subset","process","env","NODE_DEBUG","args","console","error","opts","k","reduce","operator","sameDirectionIncreasing","sameDirectionDecreasing","sameSemVer","differentDirectionsInclusive","oppositeDirectionsLessThan","oppositeDirectionsGreaterThan","__WEBPACK_EXTERNAL_MODULE__31__","numeric","anum","bnum","versionA","versionB","hilo","gtfn","ltefn","ltfn","ecomp","high","low","comparator","__WEBPACK_EXTERNAL_MODULE__39__","__WEBPACK_EXTERNAL_MODULE__40__","__WEBPACK_EXTERNAL_MODULE__41__","op","__WEBPACK_EXTERNAL_MODULE__44__","__WEBPACK_EXTERNAL_MODULE__45__","v","version1","version2","v1","v2","hasPre","prefix","defaultResult","parsed","list","String","rtl","next","COERCERTL","lastIndex","Yallist","MAX","LENGTH","LENGTH_CALCULATOR","ALLOW_STALE","MAX_AGE","DISPOSE","NO_DISPOSE_ON_SET","LRU_LIST","CACHE","UPDATE_AGE_ON_GET","naiveLength","self","doUse","node","hit","isStale","del","unshiftNode","maxAge","walker","tail","prev","removeNode","Entry","forEachStep","fn","thisp","Infinity","lc","stale","dispose","noDisposeOnSet","updateAgeOnGet","reset","mL","allowStale","mA","lC","head","toArray","len","unshift","arr","expiresAt","arguments","insert","inserted","Node","pushNode","res","shift","forEachReverse","getReverse","mapReverse","initial","acc","reduceReverse","Array","toArrayReverse","sliceReverse","splice","start","deleteCount","nodes","reverse","iterator","versions","maxSV","rangeObj","min","minSV","minver","setMin","compver","r1","r2","ranges","simplified","original","simpleSubset","sub","dom","eqSet","Set","gtltComp","higher","lower","hasDomLT","hasDomGT","higherGT","lowerLT","add","sawNonNull","OUTER","simpleSub","simpleDom","isSub","migrate","resultFormat","hostFilter","itemFilter","downsampleFunction","isGrafana2target","fixTargetGroup","convertToRegex","migrateFrom2To3version","functions","f","def","migratePercentileAgg","toString","migrateQueryType","slaInterval","migrateSLA","migrateProblemSort","itemTag","migrateApplications","migrateDSConfig","jsonData","dbConnection","schema","shouldMigrateDSConfig","oldVersion","dbConnectionOptions","dbConnectionEnable","enable","dbConnectionDatasourceId","datasourceId","timeout","Transform","Aggregate","Filter","Trends","Time","Alias","Special","addFuncDef","funcDef","defaultParams","category","shortName","funcList","catName","sortBy","updateText","bindFunction","metricFunctions","func","bindedFunc","partial","render","metricExp","parameters","paramType","_hasMultipleParamsInString","strValue","optional","updateParam","partVal","idx","createFuncInstance","isString","getCategories","extractText","timeShift","utils","time","setAlias","frame","valueField","scopedVars","fieldIndex","field","setAliasByRegex","replaceAlias","regexp","newAlias","state","convertHistory","history","addHostName","convertPointCallback","grouped_history","groupBy","uniqBy","flatten","hist","itemid","delay","datapoints","convertText","point","textFilter","useCaptureGroups","extractedValue","convertHistoryPoint","convertTrendPoint","valueType","value_min","value_max","value_avg","handleHistory","handleTrends","handleText","handleHistoryAsTable","table","addColumn","itemHistory","lastPoint","last","lastValue","skipEmptyValues","rows","handleSLAResponse","itservice","slaProperty","slaObject","targetSLA","serviceid","sla","targetStatus","parseInt","status","slaArr","handleTriggersResponse","groups","timeRange","stats","uniq","flattenDeep","0","1","2","3","4","5","priority","getTriggerStats","orderBy","severity","severity_stats","row","toPairs","triggersCount","err","log","sortTimeseries","timeseries","series","seriesToDataFrame","fieldType","seriesName","timeFiled","string","valueFiled","number","labels","displayNameFromDS","itemInterval","item_key","useZabbixValueMapping","dataResponseToTimeSeries","response","request","frameJSON","timeField","timeIndex","j","intervalMs","timeSeriesData","ts","meta","itServiceResponseToTimeSeries","dp","intervalNS","isConvertibleToWide","convertToWide","maxLengthIndex","maxLength","getLongestFrame","alignFrames","minTimestamp","firstTs","timestamps","missingTimestamps","missingValues","frameInterval","joinTriggersWithProblems","problems","problemDTOList","objectid","problemDTO","triggerid","eventid","suppressed","suppression_data","description","comments","alerts","expression","correlation_mode","correlation_tag","manual_close","joinTriggersWithEvents","events","valueFromEvent","addTriggerDataSource","addTriggerHostProxy","proxies","proxy_hostid","hostProxy","setMaintenanceStatus","maintenance_status","maintenance","setAckButtonStatus","showAckButton","filterTriggersPre","triggerList","replacedTarget","triggerFilter","filterTriggers","toDataFrame","cacheOptions","cacheEnabled","enabled","ttl","promises","cacheRequest","funcName","funcScope","cacheObject","hash","getRequestHash","_isExpired","Promise","resolve","apply","then","proxify","promiseKeeper","callOnce","proxifyWithCache","proxified","object_age","chr","charCodeAt","getHash","JSON","stringify","HISTORY_TO_TABLE_MAP","TREND_TO_TABLE_MAP","consolidateByTrendColumns","datasourceName","datasourceTypeId","datasourceTypeName","loadDatasource","dsId","dsName","ds","getList","reject","loadDBDataSource","DBConnector","DEFAULT_QUERY_LIMIT","consolidateByFunc","roundInterval","round_interval","basicAuth","withCredentials","backendAPIUrl","requestOptions","getTrend","getTrend_ZBXNEXT1193","initVersion","method","backendAPIRequest","headers","hideFromInspector","Authorization","fetch","toPromise","getVersion","getVersionPromise","isZabbix54OrHigher","acknowledgeEvent","action","eventids","getGroups","output","sortfield","real_hosts","getHosts","groupids","getApps","hostids","getItems","appids","itemtype","webitems","selectHosts","applicationids","value_type","selectTags","getItemsByIDs","itemids","getMacros","getGlobalMacros","globalmacro","getLastValue","lastvalue","getHistory","timeFrom","timeTill","grouped_items","sortorder","time_from","time_till","all","trend","getTrend_30","getITService","serviceids","getSLA","intervals","buildSLAIntervals","getSLAInterval","getProblems","timeTo","recent","severities","selectAcknowledges","selectSuppressionData","source","evaltype","getTriggersByIds","triggerids","expandDescription","expandData","expandComment","monitored","skipDependent","selectGroups","selectItems","preservekeys","getTriggers","selectLastEvent","Recent","lastChangeSince","lastChangeTill","getEvents","objectids","select_acknowledges","getEventsHistory","getExtendedEventData","getEventAlerts","selectUsers","getAcknowledges","event","getAlerts","getHostAlerts","count","min_severity","countOutput","lastEvent","filterTriggersByAcknowledge","getProxies","getScripts","executeScript","scriptid","getValueMappings","selectMappings","floor","ceil","code","historyQuery","intervalSec","aggFunction","time_expression","trendsQuery","valueColumn","testQuery","supportedDatabases","sqlDialect","loadSQLDialect","testDataSource","invokeSQLQuery","getAggFunc","results","getTrends","consolidateBy","dbConnector","queryDef","rawSql","maxDataPoints","datasourceRequest","frames","retentionPolicy","influxDS","testDatasource","buildHistoryQuery","invokeInfluxDBQuery","seriesList","influxSeriesList","y","influxSeries","timeSeries","points","handleInfluxHistoryResponse","buildWhereClause","_seriesQuery","REQUESTS_TO_PROXYFY","REQUESTS_TO_CACHE","REQUESTS_TO_BIND","cacheTTL","enableDirectDBConnection","dbConnectionDatasourceName","dbConnectionRetentionPolicy","cachingProxy","CachingProxy","zabbixAPI","proxifyRequests","cacheRequests","bindRequests","connectorOptions","initDBConnector","getHistoryDB","getTrendsDB","zabbixVersion","dbConnectorStatus","getAllGroups","testResult","dsType","supportsApplications","getItemsFromTarget","filters","getHostsFromTarget","apps","appFilterEmpty","groupFilter","findByFilter","getAllHosts","getAllApps","appFilter","skipAppFilter","filterByQuery","appsResponse","getItemTags","itemTagFilter","getAllItems","filterItemsByTag","showDisabledItems","expandUserMacro","hostIds","getHostIds","getItemValues","subtract","getITServices","itServiceFilter","itServices","proxyFilter","filteredGroups","filteredHosts","filteredApps","filterTriggersByProxy","getProblemsHistory","getFilteredProxies","getHistoryTS","responseHandler","getHistoryText","itservices","itServiceIds","slaResponse","filterByRegex","regex","filterPattern","zbx_obj","finded","findByName","filterByName","instanceSettings","templateSrv","isBackendTarget","isDBConnectionTarget","enableDebugLog","buildInfo","replaceTemplateVars","trends","trendsFrom","trendsRange","disableReadOnlyUsersAck","disableDataAlignment","zabbixOptions","zabbix","requestTargets","cloneDeep","backendResponsePromise","backendQuery","dbConnectionResponsePromise","dbConnectionQuery","frontendResponsePromise","frontendQuery","rsp","backendRes","dbConnectionRes","frontendRes","Done","requestId","assign","compact","hide","replaceTargetVariables","body","resp","sortByRefId","applyFrontendFunctions","frontendTargets","buildTimeRange","queryTextData","queryITServiceData","queryTriggersData","queryProblems","useTrends","isUseTrends","queryItemIdData","queryNumericData","timeFunctions","bindFunctionDefs","getItemOptions","queryStart","getTime","queryNumericDataForItems","queryEnd","handleBackendPostProcessingResponse","getTrendValueType","getConsolidateBy","invokeDataProcessingQuery","trendFunctions","trendValueFunc","aliasFunctions","getRequestTarget","zabbixItemIdsTemplateFormat","isOldVersion","itservicesdp","backendRequest","processedResponse","userIsEditor","isEditor","isGrafanaAdmin","getProxiesPromise","tagsFilter","tagsFilterStr","getProblemsPromise","problemsOptions","useTimeRange","sourceProxies","keyBy","title","ZabbixAPIError","metricFindQuery","resultPromise","queryModel","prop","ItemTag","ItemValues","metrics","formatMetric","targetContainsTemplate","variableExists","annotationQuery","rangeRaw","annotation","showOkEvents","minseverity","problemName","hideAcknowledged","formattedAcknowledges","annotationTags","showHostname","useTrendsFrom","useTrendsRange","functionDefs","aggregationFunctions","aggFuncDefs","dataProcessor","metricObj","expandable","zabbixTemplateFormat","$scope","$injector","$rootScope","metric","tagList","getVariables","editorModes","editorMode","METRICS","TEXT","ITSERVICE","ITEMID","TRIGGERS","PROBLEMS","slaPropertyList","slaIntervals","ackFilters","problemAckFilters","sortByFields","showEventsFields","showProblemsOptions","resultFormats","severityOptions","getGroupNames","getMetricNames","getHostNames","getApplicationNames","getItemNames","getProxyNames","getTemplateVariables","$on","onTargetBlur","init","refresh","scopeDefaults","oldTarget","queryOptionsText","renderQueryOptionsText","targetDefaults","initDefaultQueryMode","sevOption","show","mapSeverityOptionsFromPanel","triggerSeverity","initFilters","suggestITServices","suggestGroups","suggestHosts","suggestApps","suggestItems","suggestProxies","suggestItemTags","metricList","addAllValue","groupList","hostList","appList","itemList","itServiceList","proxyList","isVariable","newTarget","isEqual","targetChanged","onVariableChange","isContainsVariables","parseTarget","validateTarget","addFunction","newFunc","added","moveAliasFuncLast","removeFunction","without","moveFunction","offset","move","aliasFunc","toggleQueryOptions","showQueryOptions","onQueryOptionChange","optionsMap","forOwn","optionValue","switchEditorMode","appFilterDisabled","Input","variablePattern","zabbixInputValidationEvents","onBlur","rule","errorMessage","restProps","styles","theme","inputRegex","palette","orange","inputVariable","colors","textBlue","inputClass","className","validationEvents","props","queryTypes","label","selectedQueryType","handleQueryUpdate","evt","currentTarget","setState","prevState","newQuery","handleQueryChange","onChange","handleQueryTypeChange","selectedItem","getSelectedQueryType","legacyQuery","q","supportsItemTags","width","tooltip","css","readOnly","FormField","Switch","SUPPORTED_SQL_DS","jsonDataChangeHandler","jsonDataSwitchHandler","checked","secureJsonDataChangeHandler","secureJsonData","resetSecureJsonField","secureJsonFields","directDBDatasourceChanegeHandler","setSelectedDS","setSelectedDSType","selectedDs","dsOption","dsList","getAll","getDirectDBDSOptions","angular","directive","$compile","link","elem","categories","allFunctions","getAllFunctionNames","functionMenu","click","createFunctionDropDownMenu","$input","$","$button","appendTo","attr","typeahead","minLength","updater","$apply","ctrl","focus","keyup","toggleClass","blur","setTimeout","removeClass","contents","onClick","onDescriptionShow","window","open","DOCS_FUNC_REF_URL","onMoveLeft","onMoveRight","onRemove","style","display","justifyContent","triggerRef","createRef","renderContent","updatePopperPosition","overflow","maxHeight","textAlign","fontWeight","color","showingDescription","content","placement","hideAfter","showPopper","hidePopper","popperProps","referenceElement","current","wrapperClassName","onMouseLeave","onMouseEnter","renderArrow","arrowProps","ref","cursor","PureComponent","zabbixFunctionEditor","restrict","$funcLink","scheduledRelink","paramCountAtLink","cancelBlur","clickFuncParam","paramIndex","$link","$comma","select","lookup","paramDef","multiple","switchToLink","inputElem","clearTimeout","newValue","html","highlightVariablesAsHtml","relink","hasClass","addClass","inputBlur","inputKeyPress","which","inputKeyDown","addElementsAndCompile","defParams","clone","lastParam","paramValue","hasValue","$paramLink","keypress","$element","addTypeahead","children","remove","handleRemoveFunction","handleMoveLeft","handleMoveRight","component","reactDirective","react2AngularDirective","templateUrl","dark","light","setConfigEditor","onOptionsChange","selectedDBDatasource","setSelectedDBDatasource","currentDSType","setCurrentDSType","password","restJsonData","defaultUrl","dataSourceConfig","showAccessOptions","labelWidth","inputWidth","username","required","disabled","placeholder","labelClass","setQueryCtrl","setAnnotationQueryCtrl","ZabbixAnnotationsQueryController","setVariableQueryEditor"],"mappings":"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","file":"datasource-zabbix/module.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 78);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","// Plugin IDs\nexport const ZABBIX_PROBLEMS_PANEL_ID = 'alexanderzobnin-zabbix-triggers-panel';\nexport const ZABBIX_DS_ID = 'alexanderzobnin-zabbix-datasource';\n\n// Data point\nexport const DATAPOINT_VALUE = 0;\nexport const DATAPOINT_TS = 1;\n\n// Editor modes\nexport const MODE_METRICS = '0';\nexport const MODE_ITSERVICE = '1';\nexport const MODE_TEXT = '2';\nexport const MODE_ITEMID = '3';\nexport const MODE_TRIGGERS = '4';\nexport const MODE_PROBLEMS = '5';\n\n// Triggers severity\nexport const SEV_NOT_CLASSIFIED = 0;\nexport const SEV_INFORMATION = 1;\nexport const SEV_WARNING = 2;\nexport const SEV_AVERAGE = 3;\nexport const SEV_HIGH = 4;\nexport const SEV_DISASTER = 5;\n\nexport const SHOW_ALL_TRIGGERS = [0, 1];\nexport const SHOW_ALL_EVENTS = [0, 1];\nexport const SHOW_OK_EVENTS = 1;\n\n// Acknowledge\nexport const ZBX_ACK_ACTION_NONE = 0;\nexport const ZBX_ACK_ACTION_CLOSE = 1;\nexport const ZBX_ACK_ACTION_ACK = 2;\nexport const ZBX_ACK_ACTION_ADD_MESSAGE = 4;\nexport const ZBX_ACK_ACTION_CHANGE_SEVERITY = 8;\n\nexport const TRIGGER_SEVERITY = [\n  {val: 0, text: 'Not classified'},\n  {val: 1, text: 'Information'},\n  {val: 2, text: 'Warning'},\n  {val: 3, text: 'Average'},\n  {val: 4, text: 'High'},\n  {val: 5, text: 'Disaster'}\n];\n\n/** Minimum interval for SLA over time (1 hour) */\nexport const MIN_SLA_INTERVAL = 3600;\n\nexport const RANGE_VARIABLE_VALUE = 'range_series';\n\nexport const DEFAULT_ZABBIX_PROBLEMS_LIMIT = 1001;\n","import _ from 'lodash';\nimport moment from 'moment';\nimport * as c from './constants';\nimport { VariableQuery, VariableQueryTypes, ZBXItemTag } from './types';\nimport { DataFrame, FieldType, getValueFormats, MappingType, rangeUtil, ValueMapping } from '@grafana/data';\n\n/*\n * This regex matches 3 types of variable reference with an optional format specifier\n * \\$(\\w+)                          $var1\n * \\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]    [[var2]] or [[var2:fmt2]]\n * \\${(\\w+)(?::(\\w+))?}             ${var3} or ${var3:fmt3}\n */\nexport const variableRegex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]|\\${(\\w+)(?:\\.([^:^\\}]+))?(?::(\\w+))?}/g;\n\n/**\n * Expand Zabbix item name\n *\n * @param  {string} name item name, ie \"CPU $2 time\"\n * @param  {string} key  item key, ie system.cpu.util[,system,avg1]\n * @return {string}      expanded name, ie \"CPU system time\"\n */\nexport function expandItemName(name: string, key: string): string {\n\n  // extract params from key:\n  // \"system.cpu.util[,system,avg1]\" --> [\"\", \"system\", \"avg1\"]\n  const key_params_str = key.substring(key.indexOf('[') + 1, key.lastIndexOf(']'));\n  const key_params = splitKeyParams(key_params_str);\n\n  // replace item parameters\n  for (let i = key_params.length; i >= 1; i--) {\n    name = name.replace('$' + i, key_params[i - 1]);\n  }\n  return name;\n}\n\nexport function expandItems(items) {\n  _.forEach(items, item => {\n    item.item = item.name;\n    item.name = expandItemName(item.item, item.key_);\n    return item;\n  });\n  return items;\n}\n\nfunction splitKeyParams(paramStr) {\n  const params = [];\n  let quoted = false;\n  let in_array = false;\n  const split_symbol = ',';\n  let param = '';\n\n  _.forEach(paramStr, symbol => {\n    if (symbol === '\"' && in_array) {\n      param += symbol;\n    } else if (symbol === '\"' && quoted) {\n      quoted = false;\n    } else if (symbol === '\"' && !quoted) {\n      quoted = true;\n    } else if (symbol === '[' && !quoted) {\n      in_array = true;\n    } else if (symbol === ']' && !quoted) {\n      in_array = false;\n    } else if (symbol === split_symbol && !quoted && !in_array) {\n      params.push(param);\n      param = '';\n    } else {\n      param += symbol;\n    }\n  });\n\n  params.push(param);\n  return params;\n}\n\nconst MACRO_PATTERN = /{\\$[A-Z0-9_\\.]+}/g;\n\nexport function containsMacro(itemName) {\n  return MACRO_PATTERN.test(itemName);\n}\n\nexport function replaceMacro(item, macros, isTriggerItem?) {\n  let itemName = isTriggerItem ? item.url : item.name;\n  const item_macros = itemName.match(MACRO_PATTERN);\n  _.forEach(item_macros, macro => {\n    const host_macros = _.filter(macros, m => {\n      if (m.hostid) {\n        if (isTriggerItem) {\n          // Trigger item can have multiple hosts\n          // Check all trigger host ids against macro host id\n          let hostIdFound = false;\n          _.forEach(item.hosts, h => {\n            if (h.hostid === m.hostid) {\n              hostIdFound = true;\n            }\n          });\n          return hostIdFound;\n        } else {\n          // Check app host id against macro host id\n          return m.hostid === item.hostid;\n        }\n      } else {\n        // Add global macros\n        return true;\n      }\n    });\n\n    const macro_def = _.find(host_macros, { macro: macro });\n    if (macro_def && macro_def.value) {\n      const macro_value = macro_def.value;\n      const macro_regex = new RegExp(escapeMacro(macro));\n      itemName = itemName.replace(macro_regex, macro_value);\n    }\n  });\n\n  return itemName;\n}\n\nfunction escapeMacro(macro) {\n  macro = macro.replace(/\\$/, '\\\\\\$');\n  return macro;\n}\n\nexport function parseLegacyVariableQuery(query: string): VariableQuery {\n  let queryType: VariableQueryTypes;\n  const parts = [];\n\n  // Split query. Query structure: group.host.app.item\n  _.each(splitTemplateQuery(query), part => {\n    // Replace wildcard to regex\n    if (part === '*') {\n      part = '/.*/';\n    }\n    parts.push(part);\n  });\n  const template = _.zipObject(['group', 'host', 'app', 'item'], parts);\n\n  if (parts.length === 4 && template.app === '/.*/') {\n    // Search for all items, even it's not belong to any application\n    template.app = '';\n  }\n\n  switch (parts.length) {\n    case 1:\n      queryType = VariableQueryTypes.Group;\n      break;\n    case 2:\n      queryType = VariableQueryTypes.Host;\n      break;\n    case 3:\n      queryType = VariableQueryTypes.Application;\n      break;\n    case 4:\n      queryType = VariableQueryTypes.Item;\n      break;\n  }\n\n  const variableQuery: VariableQuery = {\n    queryType,\n    group: template.group || '',\n    host: template.host || '',\n    application: template.app || '',\n    item: template.item || '',\n  };\n\n  return variableQuery;\n}\n\n/**\n * Split template query to parts of zabbix entities\n * group.host.app.item -> [group, host, app, item]\n * {group}{host.com} -> [group, host.com]\n */\nexport function splitTemplateQuery(query) {\n  const splitPattern = /\\{[^\\{\\}]*\\}|\\{\\/.*\\/\\}/g;\n  let split;\n\n  if (isContainsBraces(query)) {\n    const result = query.match(splitPattern);\n    split = _.map(result, part => {\n      return _.trim(part, '{}');\n    });\n  } else {\n    split = query.split('.');\n  }\n\n  return split;\n}\n\nfunction isContainsBraces(query) {\n  const bracesPattern = /^\\{.+\\}$/;\n  return bracesPattern.test(query);\n}\n\n// Pattern for testing regex\nexport const regexPattern = /^\\/(.*)\\/([gmi]*)$/m;\n\nexport function isRegex(str) {\n  return regexPattern.test(str);\n}\n\nexport function isTemplateVariable(str, templateVariables) {\n  const variablePattern = /^\\$\\w+/;\n  if (variablePattern.test(str)) {\n    const variables = _.map(templateVariables, variable => {\n      return '$' + variable.name;\n    });\n    return _.includes(variables, str);\n  } else {\n    return false;\n  }\n}\n\nexport function getRangeScopedVars(range) {\n  const msRange = range.to.diff(range.from);\n  const sRange = Math.round(msRange / 1000);\n  const regularRange = rangeUtil.secondsToHms(msRange / 1000);\n  return {\n    __range_ms: { text: msRange, value: msRange },\n    __range_s: { text: sRange, value: sRange },\n    __range: { text: regularRange, value: regularRange },\n    __range_series: { text: c.RANGE_VARIABLE_VALUE, value: c.RANGE_VARIABLE_VALUE },\n  };\n}\n\nexport function buildRegex(str) {\n  const matches = str.match(regexPattern);\n  const pattern = matches[1];\n  const flags = matches[2] !== \"\" ? matches[2] : undefined;\n  return new RegExp(pattern, flags);\n}\n\n// Need for template variables replace\n// From Grafana's templateSrv.js\nexport function escapeRegex(value) {\n  return value.replace(/[\\\\^$*+?.()|[\\]{}\\/]/g, '\\\\$&');\n}\n\n/**\n * Parses Zabbix item update interval (returns milliseconds). Returns 0 in case of custom intervals.\n */\nexport function parseItemInterval(interval: string): number {\n  const normalizedInterval = normalizeZabbixInterval(interval);\n  if (normalizedInterval) {\n    return parseInterval(normalizedInterval);\n  }\n  return 0;\n}\n\nexport function normalizeZabbixInterval(interval: string): string {\n  const intervalPattern = /(^[\\d]+)(y|M|w|d|h|m|s)?/g;\n  const parsedInterval = intervalPattern.exec(interval);\n  if (!parsedInterval || !interval || (parsedInterval.length > 2 && !parsedInterval[2])) {\n    return '';\n  }\n  return parsedInterval[1] + (parsedInterval.length > 2 ? parsedInterval[2] : 's');\n}\n\n// Returns interval in milliseconds\nexport function parseInterval(interval: string): number {\n  const intervalPattern = /(^[\\d]+)(y|M|w|d|h|m|s)/g;\n  const momentInterval: any[] = intervalPattern.exec(interval);\n  const duration = moment.duration(Number(momentInterval[1]), momentInterval[2]);\n  return (duration.valueOf() as number);\n}\n\nexport function parseTimeShiftInterval(interval) {\n  const intervalPattern = /^([\\+\\-]*)([\\d]+)(y|M|w|d|h|m|s)/g;\n  const momentInterval: any[] = intervalPattern.exec(interval);\n  let duration: any = 0;\n\n  if (momentInterval[1] === '+') {\n    duration = 0 - (moment.duration(Number(momentInterval[2]), momentInterval[3]).valueOf() as any);\n  } else {\n    duration = moment.duration(Number(momentInterval[2]), momentInterval[3]).valueOf();\n  }\n\n  return duration;\n}\n\n/**\n * Format acknowledges.\n *\n * @param  {array} acknowledges array of Zabbix acknowledge objects\n * @return {string} HTML-formatted table\n */\nexport function formatAcknowledges(acknowledges) {\n  if (acknowledges.length) {\n    let formatted_acknowledges = '<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td>'\n      + '<td><b>User</b></td><td><b>Comments</b></td></tr>';\n    _.each(_.map(acknowledges, ack => {\n      const timestamp = moment.unix(ack.clock);\n      return '<tr><td><i>' + timestamp.format(\"DD MMM YYYY HH:mm:ss\") + '</i></td><td>' + ack.alias\n        + ' (' + ack.name + ' ' + ack.surname + ')' + '</td><td>' + ack.message + '</td></tr>';\n    }), ack => {\n      formatted_acknowledges = formatted_acknowledges.concat(ack);\n    });\n    formatted_acknowledges = formatted_acknowledges.concat('</table>');\n    return formatted_acknowledges;\n  } else {\n    return '';\n  }\n}\n\nexport function convertToZabbixAPIUrl(url) {\n  const zabbixAPIUrlPattern = /.*api_jsonrpc.php$/;\n  const trimSlashPattern = /(.*?)[\\/]*$/;\n  if (url.match(zabbixAPIUrlPattern)) {\n    return url;\n  } else {\n    return url.replace(trimSlashPattern, \"$1\");\n  }\n}\n\n/**\n * Wrap function to prevent multiple calls\n * when waiting for result.\n */\nexport function callOnce(func, promiseKeeper) {\n  return function () {\n    if (!promiseKeeper) {\n      promiseKeeper = Promise.resolve(\n        func.apply(this, arguments)\n        .then(result => {\n          promiseKeeper = null;\n          return result;\n        }).catch(err => {\n          promiseKeeper = null;\n          throw err;\n        })\n      );\n    }\n    return promiseKeeper;\n  };\n}\n\n/**\n * Apply function one by one: `sequence([a(), b(), c()]) = c(b(a()))`\n * @param {*} funcsArray functions to apply\n */\nexport function sequence(funcsArray) {\n  return function (result) {\n    for (let i = 0; i < funcsArray.length; i++) {\n      result = funcsArray[i].call(this, result);\n    }\n    return result;\n  };\n}\n\nconst versionPattern = /^(\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?(?:-([0-9A-Za-z\\.]+))?/;\n\nexport function isValidVersion(version) {\n  return versionPattern.exec(version);\n}\n\nexport function parseVersion(version: string) {\n  const match = versionPattern.exec(version);\n  if (!match) {\n    return null;\n  }\n  const major = Number(match[1]);\n  const minor = Number(match[2] || 0);\n  const patch = Number(match[3] || 0);\n  const meta = match[4];\n  return { major, minor, patch, meta };\n}\n\n/**\n * Replaces any space-like symbols (tabs, new lines, spaces) by single whitespace.\n */\nexport function compactQuery(query) {\n  return query.replace(/\\s+/g, ' ').trim();\n}\n\nexport function getArrayDepth(a, level = 0) {\n  if (a.length === 0) {\n    return 1;\n  }\n  const elem = a[0];\n  if (_.isArray(elem)) {\n    return getArrayDepth(elem, level + 1);\n  }\n  return level + 1;\n}\n\n/**\n * Checks whether its argument represents a numeric value.\n */\nexport function isNumeric(n: any): boolean {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Parses tags string into array of {tag: value} objects\n */\nexport function parseTags(tagStr: string): any[] {\n  if (!tagStr) {\n    return [];\n  }\n\n  let tags: any[] = _.map(tagStr.split(','), (tag) => tag.trim());\n  tags = _.map(tags, (tag) => {\n    const tagParts = tag.split(':');\n    return { tag: tagParts[0].trim(), value: tagParts[1].trim() };\n  });\n  return tags;\n}\n\n// Parses string representation of tag into the object\nexport function parseItemTag(tagStr: string): ZBXItemTag {\n  const itemTag: ZBXItemTag = { tag: '', value: '' };\n  const tagParts = tagStr.split(': ');\n  itemTag.tag = tagParts[0];\n  if (tagParts[1]) {\n    itemTag.value = tagParts[1];\n  }\n  return itemTag;\n}\n\nexport function itemTagToString(t: ZBXItemTag): string {\n  return t.value ? `${t.tag}: ${t.value}` : t.tag;\n}\n\nexport function mustArray(result: any): any[] {\n  return result || [];\n}\n\nconst getUnitsMap = () => ({\n  '%': 'percent',\n  'b': 'decbits', // bits(SI)\n  'bps': 'bps', // bits/sec(SI)\n  'B': 'bytes', // bytes(IEC)\n  'Bps': 'binBps', // bytes/sec(IEC)\n  // 'unixtime': 'dateTimeAsSystem',\n  'uptime': 'dtdhms',\n  'qps': 'qps', // requests/sec (rps)\n  'iops': 'iops', // I/O ops/sec (iops)\n  'Hz': 'hertz', // Hertz (1/s)\n  'V': 'volt', // Volt (V)\n  'C': 'celsius', // Celsius (C)\n  'RPM': 'rotrpm', // Revolutions per minute (rpm)\n  'dBm': 'dBm', // Decibel-milliwatt (dBm)\n});\n\nconst getKnownGrafanaUnits = () => {\n  const units = {};\n  const categories = getValueFormats();\n  for (const category of categories) {\n    for (const unitDesc of category.submenu) {\n      const unit = unitDesc.value;\n      units[unit] = unit;\n    }\n  }\n  return units;\n};\n\nconst unitsMap = getUnitsMap();\nconst knownGrafanaUnits = getKnownGrafanaUnits();\n\nexport function convertZabbixUnit(zabbixUnit: string): string {\n  let unit = unitsMap[zabbixUnit];\n  if (!unit) {\n    unit = knownGrafanaUnits[zabbixUnit];\n  }\n  return unit;\n}\n\nexport function getValueMapping(item, valueMappings: any[]): ValueMapping[] | null {\n  const { valuemapid } = item;\n  const mapping = valueMappings?.find(m => m.valuemapid === valuemapid);\n  if (!mapping) {\n    return null;\n  }\n\n  return (mapping.mappings as any[]).map((m, i) => {\n    const valueMapping: ValueMapping = {\n      // id: i,\n      type: MappingType.ValueToText,\n      options: {\n        value: m.value,\n        text: m.newvalue,\n      }\n    };\n    return valueMapping;\n  });\n}\n\nexport function isProblemsDataFrame(data: DataFrame): boolean {\n  return data.fields.length && data.fields[0].type === FieldType.other && data.fields[0].config.custom['type'] === 'problems';\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__5__;","module.exports = __WEBPACK_EXTERNAL_MODULE__6__;","module.exports = __WEBPACK_EXTERNAL_MODULE__7__;","import { DataQuery, DataSourceJsonData, SelectableValue } from \"@grafana/data\";\n\nexport interface ZabbixDSOptions extends DataSourceJsonData {\n  username: string;\n  password?: string;\n  trends: boolean;\n  trendsFrom: string;\n  trendsRange: string;\n  cacheTTL: string;\n  timeout?: number;\n  dbConnectionEnable: boolean;\n  dbConnectionDatasourceId?: number;\n  dbConnectionDatasourceName?: string;\n  dbConnectionRetentionPolicy?: string;\n  disableReadOnlyUsersAck: boolean;\n  disableDataAlignment: boolean;\n}\n\nexport interface ZabbixSecureJSONData {\n  password?: string;\n}\n\nexport interface ZabbixConnectionInfo {\n  zabbixVersion: string;\n  dbConnectorStatus: {\n    dsType: string;\n    dsName: string;\n  };\n}\n\nexport interface ZabbixConnectionTestQuery {\n  datasourceId: number;\n  queryType: string;\n}\n\nexport interface ZabbixMetricsQuery extends DataQuery {\n  triggers: { minSeverity: string; acknowledged: boolean; count: number; };\n  queryType: string;\n  datasourceId: number;\n  group: { filter: string; name?: string; };\n  host: { filter: string; name?: string; };\n  application: { filter: string; name?: string; };\n  itemTag: { filter: string; name?: string; };\n  item: { filter: string; name?: string; };\n  textFilter: string;\n  mode: number;\n  itemids: number[];\n  useCaptureGroups: boolean;\n  proxy?: { filter: string; };\n  trigger?: { filter: string; };\n  itServiceFilter?: string;\n  tags?: { filter: string; };\n  functions: ZabbixMetricFunction[];\n  options: ZabbixQueryOptions;\n  // Problems\n  showProblems?: ShowProblemTypes;\n  // Deprecated\n  hostFilter?: string;\n  itemFilter?: string;\n}\n\nexport interface ZabbixQueryOptions {\n  showDisabledItems?: boolean;\n  skipEmptyValues?: boolean;\n  disableDataAlignment?: boolean;\n  useZabbixValueMapping?: boolean;\n  // Problems options\n  minSeverity?: number;\n  sortProblems?: string;\n  acknowledged?: number;\n  hostsInMaintenance?: boolean;\n  hostProxy?: boolean;\n  limit?: number;\n  useTimeRange?: boolean;\n  severities?: number[];\n}\n\nexport interface ZabbixMetricFunction {\n  name: string;\n  params: any;\n  def: { name: string; params: any; };\n}\n\n// The paths of these files have moved around in Grafana and they don't resolve properly\n// either. Safer not to bother trying to import them just for type hinting.\n\nexport interface TemplateSrv {\n  variables: {\n    name: string;\n  };\n\n  highlightVariablesAsHtml(str: any): any;\n\n  replace(target: any, scopedVars?: any, format?: any): any;\n}\n\nexport interface DashboardSrv {\n  dash: any;\n}\n\n// Grafana types from backend code\n\ntype RowValues = object[];\ntype TimePoint = [number?, number?];\ntype TimeSeriesPoints = TimePoint[];\ntype TimeSeriesSlice = TimeSeries[];\n\ninterface TimeSeries {\n  name: string;\n  points: TimeSeriesPoints;\n  tags: { [key: string]: string };\n}\n\ninterface TableColumn {\n  text: string;\n}\n\ninterface Table {\n  columns: TableColumn[];\n  rows: RowValues[];\n}\n\ninterface QueryResult {\n  error: string;\n  refId: string;\n  meta: any;\n  series: TimeSeriesSlice[];\n  tables: Table[];\n}\n\nexport interface TSDBResponse {\n  results: { [key: string]: QueryResult };\n  message: string;\n}\n\nexport interface VariableQueryProps {\n  query: LegacyVariableQuery;\n  onChange: (query: VariableQuery, definition: string) => void;\n  datasource: any;\n  templateSrv: any;\n}\n\nexport interface VariableQueryData extends VariableQuery {\n  selectedQueryType: SelectableValue<VariableQueryTypes>;\n  legacyQuery?: string;\n}\n\nexport interface VariableQuery {\n  queryType: VariableQueryTypes;\n  group?: string;\n  host?: string;\n  application?: string;\n  itemTag?: string;\n  item?: string;\n}\n\nexport type LegacyVariableQuery = VariableQuery | string;\n\nexport enum VariableQueryTypes {\n  Group = 'group',\n  Host = 'host',\n  Application = 'application',\n  ItemTag = 'itemTag',\n  Item = 'item',\n  ItemValues = 'itemValues',\n}\n\nexport enum ShowProblemTypes {\n  Problems = 'problems',\n  Recent = 'recent',\n  History = 'history',\n}\n\nexport interface ProblemDTO {\n  triggerid?: string;\n  eventid?: string;\n  timestamp: number;\n\n  /** Name of the trigger. */\n  name?: string;\n\n  /** Same as a name. */\n  description?: string;\n\n  /** Whether the trigger is in OK or problem state. */\n  value?: string;\n\n  datasource?: string;\n  comments?: string;\n  host?: string;\n  hostTechName?: string;\n  proxy?: string;\n  severity?: string;\n\n  acknowledged?: '1' | '0';\n  acknowledges?: ZBXAcknowledge[];\n\n  groups?: ZBXGroup[];\n  hosts?: ZBXHost[];\n  items?: ZBXItem[];\n  alerts?: ZBXAlert[];\n  tags?: ZBXTag[];\n  url?: string;\n\n  expression?: string;\n  correlation_mode?: string;\n  correlation_tag?: string;\n  suppressed?: string;\n  suppression_data?: any[];\n  state?: string;\n  maintenance?: boolean;\n  manual_close?: string;\n  error?: string;\n\n  showAckButton?: boolean;\n}\n\nexport interface ZBXProblem {\n  acknowledged?: '1' | '0';\n  acknowledges?: ZBXAcknowledge[];\n  clock: string;\n  ns: string;\n  correlationid?: string;\n  datasource?: string;\n  name?: string;\n  eventid?: string;\n  maintenance?: boolean;\n  object?: string;\n  objectid?: string;\n  opdata?: any;\n  r_eventid?: string;\n  r_clock?: string;\n  r_ns?: string;\n  severity?: string;\n  showAckButton?: boolean;\n  source?: string;\n  suppressed?: string;\n  suppression_data?: any[];\n  tags?: ZBXTag[];\n  userid?: string;\n}\n\nexport interface ZBXTrigger {\n  acknowledges?: ZBXAcknowledge[];\n  showAckButton?: boolean;\n  alerts?: ZBXAlert[];\n  age?: string;\n  color?: string;\n  comments?: string;\n  correlation_mode?: string;\n  correlation_tag?: string;\n  datasource?: string;\n  description?: string;\n  error?: string;\n  expression?: string;\n  flags?: string;\n  groups?: ZBXGroup[];\n  host?: string;\n  hostTechName?: string;\n  hosts?: ZBXHost[];\n  items?: ZBXItem[];\n  lastEvent?: ZBXEvent;\n  lastchange?: string;\n  lastchangeUnix?: number;\n  maintenance?: boolean;\n  manual_close?: string;\n  priority?: string;\n  proxy?: string;\n  recovery_expression?: string;\n  recovery_mode?: string;\n  severity?: string;\n  state?: string;\n  status?: string;\n  tags?: ZBXTag[];\n  templateid?: string;\n  triggerid?: string;\n  /** Whether the trigger can generate multiple problem events. */\n  type?: string;\n  url?: string;\n  value?: string;\n}\n\nexport interface ZBXGroup {\n  groupid: string;\n  name: string;\n}\n\nexport interface ZBXHost {\n  hostid: string;\n  name: string;\n  host: string;\n  maintenance_status?: string;\n  proxy_hostid?: string;\n}\n\nexport interface ZBXItem {\n  itemid: string;\n  name: string;\n  key_: string;\n  lastvalue?: string;\n  tags?: ZBXItemTag[];\n}\n\nexport interface ZBXItemTag {\n  tag: string;\n  value?: string;\n}\n\nexport interface ZBXEvent {\n  eventid: string;\n  clock: string;\n  ns?: string;\n  value?: string;\n  name?: string;\n  source?: string;\n  object?: string;\n  objectid?: string;\n  severity?: string;\n  hosts?: ZBXHost[];\n  acknowledged?: '1' | '0';\n  acknowledges?: ZBXAcknowledge[];\n  tags?: ZBXTag[];\n  suppressed?: string;\n}\n\nexport interface ZBXTag {\n  tag: string;\n  value?: string;\n}\n\nexport interface ZBXAcknowledge {\n  acknowledgeid: string;\n  eventid: string;\n  userid: string;\n  action: string;\n  clock: string;\n  time: string;\n  message?: string;\n  user: string;\n  alias: string;\n  name: string;\n  surname: string;\n}\n\nexport interface ZBXAlert {\n  eventid: string;\n  clock: string;\n  message: string;\n  error: string;\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__10__;","module.exports = __WEBPACK_EXTERNAL_MODULE__11__;","const debug = require('../internal/debug')\nconst { MAX_LENGTH, MAX_SAFE_INTEGER } = require('../internal/constants')\nconst { re, t } = require('../internal/re')\n\nconst parseOptions = require('../internal/parse-options')\nconst { compareIdentifiers } = require('../internal/identifiers')\nclass SemVer {\n  constructor (version, options) {\n    options = parseOptions(options)\n\n    if (version instanceof SemVer) {\n      if (version.loose === !!options.loose &&\n          version.includePrerelease === !!options.includePrerelease) {\n        return version\n      } else {\n        version = version.version\n      }\n    } else if (typeof version !== 'string') {\n      throw new TypeError(`Invalid Version: ${version}`)\n    }\n\n    if (version.length > MAX_LENGTH) {\n      throw new TypeError(\n        `version is longer than ${MAX_LENGTH} characters`\n      )\n    }\n\n    debug('SemVer', version, options)\n    this.options = options\n    this.loose = !!options.loose\n    // this isn't actually relevant for versions, but keep it so that we\n    // don't run into trouble passing this.options around.\n    this.includePrerelease = !!options.includePrerelease\n\n    const m = version.trim().match(options.loose ? re[t.LOOSE] : re[t.FULL])\n\n    if (!m) {\n      throw new TypeError(`Invalid Version: ${version}`)\n    }\n\n    this.raw = version\n\n    // these are actually numbers\n    this.major = +m[1]\n    this.minor = +m[2]\n    this.patch = +m[3]\n\n    if (this.major > MAX_SAFE_INTEGER || this.major < 0) {\n      throw new TypeError('Invalid major version')\n    }\n\n    if (this.minor > MAX_SAFE_INTEGER || this.minor < 0) {\n      throw new TypeError('Invalid minor version')\n    }\n\n    if (this.patch > MAX_SAFE_INTEGER || this.patch < 0) {\n      throw new TypeError('Invalid patch version')\n    }\n\n    // numberify any prerelease numeric ids\n    if (!m[4]) {\n      this.prerelease = []\n    } else {\n      this.prerelease = m[4].split('.').map((id) => {\n        if (/^[0-9]+$/.test(id)) {\n          const num = +id\n          if (num >= 0 && num < MAX_SAFE_INTEGER) {\n            return num\n          }\n        }\n        return id\n      })\n    }\n\n    this.build = m[5] ? m[5].split('.') : []\n    this.format()\n  }\n\n  format () {\n    this.version = `${this.major}.${this.minor}.${this.patch}`\n    if (this.prerelease.length) {\n      this.version += `-${this.prerelease.join('.')}`\n    }\n    return this.version\n  }\n\n  toString () {\n    return this.version\n  }\n\n  compare (other) {\n    debug('SemVer.compare', this.version, this.options, other)\n    if (!(other instanceof SemVer)) {\n      if (typeof other === 'string' && other === this.version) {\n        return 0\n      }\n      other = new SemVer(other, this.options)\n    }\n\n    if (other.version === this.version) {\n      return 0\n    }\n\n    return this.compareMain(other) || this.comparePre(other)\n  }\n\n  compareMain (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    return (\n      compareIdentifiers(this.major, other.major) ||\n      compareIdentifiers(this.minor, other.minor) ||\n      compareIdentifiers(this.patch, other.patch)\n    )\n  }\n\n  comparePre (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    // NOT having a prerelease is > having one\n    if (this.prerelease.length && !other.prerelease.length) {\n      return -1\n    } else if (!this.prerelease.length && other.prerelease.length) {\n      return 1\n    } else if (!this.prerelease.length && !other.prerelease.length) {\n      return 0\n    }\n\n    let i = 0\n    do {\n      const a = this.prerelease[i]\n      const b = other.prerelease[i]\n      debug('prerelease compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  compareBuild (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    let i = 0\n    do {\n      const a = this.build[i]\n      const b = other.build[i]\n      debug('prerelease compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  // preminor will bump the version up to the next minor release, and immediately\n  // down to pre-release. premajor and prepatch work the same way.\n  inc (release, identifier) {\n    switch (release) {\n      case 'premajor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor = 0\n        this.major++\n        this.inc('pre', identifier)\n        break\n      case 'preminor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor++\n        this.inc('pre', identifier)\n        break\n      case 'prepatch':\n        // If this is already a prerelease, it will bump to the next version\n        // drop any prereleases that might already exist, since they are not\n        // relevant at this point.\n        this.prerelease.length = 0\n        this.inc('patch', identifier)\n        this.inc('pre', identifier)\n        break\n      // If the input is a non-prerelease version, this acts the same as\n      // prepatch.\n      case 'prerelease':\n        if (this.prerelease.length === 0) {\n          this.inc('patch', identifier)\n        }\n        this.inc('pre', identifier)\n        break\n\n      case 'major':\n        // If this is a pre-major version, bump up to the same major version.\n        // Otherwise increment major.\n        // 1.0.0-5 bumps to 1.0.0\n        // 1.1.0 bumps to 2.0.0\n        if (\n          this.minor !== 0 ||\n          this.patch !== 0 ||\n          this.prerelease.length === 0\n        ) {\n          this.major++\n        }\n        this.minor = 0\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'minor':\n        // If this is a pre-minor version, bump up to the same minor version.\n        // Otherwise increment minor.\n        // 1.2.0-5 bumps to 1.2.0\n        // 1.2.1 bumps to 1.3.0\n        if (this.patch !== 0 || this.prerelease.length === 0) {\n          this.minor++\n        }\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'patch':\n        // If this is not a pre-release version, it will increment the patch.\n        // If it is a pre-release it will bump up to the same patch version.\n        // 1.2.0-5 patches to 1.2.0\n        // 1.2.0 patches to 1.2.1\n        if (this.prerelease.length === 0) {\n          this.patch++\n        }\n        this.prerelease = []\n        break\n      // This probably shouldn't be used publicly.\n      // 1.0.0 'pre' would become 1.0.0-0 which is the wrong direction.\n      case 'pre':\n        if (this.prerelease.length === 0) {\n          this.prerelease = [0]\n        } else {\n          let i = this.prerelease.length\n          while (--i >= 0) {\n            if (typeof this.prerelease[i] === 'number') {\n              this.prerelease[i]++\n              i = -2\n            }\n          }\n          if (i === -1) {\n            // didn't increment anything\n            this.prerelease.push(0)\n          }\n        }\n        if (identifier) {\n          // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n          // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n          if (this.prerelease[0] === identifier) {\n            if (isNaN(this.prerelease[1])) {\n              this.prerelease = [identifier, 0]\n            }\n          } else {\n            this.prerelease = [identifier, 0]\n          }\n        }\n        break\n\n      default:\n        throw new Error(`invalid increment argument: ${release}`)\n    }\n    this.format()\n    this.raw = this.version\n    return this\n  }\n}\n\nmodule.exports = SemVer\n","import _ from 'lodash';\nimport moment from 'moment';\nimport { DataQuery } from '@grafana/data';\nimport * as utils from '../datasource-zabbix/utils';\nimport { ProblemDTO } from 'datasource-zabbix/types';\n\nexport function isNewProblem(problem: ProblemDTO, highlightNewerThan: string): boolean {\n  try {\n    const highlightIntervalMs = utils.parseInterval(highlightNewerThan);\n    const durationSec = (Date.now() - problem.timestamp * 1000);\n    return durationSec < highlightIntervalMs;\n  } catch (e) {\n    return false;\n  }\n}\n\nconst DEFAULT_TIME_FORMAT = \"DD MMM YYYY HH:mm:ss\";\n\nexport function formatLastChange(lastchangeUnix: number, customFormat?: string) {\n  const timestamp = moment.unix(lastchangeUnix);\n  const format = customFormat || DEFAULT_TIME_FORMAT;\n  const lastchange = timestamp.format(format);\n  return lastchange;\n}\n\nexport const getNextRefIdChar = (queries: DataQuery[]): string => {\n  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\n  return _.find(letters, refId => {\n    return _.every(queries, other => {\n      return other.refId !== refId;\n    });\n  });\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__14__;","module.exports = __WEBPACK_EXTERNAL_MODULE__15__;","const SemVer = require('../classes/semver')\nconst compare = (a, b, loose) =>\n  new SemVer(a, loose).compare(new SemVer(b, loose))\n\nmodule.exports = compare\n","// hoisted class for cyclic dependency\nclass Range {\n  constructor (range, options) {\n    options = parseOptions(options)\n\n    if (range instanceof Range) {\n      if (\n        range.loose === !!options.loose &&\n        range.includePrerelease === !!options.includePrerelease\n      ) {\n        return range\n      } else {\n        return new Range(range.raw, options)\n      }\n    }\n\n    if (range instanceof Comparator) {\n      // just put it in the set and return\n      this.raw = range.value\n      this.set = [[range]]\n      this.format()\n      return this\n    }\n\n    this.options = options\n    this.loose = !!options.loose\n    this.includePrerelease = !!options.includePrerelease\n\n    // First, split based on boolean or ||\n    this.raw = range\n    this.set = range\n      .split(/\\s*\\|\\|\\s*/)\n      // map the range to a 2d array of comparators\n      .map(range => this.parseRange(range.trim()))\n      // throw out any comparator lists that are empty\n      // this generally means that it was not a valid range, which is allowed\n      // in loose mode, but will still throw if the WHOLE range is invalid.\n      .filter(c => c.length)\n\n    if (!this.set.length) {\n      throw new TypeError(`Invalid SemVer Range: ${range}`)\n    }\n\n    // if we have any that are not the null set, throw out null sets.\n    if (this.set.length > 1) {\n      // keep the first one, in case they're all null sets\n      const first = this.set[0]\n      this.set = this.set.filter(c => !isNullSet(c[0]))\n      if (this.set.length === 0)\n        this.set = [first]\n      else if (this.set.length > 1) {\n        // if we have any that are *, then the range is just *\n        for (const c of this.set) {\n          if (c.length === 1 && isAny(c[0])) {\n            this.set = [c]\n            break\n          }\n        }\n      }\n    }\n\n    this.format()\n  }\n\n  format () {\n    this.range = this.set\n      .map((comps) => {\n        return comps.join(' ').trim()\n      })\n      .join('||')\n      .trim()\n    return this.range\n  }\n\n  toString () {\n    return this.range\n  }\n\n  parseRange (range) {\n    range = range.trim()\n\n    // memoize range parsing for performance.\n    // this is a very hot path, and fully deterministic.\n    const memoOpts = Object.keys(this.options).join(',')\n    const memoKey = `parseRange:${memoOpts}:${range}`\n    const cached = cache.get(memoKey)\n    if (cached)\n      return cached\n\n    const loose = this.options.loose\n    // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n    const hr = loose ? re[t.HYPHENRANGELOOSE] : re[t.HYPHENRANGE]\n    range = range.replace(hr, hyphenReplace(this.options.includePrerelease))\n    debug('hyphen replace', range)\n    // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n    range = range.replace(re[t.COMPARATORTRIM], comparatorTrimReplace)\n    debug('comparator trim', range, re[t.COMPARATORTRIM])\n\n    // `~ 1.2.3` => `~1.2.3`\n    range = range.replace(re[t.TILDETRIM], tildeTrimReplace)\n\n    // `^ 1.2.3` => `^1.2.3`\n    range = range.replace(re[t.CARETTRIM], caretTrimReplace)\n\n    // normalize spaces\n    range = range.split(/\\s+/).join(' ')\n\n    // At this point, the range is completely trimmed and\n    // ready to be split into comparators.\n\n    const compRe = loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n    const rangeList = range\n      .split(' ')\n      .map(comp => parseComparator(comp, this.options))\n      .join(' ')\n      .split(/\\s+/)\n      // >=0.0.0 is equivalent to *\n      .map(comp => replaceGTE0(comp, this.options))\n      // in loose mode, throw out any that are not valid comparators\n      .filter(this.options.loose ? comp => !!comp.match(compRe) : () => true)\n      .map(comp => new Comparator(comp, this.options))\n\n    // if any comparators are the null set, then replace with JUST null set\n    // if more than one comparator, remove any * comparators\n    // also, don't include the same comparator more than once\n    const l = rangeList.length\n    const rangeMap = new Map()\n    for (const comp of rangeList) {\n      if (isNullSet(comp))\n        return [comp]\n      rangeMap.set(comp.value, comp)\n    }\n    if (rangeMap.size > 1 && rangeMap.has(''))\n      rangeMap.delete('')\n\n    const result = [...rangeMap.values()]\n    cache.set(memoKey, result)\n    return result\n  }\n\n  intersects (range, options) {\n    if (!(range instanceof Range)) {\n      throw new TypeError('a Range is required')\n    }\n\n    return this.set.some((thisComparators) => {\n      return (\n        isSatisfiable(thisComparators, options) &&\n        range.set.some((rangeComparators) => {\n          return (\n            isSatisfiable(rangeComparators, options) &&\n            thisComparators.every((thisComparator) => {\n              return rangeComparators.every((rangeComparator) => {\n                return thisComparator.intersects(rangeComparator, options)\n              })\n            })\n          )\n        })\n      )\n    })\n  }\n\n  // if ANY of the sets match ALL of its comparators, then pass\n  test (version) {\n    if (!version) {\n      return false\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    for (let i = 0; i < this.set.length; i++) {\n      if (testSet(this.set[i], version, this.options)) {\n        return true\n      }\n    }\n    return false\n  }\n}\nmodule.exports = Range\n\nconst LRU = require('lru-cache')\nconst cache = new LRU({ max: 1000 })\n\nconst parseOptions = require('../internal/parse-options')\nconst Comparator = require('./comparator')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst {\n  re,\n  t,\n  comparatorTrimReplace,\n  tildeTrimReplace,\n  caretTrimReplace\n} = require('../internal/re')\n\nconst isNullSet = c => c.value === '<0.0.0-0'\nconst isAny = c => c.value === ''\n\n// take a set of comparators and determine whether there\n// exists a version which can satisfy it\nconst isSatisfiable = (comparators, options) => {\n  let result = true\n  const remainingComparators = comparators.slice()\n  let testComparator = remainingComparators.pop()\n\n  while (result && remainingComparators.length) {\n    result = remainingComparators.every((otherComparator) => {\n      return testComparator.intersects(otherComparator, options)\n    })\n\n    testComparator = remainingComparators.pop()\n  }\n\n  return result\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nconst parseComparator = (comp, options) => {\n  debug('comp', comp, options)\n  comp = replaceCarets(comp, options)\n  debug('caret', comp)\n  comp = replaceTildes(comp, options)\n  debug('tildes', comp)\n  comp = replaceXRanges(comp, options)\n  debug('xrange', comp)\n  comp = replaceStars(comp, options)\n  debug('stars', comp)\n  return comp\n}\n\nconst isX = id => !id || id.toLowerCase() === 'x' || id === '*'\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0-0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0-0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0-0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0-0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0-0\nconst replaceTildes = (comp, options) =>\n  comp.trim().split(/\\s+/).map((comp) => {\n    return replaceTilde(comp, options)\n  }).join(' ')\n\nconst replaceTilde = (comp, options) => {\n  const r = options.loose ? re[t.TILDELOOSE] : re[t.TILDE]\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('tilde', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0 <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      // ~1.2 == >=1.2.0 <1.3.0-0\n      ret = `>=${M}.${m}.0 <${M}.${+m + 1}.0-0`\n    } else if (pr) {\n      debug('replaceTilde pr', pr)\n      ret = `>=${M}.${m}.${p}-${pr\n      } <${M}.${+m + 1}.0-0`\n    } else {\n      // ~1.2.3 == >=1.2.3 <1.3.0-0\n      ret = `>=${M}.${m}.${p\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('tilde return', ret)\n    return ret\n  })\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0-0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0-0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0-0\n// ^1.2.3 --> >=1.2.3 <2.0.0-0\n// ^1.2.0 --> >=1.2.0 <2.0.0-0\nconst replaceCarets = (comp, options) =>\n  comp.trim().split(/\\s+/).map((comp) => {\n    return replaceCaret(comp, options)\n  }).join(' ')\n\nconst replaceCaret = (comp, options) => {\n  debug('caret', comp, options)\n  const r = options.loose ? re[t.CARETLOOSE] : re[t.CARET]\n  const z = options.includePrerelease ? '-0' : ''\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('caret', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0${z} <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      if (M === '0') {\n        ret = `>=${M}.${m}.0${z} <${M}.${+m + 1}.0-0`\n      } else {\n        ret = `>=${M}.${m}.0${z} <${+M + 1}.0.0-0`\n      }\n    } else if (pr) {\n      debug('replaceCaret pr', pr)\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p}-${pr\n        } <${+M + 1}.0.0-0`\n      }\n    } else {\n      debug('no pr')\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p\n        } <${+M + 1}.0.0-0`\n      }\n    }\n\n    debug('caret return', ret)\n    return ret\n  })\n}\n\nconst replaceXRanges = (comp, options) => {\n  debug('replaceXRanges', comp, options)\n  return comp.split(/\\s+/).map((comp) => {\n    return replaceXRange(comp, options)\n  }).join(' ')\n}\n\nconst replaceXRange = (comp, options) => {\n  comp = comp.trim()\n  const r = options.loose ? re[t.XRANGELOOSE] : re[t.XRANGE]\n  return comp.replace(r, (ret, gtlt, M, m, p, pr) => {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr)\n    const xM = isX(M)\n    const xm = xM || isX(m)\n    const xp = xm || isX(p)\n    const anyX = xp\n\n    if (gtlt === '=' && anyX) {\n      gtlt = ''\n    }\n\n    // if we're including prereleases in the match, then we need\n    // to fix this to -0, the lowest possible prerelease value\n    pr = options.includePrerelease ? '-0' : ''\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0-0'\n      } else {\n        // nothing is forbidden\n        ret = '*'\n      }\n    } else if (gtlt && anyX) {\n      // we know patch is an x, because we have any x at all.\n      // replace X with 0\n      if (xm) {\n        m = 0\n      }\n      p = 0\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        gtlt = '>='\n        if (xm) {\n          M = +M + 1\n          m = 0\n          p = 0\n        } else {\n          m = +m + 1\n          p = 0\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<'\n        if (xm) {\n          M = +M + 1\n        } else {\n          m = +m + 1\n        }\n      }\n\n      if (gtlt === '<')\n        pr = '-0'\n\n      ret = `${gtlt + M}.${m}.${p}${pr}`\n    } else if (xm) {\n      ret = `>=${M}.0.0${pr} <${+M + 1}.0.0-0`\n    } else if (xp) {\n      ret = `>=${M}.${m}.0${pr\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('xRange return', ret)\n\n    return ret\n  })\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nconst replaceStars = (comp, options) => {\n  debug('replaceStars', comp, options)\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp.trim().replace(re[t.STAR], '')\n}\n\nconst replaceGTE0 = (comp, options) => {\n  debug('replaceGTE0', comp, options)\n  return comp.trim()\n    .replace(re[options.includePrerelease ? t.GTE0PRE : t.GTE0], '')\n}\n\n// This function is passed to string.replace(re[t.HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0-0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0-0\nconst hyphenReplace = incPr => ($0,\n  from, fM, fm, fp, fpr, fb,\n  to, tM, tm, tp, tpr, tb) => {\n  if (isX(fM)) {\n    from = ''\n  } else if (isX(fm)) {\n    from = `>=${fM}.0.0${incPr ? '-0' : ''}`\n  } else if (isX(fp)) {\n    from = `>=${fM}.${fm}.0${incPr ? '-0' : ''}`\n  } else if (fpr) {\n    from = `>=${from}`\n  } else {\n    from = `>=${from}${incPr ? '-0' : ''}`\n  }\n\n  if (isX(tM)) {\n    to = ''\n  } else if (isX(tm)) {\n    to = `<${+tM + 1}.0.0-0`\n  } else if (isX(tp)) {\n    to = `<${tM}.${+tm + 1}.0-0`\n  } else if (tpr) {\n    to = `<=${tM}.${tm}.${tp}-${tpr}`\n  } else if (incPr) {\n    to = `<${tM}.${tm}.${+tp + 1}-0`\n  } else {\n    to = `<=${to}`\n  }\n\n  return (`${from} ${to}`).trim()\n}\n\nconst testSet = (set, version, options) => {\n  for (let i = 0; i < set.length; i++) {\n    if (!set[i].test(version)) {\n      return false\n    }\n  }\n\n  if (version.prerelease.length && !options.includePrerelease) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (let i = 0; i < set.length; i++) {\n      debug(set[i].semver)\n      if (set[i].semver === Comparator.ANY) {\n        continue\n      }\n\n      if (set[i].semver.prerelease.length > 0) {\n        const allowed = set[i].semver\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch) {\n          return true\n        }\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false\n  }\n\n  return true\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__18__;","import _ from 'lodash';\nimport { getNextRefIdChar } from './utils';\nimport { ShowProblemTypes } from '../datasource-zabbix/types';\n\n// Actual schema version\nexport const CURRENT_SCHEMA_VERSION = 8;\n\nexport const getDefaultTarget = (targets?) => {\n  return {\n    group: {filter: \"\"},\n    host: {filter: \"\"},\n    application: {filter: \"\"},\n    trigger: {filter: \"\"},\n    tags: {filter: \"\"},\n    proxy: {filter: \"\"},\n    refId: getNextRefIdChar(targets),\n  };\n};\n\nexport function getDefaultTargetOptions() {\n  return {\n    hostsInMaintenance: true,\n  };\n}\n\nexport function migratePanelSchema(panel) {\n  if (isDefaultPanel(panel)) {\n    return panel;\n  }\n\n  if (isEmptyPanel(panel)) {\n    delete panel.targets;\n    return panel;\n  }\n\n  const schemaVersion = getSchemaVersion(panel);\n  // panel.schemaVersion = CURRENT_SCHEMA_VERSION;\n\n  if (schemaVersion < 2) {\n    panel.datasources = [panel.datasource];\n    panel.targets = {};\n    panel.targets[panel.datasources[0]] = panel.triggers;\n\n    // delete old props\n    delete panel.triggers;\n    delete panel.datasource;\n  }\n\n  if (schemaVersion < 3) {\n    // delete old props\n    delete panel.lastChangeField;\n    delete panel.infoField;\n    delete panel.scroll;\n    delete panel.hideHostsInMaintenance;\n  }\n\n  if (schemaVersion < 5) {\n    if (panel.targets && !_.isEmpty(panel.targets)) {\n      _.each(panel.targets, (target) => {\n        _.defaultsDeep(target, getDefaultTarget());\n      });\n    }\n  }\n\n  if (schemaVersion < 6) {\n    if (panel.showEvents && panel.showEvents.value === '1') {\n      panel.showEvents.value = 1;\n    }\n  }\n\n  if (schemaVersion < 7) {\n    const updatedTargets = [];\n    for (const targetKey in panel.targets) {\n      const target = panel.targets[targetKey];\n      if (!isEmptyTarget(target) && !isInvalidTarget(target, targetKey)) {\n        updatedTargets.push({\n          ...target,\n          datasource: targetKey,\n        });\n      }\n    }\n    for (const target of updatedTargets) {\n      if (!target.refId) {\n        target.refId = getNextRefIdChar(updatedTargets);\n      }\n    }\n    panel.targets = updatedTargets;\n    delete panel.datasources;\n  }\n\n  if (schemaVersion < 8) {\n    if (panel.targets.length === 1) {\n      if (panel.targets[0].datasource) {\n        panel.datasource = panel.targets[0].datasource;\n        delete panel.targets[0].datasource;\n      }\n    } else if (panel.targets.length > 1) {\n      // Mixed data sources\n      panel.datasource = '-- Mixed --';\n    }\n    for (const target of panel.targets) {\n      // set queryType to PROBLEMS\n      target.queryType = 5;\n      target.showProblems = migrateShowEvents(panel);\n      target.options = migrateOptions(panel);\n\n      _.defaults(target.options, getDefaultTargetOptions());\n      _.defaults(target, { tags: { filter: \"\" } });\n    }\n\n    panel.sortProblems = panel.sortTriggersBy?.value === 'priority' ? 'priority' : 'lastchange';\n\n    delete panel.showEvents;\n    delete panel.showTriggers;\n    delete panel.hostsInMaintenance;\n    delete panel.sortTriggersBy;\n  }\n\n  return panel;\n}\n\nfunction migrateOptions(panel) {\n  let acknowledged = 2;\n  if (panel.showTriggers === 'acknowledged') {\n    acknowledged = 1;\n  } else if (panel.showTriggers === 'unacknowledged') {\n    acknowledged = 0;\n  }\n\n  // Default limit in Zabbix\n  let limit = 1001;\n  if (panel.limit && panel.limit !== 100) {\n    limit = panel.limit;\n  }\n\n  return {\n    hostsInMaintenance: panel.hostsInMaintenance,\n    sortProblems: panel.sortTriggersBy?.value === 'priority' ? 'priority' : 'default',\n    minSeverity: 0,\n    acknowledged: acknowledged,\n    limit: limit,\n  };\n}\n\nfunction migrateShowEvents(panel) {\n  if (panel.showEvents?.value === 1) {\n    return ShowProblemTypes.Problems;\n  } else if (panel.showEvents?.value === 0 || panel.showEvents?.value?.length > 1) {\n    return ShowProblemTypes.History;\n  } else {\n    return ShowProblemTypes.Problems;\n  }\n}\n\nfunction getSchemaVersion(panel) {\n  return panel.schemaVersion || 1;\n}\n\nfunction isEmptyPanel(panel) {\n  return !panel.datasource && !panel.datasources && !panel.triggers && isEmptyTargets(panel.targets);\n}\n\nfunction isEmptyTargets(targets) {\n  return !targets || (_.isArray(targets) && (targets.length === 0 || targets.length === 1 && _.isEmpty(targets[0])));\n}\n\nfunction isDefaultPanel(panel) {\n  return panel.targets && panel.targets.length === 1 && isDefaultTarget(panel.targets[0]);\n}\n\nfunction isDefaultTarget(target) {\n  return !target.group?.filter && !target.host?.filter && !target.application?.filter && !target.trigger?.filter && !target.queryType;\n}\n\nfunction isEmptyTarget(target) {\n  return !target || !(target.group && target.host && target.application && target.trigger);\n}\n\nfunction isInvalidTarget(target, targetKey) {\n  return target && target.refId === 'A' && targetKey === '0';\n}\n","const { MAX_SAFE_COMPONENT_LENGTH } = require('./constants')\nconst debug = require('./debug')\nexports = module.exports = {}\n\n// The actual regexps go on exports.re\nconst re = exports.re = []\nconst src = exports.src = []\nconst t = exports.t = {}\nlet R = 0\n\nconst createToken = (name, value, isGlobal) => {\n  const index = R++\n  debug(index, value)\n  t[name] = index\n  src[index] = value\n  re[index] = new RegExp(value, isGlobal ? 'g' : undefined)\n}\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\ncreateToken('NUMERICIDENTIFIER', '0|[1-9]\\\\d*')\ncreateToken('NUMERICIDENTIFIERLOOSE', '[0-9]+')\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\ncreateToken('NONNUMERICIDENTIFIER', '\\\\d*[a-zA-Z-][a-zA-Z0-9-]*')\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\ncreateToken('MAINVERSION', `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})`)\n\ncreateToken('MAINVERSIONLOOSE', `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})`)\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n\ncreateToken('PRERELEASEIDENTIFIER', `(?:${src[t.NUMERICIDENTIFIER]\n}|${src[t.NONNUMERICIDENTIFIER]})`)\n\ncreateToken('PRERELEASEIDENTIFIERLOOSE', `(?:${src[t.NUMERICIDENTIFIERLOOSE]\n}|${src[t.NONNUMERICIDENTIFIER]})`)\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\ncreateToken('PRERELEASE', `(?:-(${src[t.PRERELEASEIDENTIFIER]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIER]})*))`)\n\ncreateToken('PRERELEASELOOSE', `(?:-?(${src[t.PRERELEASEIDENTIFIERLOOSE]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIERLOOSE]})*))`)\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\ncreateToken('BUILDIDENTIFIER', '[0-9A-Za-z-]+')\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\ncreateToken('BUILD', `(?:\\\\+(${src[t.BUILDIDENTIFIER]\n}(?:\\\\.${src[t.BUILDIDENTIFIER]})*))`)\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\ncreateToken('FULLPLAIN', `v?${src[t.MAINVERSION]\n}${src[t.PRERELEASE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('FULL', `^${src[t.FULLPLAIN]}$`)\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\ncreateToken('LOOSEPLAIN', `[v=\\\\s]*${src[t.MAINVERSIONLOOSE]\n}${src[t.PRERELEASELOOSE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('LOOSE', `^${src[t.LOOSEPLAIN]}$`)\n\ncreateToken('GTLT', '((?:<|>)?=?)')\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\ncreateToken('XRANGEIDENTIFIERLOOSE', `${src[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`)\ncreateToken('XRANGEIDENTIFIER', `${src[t.NUMERICIDENTIFIER]}|x|X|\\\\*`)\n\ncreateToken('XRANGEPLAIN', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:${src[t.PRERELEASE]})?${\n                     src[t.BUILD]}?` +\n                   `)?)?`)\n\ncreateToken('XRANGEPLAINLOOSE', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:${src[t.PRERELEASELOOSE]})?${\n                          src[t.BUILD]}?` +\n                        `)?)?`)\n\ncreateToken('XRANGE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAIN]}$`)\ncreateToken('XRANGELOOSE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Coercion.\n// Extract anything that could conceivably be a part of a valid semver\ncreateToken('COERCE', `${'(^|[^\\\\d])' +\n              '(\\\\d{1,'}${MAX_SAFE_COMPONENT_LENGTH}})` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?` +\n              `(?:$|[^\\\\d])`)\ncreateToken('COERCERTL', src[t.COERCE], true)\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\ncreateToken('LONETILDE', '(?:~>?)')\n\ncreateToken('TILDETRIM', `(\\\\s*)${src[t.LONETILDE]}\\\\s+`, true)\nexports.tildeTrimReplace = '$1~'\n\ncreateToken('TILDE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('TILDELOOSE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\ncreateToken('LONECARET', '(?:\\\\^)')\n\ncreateToken('CARETTRIM', `(\\\\s*)${src[t.LONECARET]}\\\\s+`, true)\nexports.caretTrimReplace = '$1^'\n\ncreateToken('CARET', `^${src[t.LONECARET]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('CARETLOOSE', `^${src[t.LONECARET]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\ncreateToken('COMPARATORLOOSE', `^${src[t.GTLT]}\\\\s*(${src[t.LOOSEPLAIN]})$|^$`)\ncreateToken('COMPARATOR', `^${src[t.GTLT]}\\\\s*(${src[t.FULLPLAIN]})$|^$`)\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\ncreateToken('COMPARATORTRIM', `(\\\\s*)${src[t.GTLT]\n}\\\\s*(${src[t.LOOSEPLAIN]}|${src[t.XRANGEPLAIN]})`, true)\nexports.comparatorTrimReplace = '$1$2$3'\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\ncreateToken('HYPHENRANGE', `^\\\\s*(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s+-\\\\s+` +\n                   `(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s*$`)\n\ncreateToken('HYPHENRANGELOOSE', `^\\\\s*(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s+-\\\\s+` +\n                        `(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s*$`)\n\n// Star ranges basically just allow anything at all.\ncreateToken('STAR', '(<|>)?=?\\\\s*\\\\*')\n// >=0.0.0 is like a star\ncreateToken('GTE0', '^\\\\s*>=\\\\s*0\\.0\\.0\\\\s*$')\ncreateToken('GTE0PRE', '^\\\\s*>=\\\\s*0\\.0\\.0-0\\\\s*$')\n","const {MAX_LENGTH} = require('../internal/constants')\nconst { re, t } = require('../internal/re')\nconst SemVer = require('../classes/semver')\n\nconst parseOptions = require('../internal/parse-options')\nconst parse = (version, options) => {\n  options = parseOptions(options)\n\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  if (version.length > MAX_LENGTH) {\n    return null\n  }\n\n  const r = options.loose ? re[t.LOOSE] : re[t.FULL]\n  if (!r.test(version)) {\n    return null\n  }\n\n  try {\n    return new SemVer(version, options)\n  } catch (er) {\n    return null\n  }\n}\n\nmodule.exports = parse\n","// just pre-load all the stuff that index.js lazily exports\nconst internalRe = require('./internal/re')\nmodule.exports = {\n  re: internalRe.re,\n  src: internalRe.src,\n  tokens: internalRe.t,\n  SEMVER_SPEC_VERSION: require('./internal/constants').SEMVER_SPEC_VERSION,\n  SemVer: require('./classes/semver'),\n  compareIdentifiers: require('./internal/identifiers').compareIdentifiers,\n  rcompareIdentifiers: require('./internal/identifiers').rcompareIdentifiers,\n  parse: require('./functions/parse'),\n  valid: require('./functions/valid'),\n  clean: require('./functions/clean'),\n  inc: require('./functions/inc'),\n  diff: require('./functions/diff'),\n  major: require('./functions/major'),\n  minor: require('./functions/minor'),\n  patch: require('./functions/patch'),\n  prerelease: require('./functions/prerelease'),\n  compare: require('./functions/compare'),\n  rcompare: require('./functions/rcompare'),\n  compareLoose: require('./functions/compare-loose'),\n  compareBuild: require('./functions/compare-build'),\n  sort: require('./functions/sort'),\n  rsort: require('./functions/rsort'),\n  gt: require('./functions/gt'),\n  lt: require('./functions/lt'),\n  eq: require('./functions/eq'),\n  neq: require('./functions/neq'),\n  gte: require('./functions/gte'),\n  lte: require('./functions/lte'),\n  cmp: require('./functions/cmp'),\n  coerce: require('./functions/coerce'),\n  Comparator: require('./classes/comparator'),\n  Range: require('./classes/range'),\n  satisfies: require('./functions/satisfies'),\n  toComparators: require('./ranges/to-comparators'),\n  maxSatisfying: require('./ranges/max-satisfying'),\n  minSatisfying: require('./ranges/min-satisfying'),\n  minVersion: require('./ranges/min-version'),\n  validRange: require('./ranges/valid'),\n  outside: require('./ranges/outside'),\n  gtr: require('./ranges/gtr'),\n  ltr: require('./ranges/ltr'),\n  intersects: require('./ranges/intersects'),\n  simplifyRange: require('./ranges/simplify'),\n  subset: require('./ranges/subset'),\n}\n","// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nconst SEMVER_SPEC_VERSION = '2.0.0'\n\nconst MAX_LENGTH = 256\nconst MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER ||\n  /* istanbul ignore next */ 9007199254740991\n\n// Max safe segment length for coercion.\nconst MAX_SAFE_COMPONENT_LENGTH = 16\n\nmodule.exports = {\n  SEMVER_SPEC_VERSION,\n  MAX_LENGTH,\n  MAX_SAFE_INTEGER,\n  MAX_SAFE_COMPONENT_LENGTH\n}\n","const debug = (\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_DEBUG &&\n  /\\bsemver\\b/i.test(process.env.NODE_DEBUG)\n) ? (...args) => console.error('SEMVER', ...args)\n  : () => {}\n\nmodule.exports = debug\n","// parse out just the options we care about so we always get a consistent\n// obj with keys in a consistent order.\nconst opts = ['includePrerelease', 'loose', 'rtl']\nconst parseOptions = options =>\n  !options ? {}\n  : typeof options !== 'object' ? { loose: true }\n  : opts.filter(k => options[k]).reduce((options, k) => {\n    options[k] = true\n    return options\n  }, {})\nmodule.exports = parseOptions\n","const compare = require('./compare')\nconst gt = (a, b, loose) => compare(a, b, loose) > 0\nmodule.exports = gt\n","const ANY = Symbol('SemVer ANY')\n// hoisted class for cyclic dependency\nclass Comparator {\n  static get ANY () {\n    return ANY\n  }\n  constructor (comp, options) {\n    options = parseOptions(options)\n\n    if (comp instanceof Comparator) {\n      if (comp.loose === !!options.loose) {\n        return comp\n      } else {\n        comp = comp.value\n      }\n    }\n\n    debug('comparator', comp, options)\n    this.options = options\n    this.loose = !!options.loose\n    this.parse(comp)\n\n    if (this.semver === ANY) {\n      this.value = ''\n    } else {\n      this.value = this.operator + this.semver.version\n    }\n\n    debug('comp', this)\n  }\n\n  parse (comp) {\n    const r = this.options.loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n    const m = comp.match(r)\n\n    if (!m) {\n      throw new TypeError(`Invalid comparator: ${comp}`)\n    }\n\n    this.operator = m[1] !== undefined ? m[1] : ''\n    if (this.operator === '=') {\n      this.operator = ''\n    }\n\n    // if it literally is just '>' or '' then allow anything.\n    if (!m[2]) {\n      this.semver = ANY\n    } else {\n      this.semver = new SemVer(m[2], this.options.loose)\n    }\n  }\n\n  toString () {\n    return this.value\n  }\n\n  test (version) {\n    debug('Comparator.test', version, this.options.loose)\n\n    if (this.semver === ANY || version === ANY) {\n      return true\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    return cmp(version, this.operator, this.semver, this.options)\n  }\n\n  intersects (comp, options) {\n    if (!(comp instanceof Comparator)) {\n      throw new TypeError('a Comparator is required')\n    }\n\n    if (!options || typeof options !== 'object') {\n      options = {\n        loose: !!options,\n        includePrerelease: false\n      }\n    }\n\n    if (this.operator === '') {\n      if (this.value === '') {\n        return true\n      }\n      return new Range(comp.value, options).test(this.value)\n    } else if (comp.operator === '') {\n      if (comp.value === '') {\n        return true\n      }\n      return new Range(this.value, options).test(comp.semver)\n    }\n\n    const sameDirectionIncreasing =\n      (this.operator === '>=' || this.operator === '>') &&\n      (comp.operator === '>=' || comp.operator === '>')\n    const sameDirectionDecreasing =\n      (this.operator === '<=' || this.operator === '<') &&\n      (comp.operator === '<=' || comp.operator === '<')\n    const sameSemVer = this.semver.version === comp.semver.version\n    const differentDirectionsInclusive =\n      (this.operator === '>=' || this.operator === '<=') &&\n      (comp.operator === '>=' || comp.operator === '<=')\n    const oppositeDirectionsLessThan =\n      cmp(this.semver, '<', comp.semver, options) &&\n      (this.operator === '>=' || this.operator === '>') &&\n        (comp.operator === '<=' || comp.operator === '<')\n    const oppositeDirectionsGreaterThan =\n      cmp(this.semver, '>', comp.semver, options) &&\n      (this.operator === '<=' || this.operator === '<') &&\n        (comp.operator === '>=' || comp.operator === '>')\n\n    return (\n      sameDirectionIncreasing ||\n      sameDirectionDecreasing ||\n      (sameSemVer && differentDirectionsInclusive) ||\n      oppositeDirectionsLessThan ||\n      oppositeDirectionsGreaterThan\n    )\n  }\n}\n\nmodule.exports = Comparator\n\nconst parseOptions = require('../internal/parse-options')\nconst {re, t} = require('../internal/re')\nconst cmp = require('../functions/cmp')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst Range = require('./range')\n","const Range = require('../classes/range')\nconst satisfies = (version, range, options) => {\n  try {\n    range = new Range(range, options)\n  } catch (er) {\n    return false\n  }\n  return range.test(version)\n}\nmodule.exports = satisfies\n","module.exports = __WEBPACK_EXTERNAL_MODULE__31__;","const numeric = /^[0-9]+$/\nconst compareIdentifiers = (a, b) => {\n  const anum = numeric.test(a)\n  const bnum = numeric.test(b)\n\n  if (anum && bnum) {\n    a = +a\n    b = +b\n  }\n\n  return a === b ? 0\n    : (anum && !bnum) ? -1\n    : (bnum && !anum) ? 1\n    : a < b ? -1\n    : 1\n}\n\nconst rcompareIdentifiers = (a, b) => compareIdentifiers(b, a)\n\nmodule.exports = {\n  compareIdentifiers,\n  rcompareIdentifiers\n}\n","const compare = require('./compare')\nconst eq = (a, b, loose) => compare(a, b, loose) === 0\nmodule.exports = eq\n","const SemVer = require('../classes/semver')\nconst compareBuild = (a, b, loose) => {\n  const versionA = new SemVer(a, loose)\n  const versionB = new SemVer(b, loose)\n  return versionA.compare(versionB) || versionA.compareBuild(versionB)\n}\nmodule.exports = compareBuild\n","const compare = require('./compare')\nconst lt = (a, b, loose) => compare(a, b, loose) < 0\nmodule.exports = lt\n","const compare = require('./compare')\nconst gte = (a, b, loose) => compare(a, b, loose) >= 0\nmodule.exports = gte\n","const compare = require('./compare')\nconst lte = (a, b, loose) => compare(a, b, loose) <= 0\nmodule.exports = lte\n","const SemVer = require('../classes/semver')\nconst Comparator = require('../classes/comparator')\nconst {ANY} = Comparator\nconst Range = require('../classes/range')\nconst satisfies = require('../functions/satisfies')\nconst gt = require('../functions/gt')\nconst lt = require('../functions/lt')\nconst lte = require('../functions/lte')\nconst gte = require('../functions/gte')\n\nconst outside = (version, range, hilo, options) => {\n  version = new SemVer(version, options)\n  range = new Range(range, options)\n\n  let gtfn, ltefn, ltfn, comp, ecomp\n  switch (hilo) {\n    case '>':\n      gtfn = gt\n      ltefn = lte\n      ltfn = lt\n      comp = '>'\n      ecomp = '>='\n      break\n    case '<':\n      gtfn = lt\n      ltefn = gte\n      ltfn = gt\n      comp = '<'\n      ecomp = '<='\n      break\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"')\n  }\n\n  // If it satisfies the range it is not outside\n  if (satisfies(version, range, options)) {\n    return false\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let high = null\n    let low = null\n\n    comparators.forEach((comparator) => {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator\n      low = low || comparator\n      if (gtfn(comparator.semver, high.semver, options)) {\n        high = comparator\n      } else if (ltfn(comparator.semver, low.semver, options)) {\n        low = comparator\n      }\n    })\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false\n    }\n  }\n  return true\n}\n\nmodule.exports = outside\n","module.exports = __WEBPACK_EXTERNAL_MODULE__39__;","module.exports = __WEBPACK_EXTERNAL_MODULE__40__;","module.exports = __WEBPACK_EXTERNAL_MODULE__41__;","const compare = require('./compare')\nconst neq = (a, b, loose) => compare(a, b, loose) !== 0\nmodule.exports = neq\n","const eq = require('./eq')\nconst neq = require('./neq')\nconst gt = require('./gt')\nconst gte = require('./gte')\nconst lt = require('./lt')\nconst lte = require('./lte')\n\nconst cmp = (a, op, b, loose) => {\n  switch (op) {\n    case '===':\n      if (typeof a === 'object')\n        a = a.version\n      if (typeof b === 'object')\n        b = b.version\n      return a === b\n\n    case '!==':\n      if (typeof a === 'object')\n        a = a.version\n      if (typeof b === 'object')\n        b = b.version\n      return a !== b\n\n    case '':\n    case '=':\n    case '==':\n      return eq(a, b, loose)\n\n    case '!=':\n      return neq(a, b, loose)\n\n    case '>':\n      return gt(a, b, loose)\n\n    case '>=':\n      return gte(a, b, loose)\n\n    case '<':\n      return lt(a, b, loose)\n\n    case '<=':\n      return lte(a, b, loose)\n\n    default:\n      throw new TypeError(`Invalid operator: ${op}`)\n  }\n}\nmodule.exports = cmp\n","module.exports = __WEBPACK_EXTERNAL_MODULE__44__;","module.exports = __WEBPACK_EXTERNAL_MODULE__45__;","const parse = require('./parse')\nconst valid = (version, options) => {\n  const v = parse(version, options)\n  return v ? v.version : null\n}\nmodule.exports = valid\n","const parse = require('./parse')\nconst clean = (version, options) => {\n  const s = parse(version.trim().replace(/^[=v]+/, ''), options)\n  return s ? s.version : null\n}\nmodule.exports = clean\n","const SemVer = require('../classes/semver')\n\nconst inc = (version, release, options, identifier) => {\n  if (typeof (options) === 'string') {\n    identifier = options\n    options = undefined\n  }\n\n  try {\n    return new SemVer(version, options).inc(release, identifier).version\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = inc\n","const parse = require('./parse')\nconst eq = require('./eq')\n\nconst diff = (version1, version2) => {\n  if (eq(version1, version2)) {\n    return null\n  } else {\n    const v1 = parse(version1)\n    const v2 = parse(version2)\n    const hasPre = v1.prerelease.length || v2.prerelease.length\n    const prefix = hasPre ? 'pre' : ''\n    const defaultResult = hasPre ? 'prerelease' : ''\n    for (const key in v1) {\n      if (key === 'major' || key === 'minor' || key === 'patch') {\n        if (v1[key] !== v2[key]) {\n          return prefix + key\n        }\n      }\n    }\n    return defaultResult // may be undefined\n  }\n}\nmodule.exports = diff\n","const SemVer = require('../classes/semver')\nconst major = (a, loose) => new SemVer(a, loose).major\nmodule.exports = major\n","const SemVer = require('../classes/semver')\nconst minor = (a, loose) => new SemVer(a, loose).minor\nmodule.exports = minor\n","const SemVer = require('../classes/semver')\nconst patch = (a, loose) => new SemVer(a, loose).patch\nmodule.exports = patch\n","const parse = require('./parse')\nconst prerelease = (version, options) => {\n  const parsed = parse(version, options)\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null\n}\nmodule.exports = prerelease\n","const compare = require('./compare')\nconst rcompare = (a, b, loose) => compare(b, a, loose)\nmodule.exports = rcompare\n","const compare = require('./compare')\nconst compareLoose = (a, b) => compare(a, b, true)\nmodule.exports = compareLoose\n","const compareBuild = require('./compare-build')\nconst sort = (list, loose) => list.sort((a, b) => compareBuild(a, b, loose))\nmodule.exports = sort\n","const compareBuild = require('./compare-build')\nconst rsort = (list, loose) => list.sort((a, b) => compareBuild(b, a, loose))\nmodule.exports = rsort\n","const SemVer = require('../classes/semver')\nconst parse = require('./parse')\nconst {re, t} = require('../internal/re')\n\nconst coerce = (version, options) => {\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version === 'number') {\n    version = String(version)\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  options = options || {}\n\n  let match = null\n  if (!options.rtl) {\n    match = version.match(re[t.COERCE])\n  } else {\n    // Find the right-most coercible string that does not share\n    // a terminus with a more left-ward coercible string.\n    // Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'\n    //\n    // Walk through the string checking with a /g regexp\n    // Manually set the index so as to pick up overlapping matches.\n    // Stop when we get a match that ends at the string end, since no\n    // coercible string can be more right-ward without the same terminus.\n    let next\n    while ((next = re[t.COERCERTL].exec(version)) &&\n        (!match || match.index + match[0].length !== version.length)\n    ) {\n      if (!match ||\n            next.index + next[0].length !== match.index + match[0].length) {\n        match = next\n      }\n      re[t.COERCERTL].lastIndex = next.index + next[1].length + next[2].length\n    }\n    // leave it in a clean state\n    re[t.COERCERTL].lastIndex = -1\n  }\n\n  if (match === null)\n    return null\n\n  return parse(`${match[2]}.${match[3] || '0'}.${match[4] || '0'}`, options)\n}\nmodule.exports = coerce\n","'use strict'\n\n// A linked list to keep track of recently-used-ness\nconst Yallist = require('yallist')\n\nconst MAX = Symbol('max')\nconst LENGTH = Symbol('length')\nconst LENGTH_CALCULATOR = Symbol('lengthCalculator')\nconst ALLOW_STALE = Symbol('allowStale')\nconst MAX_AGE = Symbol('maxAge')\nconst DISPOSE = Symbol('dispose')\nconst NO_DISPOSE_ON_SET = Symbol('noDisposeOnSet')\nconst LRU_LIST = Symbol('lruList')\nconst CACHE = Symbol('cache')\nconst UPDATE_AGE_ON_GET = Symbol('updateAgeOnGet')\n\nconst naiveLength = () => 1\n\n// lruList is a yallist where the head is the youngest\n// item, and the tail is the oldest.  the list contains the Hit\n// objects as the entries.\n// Each Hit object has a reference to its Yallist.Node.  This\n// never changes.\n//\n// cache is a Map (or PseudoMap) that matches the keys to\n// the Yallist.Node object.\nclass LRUCache {\n  constructor (options) {\n    if (typeof options === 'number')\n      options = { max: options }\n\n    if (!options)\n      options = {}\n\n    if (options.max && (typeof options.max !== 'number' || options.max < 0))\n      throw new TypeError('max must be a non-negative number')\n    // Kind of weird to have a default max of Infinity, but oh well.\n    const max = this[MAX] = options.max || Infinity\n\n    const lc = options.length || naiveLength\n    this[LENGTH_CALCULATOR] = (typeof lc !== 'function') ? naiveLength : lc\n    this[ALLOW_STALE] = options.stale || false\n    if (options.maxAge && typeof options.maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n    this[MAX_AGE] = options.maxAge || 0\n    this[DISPOSE] = options.dispose\n    this[NO_DISPOSE_ON_SET] = options.noDisposeOnSet || false\n    this[UPDATE_AGE_ON_GET] = options.updateAgeOnGet || false\n    this.reset()\n  }\n\n  // resize the cache when the max changes.\n  set max (mL) {\n    if (typeof mL !== 'number' || mL < 0)\n      throw new TypeError('max must be a non-negative number')\n\n    this[MAX] = mL || Infinity\n    trim(this)\n  }\n  get max () {\n    return this[MAX]\n  }\n\n  set allowStale (allowStale) {\n    this[ALLOW_STALE] = !!allowStale\n  }\n  get allowStale () {\n    return this[ALLOW_STALE]\n  }\n\n  set maxAge (mA) {\n    if (typeof mA !== 'number')\n      throw new TypeError('maxAge must be a non-negative number')\n\n    this[MAX_AGE] = mA\n    trim(this)\n  }\n  get maxAge () {\n    return this[MAX_AGE]\n  }\n\n  // resize the cache when the lengthCalculator changes.\n  set lengthCalculator (lC) {\n    if (typeof lC !== 'function')\n      lC = naiveLength\n\n    if (lC !== this[LENGTH_CALCULATOR]) {\n      this[LENGTH_CALCULATOR] = lC\n      this[LENGTH] = 0\n      this[LRU_LIST].forEach(hit => {\n        hit.length = this[LENGTH_CALCULATOR](hit.value, hit.key)\n        this[LENGTH] += hit.length\n      })\n    }\n    trim(this)\n  }\n  get lengthCalculator () { return this[LENGTH_CALCULATOR] }\n\n  get length () { return this[LENGTH] }\n  get itemCount () { return this[LRU_LIST].length }\n\n  rforEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].tail; walker !== null;) {\n      const prev = walker.prev\n      forEachStep(this, fn, walker, thisp)\n      walker = prev\n    }\n  }\n\n  forEach (fn, thisp) {\n    thisp = thisp || this\n    for (let walker = this[LRU_LIST].head; walker !== null;) {\n      const next = walker.next\n      forEachStep(this, fn, walker, thisp)\n      walker = next\n    }\n  }\n\n  keys () {\n    return this[LRU_LIST].toArray().map(k => k.key)\n  }\n\n  values () {\n    return this[LRU_LIST].toArray().map(k => k.value)\n  }\n\n  reset () {\n    if (this[DISPOSE] &&\n        this[LRU_LIST] &&\n        this[LRU_LIST].length) {\n      this[LRU_LIST].forEach(hit => this[DISPOSE](hit.key, hit.value))\n    }\n\n    this[CACHE] = new Map() // hash of items by key\n    this[LRU_LIST] = new Yallist() // list of items in order of use recency\n    this[LENGTH] = 0 // length of items in the list\n  }\n\n  dump () {\n    return this[LRU_LIST].map(hit =>\n      isStale(this, hit) ? false : {\n        k: hit.key,\n        v: hit.value,\n        e: hit.now + (hit.maxAge || 0)\n      }).toArray().filter(h => h)\n  }\n\n  dumpLru () {\n    return this[LRU_LIST]\n  }\n\n  set (key, value, maxAge) {\n    maxAge = maxAge || this[MAX_AGE]\n\n    if (maxAge && typeof maxAge !== 'number')\n      throw new TypeError('maxAge must be a number')\n\n    const now = maxAge ? Date.now() : 0\n    const len = this[LENGTH_CALCULATOR](value, key)\n\n    if (this[CACHE].has(key)) {\n      if (len > this[MAX]) {\n        del(this, this[CACHE].get(key))\n        return false\n      }\n\n      const node = this[CACHE].get(key)\n      const item = node.value\n\n      // dispose of the old one before overwriting\n      // split out into 2 ifs for better coverage tracking\n      if (this[DISPOSE]) {\n        if (!this[NO_DISPOSE_ON_SET])\n          this[DISPOSE](key, item.value)\n      }\n\n      item.now = now\n      item.maxAge = maxAge\n      item.value = value\n      this[LENGTH] += len - item.length\n      item.length = len\n      this.get(key)\n      trim(this)\n      return true\n    }\n\n    const hit = new Entry(key, value, len, now, maxAge)\n\n    // oversized objects fall out of cache automatically.\n    if (hit.length > this[MAX]) {\n      if (this[DISPOSE])\n        this[DISPOSE](key, value)\n\n      return false\n    }\n\n    this[LENGTH] += hit.length\n    this[LRU_LIST].unshift(hit)\n    this[CACHE].set(key, this[LRU_LIST].head)\n    trim(this)\n    return true\n  }\n\n  has (key) {\n    if (!this[CACHE].has(key)) return false\n    const hit = this[CACHE].get(key).value\n    return !isStale(this, hit)\n  }\n\n  get (key) {\n    return get(this, key, true)\n  }\n\n  peek (key) {\n    return get(this, key, false)\n  }\n\n  pop () {\n    const node = this[LRU_LIST].tail\n    if (!node)\n      return null\n\n    del(this, node)\n    return node.value\n  }\n\n  del (key) {\n    del(this, this[CACHE].get(key))\n  }\n\n  load (arr) {\n    // reset the cache\n    this.reset()\n\n    const now = Date.now()\n    // A previous serialized cache has the most recent items first\n    for (let l = arr.length - 1; l >= 0; l--) {\n      const hit = arr[l]\n      const expiresAt = hit.e || 0\n      if (expiresAt === 0)\n        // the item was created without expiration in a non aged cache\n        this.set(hit.k, hit.v)\n      else {\n        const maxAge = expiresAt - now\n        // dont add already expired items\n        if (maxAge > 0) {\n          this.set(hit.k, hit.v, maxAge)\n        }\n      }\n    }\n  }\n\n  prune () {\n    this[CACHE].forEach((value, key) => get(this, key, false))\n  }\n}\n\nconst get = (self, key, doUse) => {\n  const node = self[CACHE].get(key)\n  if (node) {\n    const hit = node.value\n    if (isStale(self, hit)) {\n      del(self, node)\n      if (!self[ALLOW_STALE])\n        return undefined\n    } else {\n      if (doUse) {\n        if (self[UPDATE_AGE_ON_GET])\n          node.value.now = Date.now()\n        self[LRU_LIST].unshiftNode(node)\n      }\n    }\n    return hit.value\n  }\n}\n\nconst isStale = (self, hit) => {\n  if (!hit || (!hit.maxAge && !self[MAX_AGE]))\n    return false\n\n  const diff = Date.now() - hit.now\n  return hit.maxAge ? diff > hit.maxAge\n    : self[MAX_AGE] && (diff > self[MAX_AGE])\n}\n\nconst trim = self => {\n  if (self[LENGTH] > self[MAX]) {\n    for (let walker = self[LRU_LIST].tail;\n      self[LENGTH] > self[MAX] && walker !== null;) {\n      // We know that we're about to delete this one, and also\n      // what the next least recently used key will be, so just\n      // go ahead and set it now.\n      const prev = walker.prev\n      del(self, walker)\n      walker = prev\n    }\n  }\n}\n\nconst del = (self, node) => {\n  if (node) {\n    const hit = node.value\n    if (self[DISPOSE])\n      self[DISPOSE](hit.key, hit.value)\n\n    self[LENGTH] -= hit.length\n    self[CACHE].delete(hit.key)\n    self[LRU_LIST].removeNode(node)\n  }\n}\n\nclass Entry {\n  constructor (key, value, length, now, maxAge) {\n    this.key = key\n    this.value = value\n    this.length = length\n    this.now = now\n    this.maxAge = maxAge || 0\n  }\n}\n\nconst forEachStep = (self, fn, node, thisp) => {\n  let hit = node.value\n  if (isStale(self, hit)) {\n    del(self, node)\n    if (!self[ALLOW_STALE])\n      hit = undefined\n  }\n  if (hit)\n    fn.call(thisp, hit.value, hit.key, self)\n}\n\nmodule.exports = LRUCache\n","'use strict'\nmodule.exports = Yallist\n\nYallist.Node = Node\nYallist.create = Yallist\n\nfunction Yallist (list) {\n  var self = this\n  if (!(self instanceof Yallist)) {\n    self = new Yallist()\n  }\n\n  self.tail = null\n  self.head = null\n  self.length = 0\n\n  if (list && typeof list.forEach === 'function') {\n    list.forEach(function (item) {\n      self.push(item)\n    })\n  } else if (arguments.length > 0) {\n    for (var i = 0, l = arguments.length; i < l; i++) {\n      self.push(arguments[i])\n    }\n  }\n\n  return self\n}\n\nYallist.prototype.removeNode = function (node) {\n  if (node.list !== this) {\n    throw new Error('removing node which does not belong to this list')\n  }\n\n  var next = node.next\n  var prev = node.prev\n\n  if (next) {\n    next.prev = prev\n  }\n\n  if (prev) {\n    prev.next = next\n  }\n\n  if (node === this.head) {\n    this.head = next\n  }\n  if (node === this.tail) {\n    this.tail = prev\n  }\n\n  node.list.length--\n  node.next = null\n  node.prev = null\n  node.list = null\n\n  return next\n}\n\nYallist.prototype.unshiftNode = function (node) {\n  if (node === this.head) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var head = this.head\n  node.list = this\n  node.next = head\n  if (head) {\n    head.prev = node\n  }\n\n  this.head = node\n  if (!this.tail) {\n    this.tail = node\n  }\n  this.length++\n}\n\nYallist.prototype.pushNode = function (node) {\n  if (node === this.tail) {\n    return\n  }\n\n  if (node.list) {\n    node.list.removeNode(node)\n  }\n\n  var tail = this.tail\n  node.list = this\n  node.prev = tail\n  if (tail) {\n    tail.next = node\n  }\n\n  this.tail = node\n  if (!this.head) {\n    this.head = node\n  }\n  this.length++\n}\n\nYallist.prototype.push = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    push(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.unshift = function () {\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    unshift(this, arguments[i])\n  }\n  return this.length\n}\n\nYallist.prototype.pop = function () {\n  if (!this.tail) {\n    return undefined\n  }\n\n  var res = this.tail.value\n  this.tail = this.tail.prev\n  if (this.tail) {\n    this.tail.next = null\n  } else {\n    this.head = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.shift = function () {\n  if (!this.head) {\n    return undefined\n  }\n\n  var res = this.head.value\n  this.head = this.head.next\n  if (this.head) {\n    this.head.prev = null\n  } else {\n    this.tail = null\n  }\n  this.length--\n  return res\n}\n\nYallist.prototype.forEach = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.head, i = 0; walker !== null; i++) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.next\n  }\n}\n\nYallist.prototype.forEachReverse = function (fn, thisp) {\n  thisp = thisp || this\n  for (var walker = this.tail, i = this.length - 1; walker !== null; i--) {\n    fn.call(thisp, walker.value, i, this)\n    walker = walker.prev\n  }\n}\n\nYallist.prototype.get = function (n) {\n  for (var i = 0, walker = this.head; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.next\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.getReverse = function (n) {\n  for (var i = 0, walker = this.tail; walker !== null && i < n; i++) {\n    // abort out of the list early if we hit a cycle\n    walker = walker.prev\n  }\n  if (i === n && walker !== null) {\n    return walker.value\n  }\n}\n\nYallist.prototype.map = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.head; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.next\n  }\n  return res\n}\n\nYallist.prototype.mapReverse = function (fn, thisp) {\n  thisp = thisp || this\n  var res = new Yallist()\n  for (var walker = this.tail; walker !== null;) {\n    res.push(fn.call(thisp, walker.value, this))\n    walker = walker.prev\n  }\n  return res\n}\n\nYallist.prototype.reduce = function (fn, initial) {\n  var acc\n  var walker = this.head\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.head) {\n    walker = this.head.next\n    acc = this.head.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = 0; walker !== null; i++) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.next\n  }\n\n  return acc\n}\n\nYallist.prototype.reduceReverse = function (fn, initial) {\n  var acc\n  var walker = this.tail\n  if (arguments.length > 1) {\n    acc = initial\n  } else if (this.tail) {\n    walker = this.tail.prev\n    acc = this.tail.value\n  } else {\n    throw new TypeError('Reduce of empty list with no initial value')\n  }\n\n  for (var i = this.length - 1; walker !== null; i--) {\n    acc = fn(acc, walker.value, i)\n    walker = walker.prev\n  }\n\n  return acc\n}\n\nYallist.prototype.toArray = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.head; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.next\n  }\n  return arr\n}\n\nYallist.prototype.toArrayReverse = function () {\n  var arr = new Array(this.length)\n  for (var i = 0, walker = this.tail; walker !== null; i++) {\n    arr[i] = walker.value\n    walker = walker.prev\n  }\n  return arr\n}\n\nYallist.prototype.slice = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = 0, walker = this.head; walker !== null && i < from; i++) {\n    walker = walker.next\n  }\n  for (; walker !== null && i < to; i++, walker = walker.next) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.sliceReverse = function (from, to) {\n  to = to || this.length\n  if (to < 0) {\n    to += this.length\n  }\n  from = from || 0\n  if (from < 0) {\n    from += this.length\n  }\n  var ret = new Yallist()\n  if (to < from || to < 0) {\n    return ret\n  }\n  if (from < 0) {\n    from = 0\n  }\n  if (to > this.length) {\n    to = this.length\n  }\n  for (var i = this.length, walker = this.tail; walker !== null && i > to; i--) {\n    walker = walker.prev\n  }\n  for (; walker !== null && i > from; i--, walker = walker.prev) {\n    ret.push(walker.value)\n  }\n  return ret\n}\n\nYallist.prototype.splice = function (start, deleteCount, ...nodes) {\n  if (start > this.length) {\n    start = this.length - 1\n  }\n  if (start < 0) {\n    start = this.length + start;\n  }\n\n  for (var i = 0, walker = this.head; walker !== null && i < start; i++) {\n    walker = walker.next\n  }\n\n  var ret = []\n  for (var i = 0; walker && i < deleteCount; i++) {\n    ret.push(walker.value)\n    walker = this.removeNode(walker)\n  }\n  if (walker === null) {\n    walker = this.tail\n  }\n\n  if (walker !== this.head && walker !== this.tail) {\n    walker = walker.prev\n  }\n\n  for (var i = 0; i < nodes.length; i++) {\n    walker = insert(this, walker, nodes[i])\n  }\n  return ret;\n}\n\nYallist.prototype.reverse = function () {\n  var head = this.head\n  var tail = this.tail\n  for (var walker = head; walker !== null; walker = walker.prev) {\n    var p = walker.prev\n    walker.prev = walker.next\n    walker.next = p\n  }\n  this.head = tail\n  this.tail = head\n  return this\n}\n\nfunction insert (self, node, value) {\n  var inserted = node === self.head ?\n    new Node(value, null, node, self) :\n    new Node(value, node, node.next, self)\n\n  if (inserted.next === null) {\n    self.tail = inserted\n  }\n  if (inserted.prev === null) {\n    self.head = inserted\n  }\n\n  self.length++\n\n  return inserted\n}\n\nfunction push (self, item) {\n  self.tail = new Node(item, self.tail, null, self)\n  if (!self.head) {\n    self.head = self.tail\n  }\n  self.length++\n}\n\nfunction unshift (self, item) {\n  self.head = new Node(item, null, self.head, self)\n  if (!self.tail) {\n    self.tail = self.head\n  }\n  self.length++\n}\n\nfunction Node (value, prev, next, list) {\n  if (!(this instanceof Node)) {\n    return new Node(value, prev, next, list)\n  }\n\n  this.list = list\n  this.value = value\n\n  if (prev) {\n    prev.next = this\n    this.prev = prev\n  } else {\n    this.prev = null\n  }\n\n  if (next) {\n    next.prev = this\n    this.next = next\n  } else {\n    this.next = null\n  }\n}\n\ntry {\n  // add if support for Symbol.iterator is present\n  require('./iterator.js')(Yallist)\n} catch (er) {}\n","'use strict'\nmodule.exports = function (Yallist) {\n  Yallist.prototype[Symbol.iterator] = function* () {\n    for (let walker = this.head; walker; walker = walker.next) {\n      yield walker.value\n    }\n  }\n}\n","const Range = require('../classes/range')\n\n// Mostly just for testing and legacy API reasons\nconst toComparators = (range, options) =>\n  new Range(range, options).set\n    .map(comp => comp.map(c => c.value).join(' ').trim().split(' '))\n\nmodule.exports = toComparators\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\n\nconst maxSatisfying = (versions, range, options) => {\n  let max = null\n  let maxSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!max || maxSV.compare(v) === -1) {\n        // compare(max, v, true)\n        max = v\n        maxSV = new SemVer(max, options)\n      }\n    }\n  })\n  return max\n}\nmodule.exports = maxSatisfying\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst minSatisfying = (versions, range, options) => {\n  let min = null\n  let minSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!min || minSV.compare(v) === 1) {\n        // compare(min, v, true)\n        min = v\n        minSV = new SemVer(min, options)\n      }\n    }\n  })\n  return min\n}\nmodule.exports = minSatisfying\n","const SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst gt = require('../functions/gt')\n\nconst minVersion = (range, loose) => {\n  range = new Range(range, loose)\n\n  let minver = new SemVer('0.0.0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = new SemVer('0.0.0-0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = null\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let setMin = null\n    comparators.forEach((comparator) => {\n      // Clone to avoid manipulating the comparator's semver object.\n      const compver = new SemVer(comparator.semver.version)\n      switch (comparator.operator) {\n        case '>':\n          if (compver.prerelease.length === 0) {\n            compver.patch++\n          } else {\n            compver.prerelease.push(0)\n          }\n          compver.raw = compver.format()\n          /* fallthrough */\n        case '':\n        case '>=':\n          if (!setMin || gt(compver, setMin)) {\n            setMin = compver\n          }\n          break\n        case '<':\n        case '<=':\n          /* Ignore maximum versions */\n          break\n        /* istanbul ignore next */\n        default:\n          throw new Error(`Unexpected operation: ${comparator.operator}`)\n      }\n    })\n    if (setMin && (!minver || gt(minver, setMin)))\n      minver = setMin\n  }\n\n  if (minver && range.test(minver)) {\n    return minver\n  }\n\n  return null\n}\nmodule.exports = minVersion\n","const Range = require('../classes/range')\nconst validRange = (range, options) => {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, options).range || '*'\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = validRange\n","// Determine if version is greater than all the versions possible in the range.\nconst outside = require('./outside')\nconst gtr = (version, range, options) => outside(version, range, '>', options)\nmodule.exports = gtr\n","const outside = require('./outside')\n// Determine if version is less than all the versions possible in the range\nconst ltr = (version, range, options) => outside(version, range, '<', options)\nmodule.exports = ltr\n","const Range = require('../classes/range')\nconst intersects = (r1, r2, options) => {\n  r1 = new Range(r1, options)\n  r2 = new Range(r2, options)\n  return r1.intersects(r2)\n}\nmodule.exports = intersects\n","// given a set of versions and a range, create a \"simplified\" range\n// that includes the same versions that the original range does\n// If the original range is shorter than the simplified one, return that.\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\nmodule.exports = (versions, range, options) => {\n  const set = []\n  let min = null\n  let prev = null\n  const v = versions.sort((a, b) => compare(a, b, options))\n  for (const version of v) {\n    const included = satisfies(version, range, options)\n    if (included) {\n      prev = version\n      if (!min)\n        min = version\n    } else {\n      if (prev) {\n        set.push([min, prev])\n      }\n      prev = null\n      min = null\n    }\n  }\n  if (min)\n    set.push([min, null])\n\n  const ranges = []\n  for (const [min, max] of set) {\n    if (min === max)\n      ranges.push(min)\n    else if (!max && min === v[0])\n      ranges.push('*')\n    else if (!max)\n      ranges.push(`>=${min}`)\n    else if (min === v[0])\n      ranges.push(`<=${max}`)\n    else\n      ranges.push(`${min} - ${max}`)\n  }\n  const simplified = ranges.join(' || ')\n  const original = typeof range.raw === 'string' ? range.raw : String(range)\n  return simplified.length < original.length ? simplified : range\n}\n","const Range = require('../classes/range.js')\nconst { ANY } = require('../classes/comparator.js')\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\n\n// Complex range `r1 || r2 || ...` is a subset of `R1 || R2 || ...` iff:\n// - Every simple range `r1, r2, ...` is a subset of some `R1, R2, ...`\n//\n// Simple range `c1 c2 ...` is a subset of simple range `C1 C2 ...` iff:\n// - If c is only the ANY comparator\n//   - If C is only the ANY comparator, return true\n//   - Else return false\n// - Let EQ be the set of = comparators in c\n// - If EQ is more than one, return true (null set)\n// - Let GT be the highest > or >= comparator in c\n// - Let LT be the lowest < or <= comparator in c\n// - If GT and LT, and GT.semver > LT.semver, return true (null set)\n// - If EQ\n//   - If GT, and EQ does not satisfy GT, return true (null set)\n//   - If LT, and EQ does not satisfy LT, return true (null set)\n//   - If EQ satisfies every C, return true\n//   - Else return false\n// - If GT\n//   - If GT.semver is lower than any > or >= comp in C, return false\n//   - If GT is >=, and GT.semver does not satisfy every C, return false\n// - If LT\n//   - If LT.semver is greater than any < or <= comp in C, return false\n//   - If LT is <=, and LT.semver does not satisfy every C, return false\n// - If any C is a = range, and GT or LT are set, return false\n// - Else return true\n\nconst subset = (sub, dom, options) => {\n  if (sub === dom)\n    return true\n\n  sub = new Range(sub, options)\n  dom = new Range(dom, options)\n  let sawNonNull = false\n\n  OUTER: for (const simpleSub of sub.set) {\n    for (const simpleDom of dom.set) {\n      const isSub = simpleSubset(simpleSub, simpleDom, options)\n      sawNonNull = sawNonNull || isSub !== null\n      if (isSub)\n        continue OUTER\n    }\n    // the null set is a subset of everything, but null simple ranges in\n    // a complex range should be ignored.  so if we saw a non-null range,\n    // then we know this isn't a subset, but if EVERY simple range was null,\n    // then it is a subset.\n    if (sawNonNull)\n      return false\n  }\n  return true\n}\n\nconst simpleSubset = (sub, dom, options) => {\n  if (sub === dom)\n    return true\n\n  if (sub.length === 1 && sub[0].semver === ANY)\n    return dom.length === 1 && dom[0].semver === ANY\n\n  const eqSet = new Set()\n  let gt, lt\n  for (const c of sub) {\n    if (c.operator === '>' || c.operator === '>=')\n      gt = higherGT(gt, c, options)\n    else if (c.operator === '<' || c.operator === '<=')\n      lt = lowerLT(lt, c, options)\n    else\n      eqSet.add(c.semver)\n  }\n\n  if (eqSet.size > 1)\n    return null\n\n  let gtltComp\n  if (gt && lt) {\n    gtltComp = compare(gt.semver, lt.semver, options)\n    if (gtltComp > 0)\n      return null\n    else if (gtltComp === 0 && (gt.operator !== '>=' || lt.operator !== '<='))\n      return null\n  }\n\n  // will iterate one or zero times\n  for (const eq of eqSet) {\n    if (gt && !satisfies(eq, String(gt), options))\n      return null\n\n    if (lt && !satisfies(eq, String(lt), options))\n      return null\n\n    for (const c of dom) {\n      if (!satisfies(eq, String(c), options))\n        return false\n    }\n\n    return true\n  }\n\n  let higher, lower\n  let hasDomLT, hasDomGT\n  for (const c of dom) {\n    hasDomGT = hasDomGT || c.operator === '>' || c.operator === '>='\n    hasDomLT = hasDomLT || c.operator === '<' || c.operator === '<='\n    if (gt) {\n      if (c.operator === '>' || c.operator === '>=') {\n        higher = higherGT(gt, c, options)\n        if (higher === c && higher !== gt)\n          return false\n      } else if (gt.operator === '>=' && !satisfies(gt.semver, String(c), options))\n        return false\n    }\n    if (lt) {\n      if (c.operator === '<' || c.operator === '<=') {\n        lower = lowerLT(lt, c, options)\n        if (lower === c && lower !== lt)\n          return false\n      } else if (lt.operator === '<=' && !satisfies(lt.semver, String(c), options))\n        return false\n    }\n    if (!c.operator && (lt || gt) && gtltComp !== 0)\n      return false\n  }\n\n  // if there was a < or >, and nothing in the dom, then must be false\n  // UNLESS it was limited by another range in the other direction.\n  // Eg, >1.0.0 <1.0.1 is still a subset of <2.0.0\n  if (gt && hasDomLT && !lt && gtltComp !== 0)\n    return false\n\n  if (lt && hasDomGT && !gt && gtltComp !== 0)\n    return false\n\n  return true\n}\n\n// >=1.2.3 is lower than >1.2.3\nconst higherGT = (a, b, options) => {\n  if (!a)\n    return b\n  const comp = compare(a.semver, b.semver, options)\n  return comp > 0 ? a\n    : comp < 0 ? b\n    : b.operator === '>' && a.operator === '>=' ? b\n    : a\n}\n\n// <=1.2.3 is higher than <1.2.3\nconst lowerLT = (a, b, options) => {\n  if (!a)\n    return b\n  const comp = compare(a.semver, b.semver, options)\n  return comp < 0 ? a\n    : comp > 0 ? b\n    : b.operator === '<' && a.operator === '<=' ? b\n    : a\n}\n\nmodule.exports = subset\n","import _ from 'lodash';\nimport { ZabbixMetricsQuery } from './types';\nimport * as c from './constants';\n\n/**\n * Query format migration.\n * This module can detect query format version and make migration.\n */\n\nexport function isGrafana2target(target) {\n  if (!target.mode || target.mode === 0 || target.mode === 2) {\n    if ((target.hostFilter || target.itemFilter || target.downsampleFunction ||\n        (target.host && target.host.host)) &&\n      (target.item.filter === undefined && target.host.filter === undefined)) {\n      return true;\n    } else {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\nexport function migrateFrom2To3version(target: ZabbixMetricsQuery) {\n  target.group.filter = target.group.name === \"*\" ? \"/.*/\" : target.group.name;\n  target.host.filter = target.host.name === \"*\" ? convertToRegex(target.hostFilter) : target.host.name;\n  target.application.filter = target.application.name === \"*\" ? \"\" : target.application.name;\n  target.item.filter = target.item.name === \"All\" ? convertToRegex(target.itemFilter) : target.item.name;\n  return target;\n}\n\nfunction migratePercentileAgg(target) {\n  if (target.functions) {\n    for (const f of target.functions) {\n      if (f.def && f.def.name === 'percentil') {\n        f.def.name = 'percentile';\n      }\n    }\n  }\n}\n\nfunction migrateQueryType(target) {\n  if (target.queryType === undefined) {\n    if (target.mode === 'Metrics') {\n      // Explore mode\n      target.queryType = c.MODE_METRICS;\n    } else if (target.mode !== undefined) {\n      target.queryType = target.mode;\n      delete target.mode;\n    }\n  }\n\n  // queryType is a string in query model\n  if (typeof target.queryType === 'number') {\n    target.queryType = (target.queryType as number)?.toString();\n  }\n}\n\nfunction migrateSLA(target) {\n  if (target.queryType === c.MODE_ITSERVICE && !target.slaInterval) {\n    target.slaInterval = 'none';\n  }\n}\n\nfunction migrateProblemSort(target) {\n  if (target.options?.sortProblems === 'priority') {\n    target.options.sortProblems = 'severity';\n  }\n}\n\nfunction migrateApplications(target) {\n  if (!target.itemTag) {\n    target.itemTag = { filter: '' };\n    if (target.application?.filter) {\n      target.itemTag.filter = `Application: ${target.application?.filter}`;\n    }\n  }\n}\n\nexport function migrate(target) {\n  target.resultFormat = target.resultFormat || 'time_series';\n  target = fixTargetGroup(target);\n  if (isGrafana2target(target)) {\n    return migrateFrom2To3version(target);\n  }\n  migratePercentileAgg(target);\n  migrateQueryType(target);\n  migrateSLA(target);\n  migrateProblemSort(target);\n  migrateApplications(target);\n  return target;\n}\n\nfunction fixTargetGroup(target) {\n  if (target.group && Array.isArray(target.group)) {\n    target.group = { 'filter': \"\" };\n  }\n  return target;\n}\n\nfunction convertToRegex(str) {\n  if (str) {\n    return '/' + str + '/';\n  } else {\n    return '/.*/';\n  }\n}\n\nexport const DS_CONFIG_SCHEMA = 3;\n\nexport function migrateDSConfig(jsonData) {\n  if (!jsonData) {\n    jsonData = {};\n  }\n\n  if (!shouldMigrateDSConfig(jsonData)) {\n    return jsonData;\n  }\n\n  const oldVersion = jsonData.schema || 1;\n  jsonData.schema = DS_CONFIG_SCHEMA;\n\n  if (oldVersion < 2) {\n    const dbConnectionOptions = jsonData.dbConnection || {};\n    jsonData.dbConnectionEnable = dbConnectionOptions.enable || false;\n    jsonData.dbConnectionDatasourceId = dbConnectionOptions.datasourceId || null;\n    delete jsonData.dbConnection;\n  }\n\n  if (oldVersion < 3) {\n    jsonData.timeout = (jsonData.timeout as string) === \"\" ? null : Number(jsonData.timeout as string);\n  }\n\n  return jsonData;\n}\n\nfunction shouldMigrateDSConfig(jsonData): boolean {\n  if (jsonData.dbConnection && !_.isEmpty(jsonData.dbConnection)) {\n    return true;\n  }\n  if (jsonData.schema && jsonData.schema < DS_CONFIG_SCHEMA) {\n    return true;\n  }\n  return false;\n}\n","import _ from 'lodash';\nimport { isNumeric } from './utils';\n\nconst index = [];\nconst categories = {\n  Transform: [],\n  Aggregate: [],\n  Filter: [],\n  Trends: [],\n  Time: [],\n  Alias: [],\n  Special: []\n};\n\nfunction addFuncDef(funcDef) {\n  funcDef.params = funcDef.params || [];\n  funcDef.defaultParams = funcDef.defaultParams || [];\n\n  if (funcDef.category) {\n    categories[funcDef.category].push(funcDef);\n  }\n  index[funcDef.name] = funcDef;\n  index[funcDef.shortName || funcDef.name] = funcDef;\n}\n\n// Transform\n\naddFuncDef({\n  name: 'groupBy',\n  category: 'Transform',\n  params: [\n    { name: 'interval', type: 'string'},\n    { name: 'function', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median', 'first', 'last'] }\n  ],\n  defaultParams: ['1m', 'avg'],\n});\n\naddFuncDef({\n  name: 'scale',\n  category: 'Transform',\n  params: [\n    { name: 'factor', type: 'float', options: [100, 0.01, 10, -1]}\n  ],\n  defaultParams: [100],\n});\n\naddFuncDef({\n  name: 'offset',\n  category: 'Transform',\n  params: [\n    { name: 'delta', type: 'float', options: [-100, 100]}\n  ],\n  defaultParams: [100],\n});\n\naddFuncDef({\n  name: 'delta',\n  category: 'Transform',\n  params: [],\n  defaultParams: [],\n});\n\naddFuncDef({\n  name: 'rate',\n  category: 'Transform',\n  params: [],\n  defaultParams: [],\n});\n\naddFuncDef({\n  name: 'movingAverage',\n  category: 'Transform',\n  params: [\n    { name: 'factor', type: 'int', options: [6, 10, 60, 100, 600] }\n  ],\n  defaultParams: [10],\n});\n\naddFuncDef({\n  name: 'exponentialMovingAverage',\n  category: 'Transform',\n  params: [\n    { name: 'smoothing', type: 'float', options: [6, 10, 60, 100, 600] }\n  ],\n  defaultParams: [0.2],\n});\n\naddFuncDef({\n  name: 'percentile',\n  category: 'Transform',\n  params: [\n    { name: 'interval', type: 'string' },\n    { name: 'percent', type: 'float', options: [25, 50, 75, 90, 95, 99, 99.9] }\n  ],\n  defaultParams: ['1m', 95],\n});\n\naddFuncDef({\n  name: 'removeAboveValue',\n  category: 'Transform',\n  params: [\n    {name: 'number', type: 'float'},\n  ],\n  defaultParams: [0],\n});\n\naddFuncDef({\n  name: 'removeBelowValue',\n  category: 'Transform',\n  params: [\n    {name: 'number', type: 'float'},\n  ],\n  defaultParams: [0],\n});\n\naddFuncDef({\n  name: 'transformNull',\n  category: 'Transform',\n  params: [\n    {name: 'number', type: 'float'}\n  ],\n  defaultParams: [0],\n});\n\n// Aggregate\n\naddFuncDef({\n  name: 'aggregateBy',\n  category: 'Aggregate',\n  params: [\n    { name: 'interval', type: 'string' },\n    { name: 'function', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median', 'first', 'last'] }\n  ],\n  defaultParams: ['1m', 'avg'],\n});\n\naddFuncDef({\n  name: 'sumSeries',\n  category: 'Aggregate',\n  params: [],\n  defaultParams: [],\n});\n\naddFuncDef({\n  name: 'percentileAgg',\n  category: 'Aggregate',\n  params: [\n    { name: 'interval', type: 'string' },\n    { name: 'percent', type: 'float', options: [25, 50, 75, 90, 95, 99, 99.9] }\n  ],\n  defaultParams: ['1m', 95],\n});\n\n// Filter\n\naddFuncDef({\n  name: 'top',\n  category: 'Filter',\n  params: [\n    { name: 'number', type: 'int' },\n    { name: 'value', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median', 'first', 'last'] }\n  ],\n  defaultParams: [5, 'avg'],\n});\n\naddFuncDef({\n  name: 'bottom',\n  category: 'Filter',\n  params: [\n    { name: 'number', type: 'int' },\n    { name: 'value', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count', 'median', 'first', 'last'] }\n  ],\n  defaultParams: [5, 'avg'],\n});\n\naddFuncDef({\n  name: 'sortSeries',\n  category: 'Filter',\n  params: [\n    { name: 'direction', type: 'string', options: ['asc', 'desc'] }\n  ],\n  defaultParams: ['asc']\n});\n\n// Trends\n\naddFuncDef({\n  name: 'trendValue',\n  category: 'Trends',\n  params: [\n    { name: 'type', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count'] }\n  ],\n  defaultParams: ['avg'],\n});\n\n// Time\n\naddFuncDef({\n  name: 'timeShift',\n  category: 'Time',\n  params: [\n    { name: 'interval', type: 'string', options: ['24h', '7d', '1M', '+24h', '-24h']}\n  ],\n  defaultParams: ['24h'],\n});\n\n//Alias\n\naddFuncDef({\n  name: 'setAlias',\n  category: 'Alias',\n  params: [\n    { name: 'alias', type: 'string' }\n  ],\n  defaultParams: []\n});\n\naddFuncDef({\n  name: 'setAliasByRegex',\n  category: 'Alias',\n  params: [\n    { name: 'aliasByRegex', type: 'string' }\n  ],\n  defaultParams: []\n});\n\naddFuncDef({\n  name: 'replaceAlias',\n  category: 'Alias',\n  params: [\n    { name: 'regexp', type: 'string' },\n    { name: 'newAlias', type: 'string' }\n  ],\n  defaultParams: ['/(.*)/', '$1']\n});\n\n// Special\naddFuncDef({\n  name: 'consolidateBy',\n  category: 'Special',\n  params: [\n    { name: 'type', type: 'string', options: ['avg', 'min', 'max', 'sum', 'count'] }\n  ],\n  defaultParams: ['avg'],\n});\n\n_.each(categories, (funcList, catName) => {\n  categories[catName] = _.sortBy(funcList, 'name');\n});\n\nclass FuncInstance {\n  def: any;\n  params: any;\n  text: string;\n  added: boolean;\n\n  constructor(funcDef, params) {\n    this.def = funcDef;\n\n    if (params) {\n      this.params = params;\n    } else {\n      // Create with default params\n      this.params = [];\n      this.params = funcDef.defaultParams.slice(0);\n    }\n\n    this.updateText();\n  }\n\n  bindFunction(metricFunctions) {\n    const func = metricFunctions[this.def.name];\n    if (func) {\n\n      // Bind function arguments\n      let bindedFunc = func;\n      let param;\n      for (let i = 0; i < this.params.length; i++) {\n        param = this.params[i];\n\n        // Convert numeric params\n        if (this.def.params[i].type === 'int' ||\n            this.def.params[i].type === 'float') {\n          param = Number(param);\n        }\n        bindedFunc = _.partial(bindedFunc, param);\n      }\n      return bindedFunc;\n    } else {\n      throw { message: 'Method not found ' + this.def.name };\n    }\n  }\n\n  render(metricExp) {\n    const str = this.def.name + '(';\n    const parameters = _.map(this.params, (value, index) => {\n      const paramType = this.def.params[index].type;\n      if (paramType === 'int' ||\n          paramType === 'float' ||\n          paramType === 'value_or_series' ||\n          paramType === 'boolean') {\n        return value;\n      } else if (paramType === 'int_or_interval' && isNumeric(value)) {\n        return value;\n      }\n\n      return \"'\" + value + \"'\";\n\n    });\n\n    if (metricExp) {\n      parameters.unshift(metricExp);\n    }\n\n    return str + parameters.join(', ') + ')';\n  }\n\n  _hasMultipleParamsInString(strValue, index) {\n    if (strValue.indexOf(',') === -1) {\n      return false;\n    }\n\n    return this.def.params[index + 1] && this.def.params[index + 1].optional;\n  }\n\n  updateParam(strValue, index) {\n    // handle optional parameters\n    // if string contains ',' and next param is optional, split and update both\n    if (this._hasMultipleParamsInString(strValue, index)) {\n      _.each(strValue.split(','), (partVal, idx) => {\n        this.updateParam(partVal.trim(), idx);\n      });\n      return;\n    }\n\n    if (strValue === '' && this.def.params[index].optional) {\n      this.params.splice(index, 1);\n    }else {\n      this.params[index] = strValue;\n    }\n\n    this.updateText();\n  }\n\n  updateText() {\n    if (this.params.length === 0) {\n      this.text = this.def.name + '()';\n      return;\n    }\n\n    let text = this.def.name + '(';\n    text += this.params.join(', ');\n    text += ')';\n    this.text = text;\n  }\n}\n\nexport function createFuncInstance(funcDef, params?) {\n  if (_.isString(funcDef)) {\n    if (!index[funcDef]) {\n      throw { message: 'Method not found ' + name };\n    }\n    funcDef = index[funcDef];\n  }\n  return new FuncInstance(funcDef, params);\n}\n\nexport function getFuncDef(name) {\n  return index[name];\n}\n\nexport function getCategories() {\n  return categories;\n}\n","import _ from 'lodash';\nimport * as utils from './utils';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { DataFrame, FieldType, TIME_SERIES_VALUE_FIELD_NAME } from '@grafana/data';\n\nfunction setAlias(alias: string, frame: DataFrame) {\n  if (frame.fields?.length <= 2) {\n    const valueField = frame.fields.find(f => f.name === TIME_SERIES_VALUE_FIELD_NAME);\n    if (valueField?.config?.custom?.scopedVars) {\n      alias = getTemplateSrv().replace(alias, valueField?.config?.custom?.scopedVars);\n    }\n    frame.name = alias;\n    return frame;\n  }\n\n  for (let fieldIndex = 0; fieldIndex < frame.fields.length; fieldIndex++) {\n    const field = frame.fields[fieldIndex];\n    if (field.type !== FieldType.time) {\n      if (field?.config?.custom?.scopedVars) {\n        alias = getTemplateSrv().replace(alias, field?.config?.custom?.scopedVars);\n      }\n      field.name = alias;\n    }\n  }\n  return frame;\n}\n\nfunction replaceAlias(regexp: string, newAlias: string, frame: DataFrame) {\n  let pattern: string | RegExp;\n  if (utils.isRegex(regexp)) {\n    pattern = utils.buildRegex(regexp);\n  } else {\n    pattern = regexp;\n  }\n\n  if (frame.fields?.length <= 2) {\n    let alias = frame.name.replace(pattern, newAlias);\n    const valueField = frame.fields.find(f => f.name === TIME_SERIES_VALUE_FIELD_NAME);\n    if (valueField?.state?.scopedVars) {\n      alias = getTemplateSrv().replace(alias, valueField?.state?.scopedVars);\n    }\n    frame.name = alias;\n    return frame;\n  }\n\n  for (const field of frame.fields) {\n    if (field.type !== FieldType.time) {\n      let alias = field.name.replace(pattern, newAlias);\n      if (field?.state?.scopedVars) {\n        alias = getTemplateSrv().replace(alias, field?.state?.scopedVars);\n      }\n      field.name = alias;\n    }\n  }\n  return frame;\n}\n\nfunction setAliasByRegex(alias: string, frame: DataFrame) {\n  if (frame.fields?.length <= 2) {\n    try {\n      frame.name = extractText(frame.name, alias);\n    } catch (error) {\n      console.error('Failed to apply RegExp:', error?.message || error);\n    }\n    return frame;\n  }\n\n  for (const field of frame.fields) {\n    if (field.type !== FieldType.time) {\n      try {\n        field.name = extractText(field.name, alias);\n      } catch (error) {\n        console.error('Failed to apply RegExp:', error?.message || error);\n      }\n    }\n  }\n\n  return frame;\n}\n\nfunction extractText(str: string, pattern: string) {\n  const extractPattern = new RegExp(pattern);\n  const extractedValue = extractPattern.exec(str);\n  return extractedValue[0];\n}\n\nfunction timeShift(interval, range) {\n  const shift = utils.parseTimeShiftInterval(interval) / 1000;\n  return _.map(range, time => {\n    return time - shift;\n  });\n}\n\nconst metricFunctions = {\n  timeShift: timeShift,\n  setAlias: setAlias,\n  setAliasByRegex: setAliasByRegex,\n  replaceAlias: replaceAlias\n};\n\nexport default {\n  get metricFunctions() {\n    return metricFunctions;\n  }\n};\n","import _ from 'lodash';\nimport TableModel from 'grafana/app/core/table_model';\nimport * as c from './constants';\nimport * as utils from './utils';\nimport {\n  ArrayVector,\n  DataFrame,\n  dataFrameFromJSON,\n  DataFrameJSON,\n  Field,\n  FieldType,\n  getTimeField,\n  MutableDataFrame,\n  MutableField,\n  TIME_SERIES_TIME_FIELD_NAME,\n  TIME_SERIES_VALUE_FIELD_NAME,\n} from '@grafana/data';\nimport { ZabbixMetricsQuery } from './types';\n\n/**\n * Convert Zabbix API history.get response to Grafana format\n *\n * @return {Array}            Array of timeseries in Grafana format\n *                            {\n *                               target: \"Metric name\",\n *                               datapoints: [[<value>, <unixtime>], ...]\n *                            }\n */\nfunction convertHistory(history, items, addHostName, convertPointCallback) {\n  /**\n   * Response should be in the format:\n   * data: [\n   *          {\n   *             target: \"Metric name\",\n   *             datapoints: [[<value>, <unixtime>], ...]\n   *          }, ...\n   *       ]\n   */\n\n    // Group history by itemid\n  const grouped_history = _.groupBy(history, 'itemid');\n  const hosts = _.uniqBy(_.flatten(_.map(items, 'hosts')), 'hostid');  //uniqBy is needed to deduplicate\n\n  return _.map(grouped_history, (hist, itemid) => {\n    const item = _.find(items, { 'itemid': itemid }) as any;\n    let alias = item.name;\n\n    // Add scopedVars for using in alias functions\n    const scopedVars: any = {\n      '__zbx_item': { value: item.name },\n      '__zbx_item_name': { value: item.name },\n      '__zbx_item_key': { value: item.key_ },\n      '__zbx_item_interval': { value: item.delay },\n    };\n\n    if (_.keys(hosts).length > 0) {\n      const host = _.find(hosts, { 'hostid': item.hostid });\n      scopedVars['__zbx_host'] = { value: host.host };\n      scopedVars['__zbx_host_name'] = { value: host.name };\n\n      // Only add host when multiple hosts selected\n      if (_.keys(hosts).length > 1 && addHostName) {\n        alias = host.name + \": \" + alias;\n      }\n    }\n\n    return {\n      target: alias,\n      datapoints: _.map(hist, convertPointCallback),\n      scopedVars,\n      item\n    };\n  });\n}\n\nexport function seriesToDataFrame(timeseries, target: ZabbixMetricsQuery, valueMappings?: any[], fieldType?: FieldType): MutableDataFrame {\n  const { datapoints, scopedVars, target: seriesName, item } = timeseries;\n\n  const timeFiled: Field = {\n    name: TIME_SERIES_TIME_FIELD_NAME,\n    type: FieldType.time,\n    config: {\n      custom: {}\n    },\n    values: new ArrayVector<number>(datapoints.map(p => p[c.DATAPOINT_TS])),\n  };\n\n  let values: ArrayVector<number> | ArrayVector<string>;\n  if (fieldType === FieldType.string) {\n    values = new ArrayVector<string>(datapoints.map(p => p[c.DATAPOINT_VALUE]));\n  } else {\n    values = new ArrayVector<number>(datapoints.map(p => p[c.DATAPOINT_VALUE]));\n  }\n\n  const valueFiled: Field = {\n    name: TIME_SERIES_VALUE_FIELD_NAME,\n    type: fieldType ?? FieldType.number,\n    labels: {},\n    config: {\n      displayNameFromDS: seriesName,\n      custom: {}\n    },\n    values,\n  };\n\n  if (scopedVars) {\n    timeFiled.config.custom = {\n      itemInterval: scopedVars['__zbx_item_interval']?.value,\n    };\n\n    valueFiled.labels = {\n      host: scopedVars['__zbx_host_name']?.value,\n      item: scopedVars['__zbx_item']?.value,\n      item_key: scopedVars['__zbx_item_key']?.value,\n    };\n\n    valueFiled.config.custom = {\n      itemInterval: scopedVars['__zbx_item_interval']?.value,\n    };\n  }\n\n  if (item) {\n    // Try to use unit configured in Zabbix\n    const unit = utils.convertZabbixUnit(item.units);\n    if (unit) {\n      console.log(`Datasource: unit detected: ${unit} (${item.units})`);\n      valueFiled.config.unit = unit;\n\n      if (unit === 'percent') {\n        valueFiled.config.min = 0;\n        valueFiled.config.max = 100;\n      }\n    }\n\n    // Try to use value mapping from Zabbix\n    const mappings = utils.getValueMapping(item, valueMappings);\n    if (mappings && target.options?.useZabbixValueMapping) {\n      console.log(`Datasource: using Zabbix value mapping`);\n      valueFiled.config.mappings = mappings;\n    }\n  }\n\n  const fields: Field[] = [timeFiled, valueFiled];\n\n  const frame: DataFrame = {\n    name: seriesName,\n    refId: target.refId,\n    fields,\n    length: datapoints.length,\n  };\n\n  const mutableFrame = new MutableDataFrame(frame);\n  return mutableFrame;\n}\n\n// Converts DataResponse to the format which backend works with (for data processing)\nexport function dataResponseToTimeSeries(response: DataFrameJSON[], items, request) {\n  const series = [];\n  if (response.length === 0) {\n    return [];\n  }\n\n  for (const frameJSON of response) {\n    const frame = dataFrameFromJSON(frameJSON);\n    const { timeField, timeIndex } = getTimeField(frame);\n    for (let i = 0; i < frame.fields.length; i++) {\n      const field = frame.fields[i];\n      if (i === timeIndex || !field.values || !field.values.length) {\n        continue;\n      }\n\n      const s = [];\n      for (let j = 0; j < field.values.length; j++) {\n        const v = field.values.get(j);\n        if (v !== null) {\n          s.push({ time: timeField.values.get(j) / 1000, value: v });\n        }\n      }\n\n      const itemid = field.name;\n      const item = _.find(items, { 'itemid': itemid });\n\n      // Convert interval to nanoseconds in order to unmarshall it on the backend to time.Duration\n      let interval = request.intervalMs * 1000000;\n      const itemInterval = utils.parseItemInterval(item.delay) * 1000000;\n      // Provided interval is using for the data alignment, so it shouldn't be less than item update interval\n      interval = Math.max(interval, itemInterval);\n      if (interval === 0) {\n        interval = null;\n      }\n\n      let seriesName = item.name;\n      if (item.hosts?.length > 0) {\n        seriesName = `${item.hosts[0].name}: ${seriesName}`;\n      }\n\n      const timeSeriesData = {\n        ts: s,\n        meta: {\n          name: seriesName,\n          item,\n          interval,\n        }\n      };\n\n      series.push(timeSeriesData);\n    }\n  }\n\n  return series;\n}\n\nexport function itServiceResponseToTimeSeries(response: any, interval) {\n  const series = [];\n  if (response.length === 0) {\n    return [];\n  }\n\n  for (const s of response) {\n    const ts = [];\n\n    if (!s.datapoints) {\n      continue;\n    }\n\n    const dp = s.datapoints;\n    for (let i = 0; i < dp.length; i++) {\n      ts.push({ time: dp[i][1] / 1000, value: dp[i][0] });\n    }\n\n    // Convert interval to nanoseconds in order to unmarshall it on the backend to time.Duration\n    let intervalNS = utils.parseItemInterval(interval) * 1000000;\n    if (intervalNS === 0) {\n      intervalNS = null;\n    }\n\n    const timeSeriesData = {\n      ts: ts,\n      meta: {\n        name: s.target,\n        interval: null,\n        item: {},\n      }\n    };\n\n    series.push(timeSeriesData);\n  }\n\n  return series;\n}\n\nexport function isConvertibleToWide(data: DataFrame[]): boolean {\n  if (!data || data.length < 2) {\n    return false;\n  }\n\n  const first = data[0].fields.find(f => f.type === FieldType.time);\n  if (!first) {\n    return false;\n  }\n\n  for (let i = 1; i < data.length; i++) {\n    const timeField = data[i].fields.find(f => f.type === FieldType.time);\n\n    for (let j = 0; j < Math.min(data.length, 2); j++) {\n      if (timeField.values.get(j) !== first.values.get(j)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nexport function alignFrames(data: MutableDataFrame[]): MutableDataFrame[] {\n  if (!data || data.length === 0) {\n    return data;\n  }\n\n  // Get oldest time stamp for all frames\n  let minTimestamp = data[0].fields.find(f => f.name === TIME_SERIES_TIME_FIELD_NAME).values.get(0);\n  for (let i = 0; i < data.length; i++) {\n    const timeField = data[i].fields.find(f => f.name === TIME_SERIES_TIME_FIELD_NAME);\n    const firstTs = timeField.values.get(0);\n    if (firstTs < minTimestamp) {\n      minTimestamp = firstTs;\n    }\n  }\n\n  for (let i = 0; i < data.length; i++) {\n    const frame = data[i];\n    const timeField = frame.fields.find(f => f.name === TIME_SERIES_TIME_FIELD_NAME);\n    const valueField = frame.fields.find(f => f.name === TIME_SERIES_VALUE_FIELD_NAME);\n    const firstTs = timeField.values.get(0);\n\n    if (firstTs > minTimestamp) {\n      console.log('Data frames: adding missing points');\n      let timestamps = timeField.values.toArray();\n      let values = valueField.values.toArray();\n      const missingTimestamps = [];\n      const missingValues = [];\n      const frameInterval: number = timeField.config.custom?.itemInterval;\n      for (let j = minTimestamp; j < firstTs; j += frameInterval) {\n        missingTimestamps.push(j);\n        missingValues.push(null);\n      }\n\n      timestamps = missingTimestamps.concat(timestamps);\n      values = missingValues.concat(values);\n      timeField.values = new ArrayVector(timestamps);\n      valueField.values = new ArrayVector(values);\n    }\n  }\n\n  return data;\n}\n\nexport function convertToWide(data: MutableDataFrame[]): DataFrame[] {\n  const maxLengthIndex = getLongestFrame(data);\n  const timeField = data[maxLengthIndex].fields.find(f => f.type === FieldType.time);\n  if (!timeField) {\n    return [];\n  }\n\n  const fields: MutableField[] = [timeField];\n\n  for (let i = 0; i < data.length; i++) {\n    const valueField = data[i].fields.find(f => f.name === TIME_SERIES_VALUE_FIELD_NAME);\n    if (!valueField) {\n      continue;\n    }\n\n    valueField.name = data[i].name;\n\n    // Add null value to the end if series is shifted by 1 time frame\n    if (timeField.values.length - valueField.values.length === 1) {\n      valueField.values.add(null);\n    }\n    fields.push(valueField);\n  }\n\n  const frame: DataFrame = {\n    name: \"wide\",\n    fields,\n    length: timeField.values.length,\n  };\n\n  return [frame];\n}\n\nfunction getLongestFrame(data: MutableDataFrame[]): number {\n  let maxLengthIndex = 0;\n  let maxLength = 0;\n  for (let i = 0; i < data.length; i++) {\n    const timeField = data[i].fields.find(f => f.type === FieldType.time);\n    if (timeField.values.length > maxLength) {\n      maxLength = timeField.values.length;\n      maxLengthIndex = i;\n    }\n  }\n\n  return maxLengthIndex;\n}\n\nfunction sortTimeseries(timeseries) {\n  // Sort trend data, issue #202\n  _.forEach(timeseries, series => {\n    series.datapoints = _.sortBy(series.datapoints, point => point[c.DATAPOINT_TS]);\n  });\n  return timeseries;\n}\n\nfunction handleHistory(history, items, addHostName = true) {\n  return convertHistory(history, items, addHostName, convertHistoryPoint);\n}\n\nfunction handleTrends(history, items, valueType, addHostName = true) {\n  const convertPointCallback = _.partial(convertTrendPoint, valueType);\n  return convertHistory(history, items, addHostName, convertPointCallback);\n}\n\nfunction handleText(history, items, target, addHostName = true) {\n  const convertTextCallback = _.partial(convertText, target);\n  return convertHistory(history, items, addHostName, convertTextCallback);\n}\n\nfunction handleHistoryAsTable(history, items, target) {\n  const table: any = new TableModel();\n  table.addColumn({ text: 'Host' });\n  table.addColumn({ text: 'Item' });\n  table.addColumn({ text: 'Key' });\n  table.addColumn({ text: 'Last value' });\n\n  const grouped_history = _.groupBy(history, 'itemid');\n  _.each(items, (item) => {\n    const itemHistory = grouped_history[item.itemid] || [];\n    const lastPoint = _.last(itemHistory);\n    let lastValue = lastPoint ? lastPoint.value : null;\n\n    if (target.options.skipEmptyValues && (!lastValue || lastValue === '')) {\n      return;\n    }\n\n    // Regex-based extractor\n    if (target.textFilter) {\n      lastValue = extractText(lastValue, target.textFilter, target.useCaptureGroups);\n    }\n\n    let host: any = _.first(item.hosts);\n    host = host ? host.name : \"\";\n\n    table.rows.push([\n      host, item.name, item.key_, lastValue\n    ]);\n  });\n\n  return table;\n}\n\nfunction convertText(target, point) {\n  let value = point.value;\n\n  // Regex-based extractor\n  if (target.textFilter) {\n    value = extractText(point.value, target.textFilter, target.useCaptureGroups);\n  }\n\n  return [\n    value,\n    point.clock * 1000 + Math.round(point.ns / 1000000)\n  ];\n}\n\nfunction extractText(str, pattern, useCaptureGroups) {\n  const extractPattern = new RegExp(pattern);\n  const extractedValue = extractPattern.exec(str);\n  if (extractedValue) {\n    if (useCaptureGroups) {\n      return extractedValue[1];\n    } else {\n      return extractedValue[0];\n    }\n  }\n  return \"\";\n}\n\nfunction handleSLAResponse(itservice, slaProperty, slaObject) {\n  const targetSLA = slaObject[itservice.serviceid].sla;\n  if (slaProperty.property === 'status') {\n    const targetStatus = parseInt(slaObject[itservice.serviceid].status, 10);\n    return {\n      target: itservice.name + ' ' + slaProperty.name,\n      datapoints: [\n        [targetStatus, targetSLA[0].to * 1000]\n      ]\n    };\n  } else {\n    let i;\n    const slaArr = [];\n    for (i = 0; i < targetSLA.length; i++) {\n      if (i === 0) {\n        slaArr.push([targetSLA[i][slaProperty.property], targetSLA[i].from * 1000]);\n      }\n      slaArr.push([targetSLA[i][slaProperty.property], targetSLA[i].to * 1000]);\n    }\n    return {\n      target: itservice.name + ' ' + slaProperty.name,\n      datapoints: slaArr\n    };\n  }\n}\n\nfunction handleTriggersResponse(triggers, groups, timeRange) {\n  if (!_.isArray(triggers)) {\n    let triggersCount = null;\n    try {\n      triggersCount = Number(triggers);\n    } catch (err) {\n      console.log(\"Error when handling triggers count: \", err);\n    }\n    return {\n      target: \"triggers count\",\n      datapoints: [\n        [triggersCount, timeRange[1] * 1000]\n      ]\n    };\n  } else {\n    const stats = getTriggerStats(triggers);\n    const groupNames = _.map(groups, 'name');\n    const table: any = new TableModel();\n    table.addColumn({ text: 'Host group' });\n    _.each(_.orderBy(c.TRIGGER_SEVERITY, ['val'], ['desc']), (severity) => {\n      table.addColumn({ text: severity.text });\n    });\n    _.each(stats, (severity_stats, group) => {\n      if (_.includes(groupNames, group)) {\n        let row = _.map(_.orderBy(_.toPairs(severity_stats), (s) => s[0], ['desc']), (s) => s[1]);\n        row = _.concat([group], ...row);\n        table.rows.push(row);\n      }\n    });\n    return table;\n  }\n}\n\nfunction getTriggerStats(triggers) {\n  const groups = _.uniq(_.flattenDeep(_.map(triggers, (trigger) => _.map(trigger.groups, 'name'))));\n  // let severity = _.map(c.TRIGGER_SEVERITY, 'text');\n  const stats = {};\n  _.each(groups, (group) => {\n    stats[group] = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 }; // severity:count\n  });\n  _.each(triggers, (trigger) => {\n    _.each(trigger.groups, (group) => {\n      stats[group.name][trigger.priority]++;\n    });\n  });\n  return stats;\n}\n\nfunction convertHistoryPoint(point) {\n  // Value must be a number for properly work\n  return [\n    Number(point.value),\n    point.clock * 1000 + Math.round(point.ns / 1000000)\n  ];\n}\n\nfunction convertTrendPoint(valueType, point) {\n  let value;\n  switch (valueType) {\n    case \"min\":\n      value = point.value_min;\n      break;\n    case \"max\":\n      value = point.value_max;\n      break;\n    case \"avg\":\n      value = point.value_avg;\n      break;\n    case \"sum\":\n      value = point.value_avg * point.num;\n      break;\n    case \"count\":\n      value = point.num;\n      break;\n    default:\n      value = point.value_avg;\n  }\n\n  return [\n    Number(value),\n    point.clock * 1000\n  ];\n}\n\nexport default {\n  handleHistory,\n  convertHistory,\n  handleTrends,\n  handleText,\n  handleHistoryAsTable,\n  handleSLAResponse,\n  handleTriggersResponse,\n  sortTimeseries,\n  seriesToDataFrame,\n  dataResponseToTimeSeries,\n  itServiceResponseToTimeSeries,\n  isConvertibleToWide,\n  convertToWide,\n  alignFrames,\n};\n","import _ from 'lodash';\nimport * as utils from '../datasource-zabbix/utils';\nimport { DataFrame, Field, FieldType, ArrayVector } from '@grafana/data';\nimport { ZBXProblem, ZBXTrigger, ProblemDTO, ZBXEvent } from './types';\n\nexport function joinTriggersWithProblems(problems: ZBXProblem[], triggers: ZBXTrigger[]): ProblemDTO[] {\n  const problemDTOList: ProblemDTO[] = [];\n\n  for (let i = 0; i < problems.length; i++) {\n    const p = problems[i];\n    const triggerId = Number(p.objectid);\n    const t = triggers[triggerId];\n\n    if (t) {\n      const problemDTO: ProblemDTO = {\n        timestamp: Number(p.clock),\n        triggerid: p.objectid,\n        eventid: p.eventid,\n        name: p.name,\n        severity: p.severity,\n        acknowledged: p.acknowledged,\n        acknowledges: p.acknowledges,\n        tags: p.tags,\n        suppressed: p.suppressed,\n        suppression_data: p.suppression_data,\n        description: t.description,\n        comments: t.comments,\n        value: t.value,\n        groups: t.groups,\n        hosts: t.hosts,\n        items: t.items,\n        alerts: t.alerts,\n        url: t.url,\n        expression: t.expression,\n        correlation_mode: t.correlation_mode,\n        correlation_tag: t.correlation_tag,\n        manual_close: t.manual_close,\n        state: t.state,\n        error: t.error,\n      };\n\n      problemDTOList.push(problemDTO);\n    }\n\n  }\n\n  return problemDTOList;\n}\n\ninterface JoinOptions {\n  valueFromEvent?: boolean;\n}\n\nexport function joinTriggersWithEvents(events: ZBXEvent[], triggers: ZBXTrigger[], options?: JoinOptions): ProblemDTO[] {\n  const { valueFromEvent } = options;\n  const problemDTOList: ProblemDTO[] = [];\n\n  for (let i = 0; i < events.length; i++) {\n    const e = events[i];\n    const triggerId = Number(e.objectid);\n    const t = triggers[triggerId];\n\n    if (t) {\n      const problemDTO: ProblemDTO = {\n        value: valueFromEvent ? e.value : t.value,\n        timestamp: Number(e.clock),\n        triggerid: e.objectid,\n        eventid: e.eventid,\n        name: e.name,\n        severity: e.severity,\n        acknowledged: e.acknowledged,\n        acknowledges: e.acknowledges,\n        tags: e.tags,\n        suppressed: e.suppressed,\n        description: t.description,\n        comments: t.comments,\n        groups: t.groups,\n        hosts: t.hosts,\n        items: t.items,\n        alerts: t.alerts,\n        url: t.url,\n        expression: t.expression,\n        correlation_mode: t.correlation_mode,\n        correlation_tag: t.correlation_tag,\n        manual_close: t.manual_close,\n        state: t.state,\n        error: t.error,\n      };\n\n      problemDTOList.push(problemDTO);\n    }\n\n  }\n\n  return problemDTOList;\n}\n\nexport function setMaintenanceStatus(triggers) {\n  _.each(triggers, (trigger) => {\n    const maintenance_status = _.some(trigger.hosts, (host) => host.maintenance_status === '1');\n    trigger.maintenance = maintenance_status;\n  });\n  return triggers;\n}\n\nexport function setAckButtonStatus(triggers, showAckButton) {\n  _.each(triggers, (trigger) => {\n    trigger.showAckButton = showAckButton;\n  });\n  return triggers;\n}\n\nexport function addTriggerDataSource(triggers, target) {\n  _.each(triggers, (trigger) => {\n    trigger.datasource = target.datasource;\n  });\n  return triggers;\n}\n\nexport function addTriggerHostProxy(triggers, proxies) {\n  triggers.forEach(trigger => {\n    if (trigger.hosts && trigger.hosts.length) {\n      const host = trigger.hosts[0];\n      if (host.proxy_hostid !== '0') {\n        const hostProxy = proxies[host.proxy_hostid];\n        host.proxy = hostProxy ? hostProxy.host : '';\n      }\n    }\n  });\n  return triggers;\n}\n\nexport function filterTriggersPre(triggerList, replacedTarget) {\n  // Filter triggers by description\n  const triggerFilter = replacedTarget.trigger.filter;\n  if (triggerFilter) {\n    triggerList = filterTriggers(triggerList, triggerFilter);\n  }\n\n  // Filter by maintenance status\n  if (!replacedTarget.options.hostsInMaintenance) {\n    triggerList = _.filter(triggerList, (trigger) => !trigger.maintenance);\n  }\n\n  return triggerList;\n}\n\nfunction filterTriggers(triggers, triggerFilter) {\n  if (utils.isRegex(triggerFilter)) {\n    return _.filter(triggers, trigger => {\n      return utils.buildRegex(triggerFilter).test(trigger.description);\n    });\n  } else {\n    return _.filter(triggers, trigger => {\n      return trigger.description === triggerFilter;\n    });\n  }\n}\n\nexport function sortProblems(problems: ProblemDTO[], target) {\n  if (target.options?.sortProblems === 'severity') {\n    problems = _.orderBy(problems, ['severity', 'eventid'], ['desc', 'desc']);\n  } else if (target.options?.sortProblems === 'lastchange') {\n    problems = _.orderBy(problems, ['timestamp', 'eventid'], ['desc', 'desc']);\n  }\n  return problems;\n}\n\nexport function toDataFrame(problems: any[]): DataFrame {\n  const problemsField: Field<any> = {\n    name: 'Problems',\n    type: FieldType.other,\n    values: new ArrayVector(problems),\n    config: {\n      custom: {\n        type: 'problems',\n      },\n    },\n  };\n\n  const response: DataFrame = {\n    name: 'problems',\n    fields: [problemsField],\n    length: problems.length,\n  };\n\n  return response;\n}\n\nconst problemsHandler = {\n  addTriggerDataSource,\n  addTriggerHostProxy,\n  setMaintenanceStatus,\n  setAckButtonStatus,\n  filterTriggersPre,\n  sortProblems,\n  toDataFrame,\n  joinTriggersWithProblems,\n  joinTriggersWithEvents,\n};\n\nexport default problemsHandler;\n","/**\n * This module allows to deduplicate function calls with the same params and\n * cache result of function call.\n */\n\nexport class CachingProxy {\n  cacheEnabled: boolean;\n  ttl: number;\n  cache: any;\n  promises: any;\n\n  constructor(cacheOptions) {\n    this.cacheEnabled = cacheOptions.enabled;\n    this.ttl          = cacheOptions.ttl || 600000; // 10 minutes by default\n\n    // Internal objects for data storing\n    this.cache = {};\n    this.promises = {};\n  }\n\n  /**\n   * Check that result is present in the cache and is up to date or send request otherwise.\n   */\n  cacheRequest(func, funcName, funcScope) {\n    return cacheRequest(func, funcName, funcScope, this);\n  }\n\n  /**\n   * Wrap request to prevent multiple calls with same params when request is waiting for response.\n   */\n  proxify(func, funcName, funcScope) {\n    if (!this.promises[funcName]) {\n      this.promises[funcName] = {};\n    }\n    const promiseKeeper = this.promises[funcName];\n    return callOnce(func, promiseKeeper, funcScope);\n  }\n\n  proxifyWithCache(func, funcName, funcScope) {\n    const proxified = this.proxify(func, funcName, funcScope);\n    return this.cacheRequest(proxified, funcName, funcScope);\n  }\n\n  _isExpired(cacheObject) {\n    if (cacheObject) {\n      const object_age = Date.now() - cacheObject.timestamp;\n      return !(cacheObject.timestamp && object_age < this.ttl);\n    } else {\n      return true;\n    }\n  }\n}\n\n/**\n * Wrap request to prevent multiple calls\n * with same params when waiting for result.\n */\nfunction callOnce(func, promiseKeeper, funcScope) {\n  // tslint:disable-next-line: only-arrow-functions\n  return function() {\n    const hash = getRequestHash(arguments);\n    if (!promiseKeeper[hash]) {\n      promiseKeeper[hash] = Promise.resolve(\n        func.apply(funcScope, arguments)\n        .then(result => {\n          promiseKeeper[hash] = null;\n          return result;\n        }).catch(err => {\n          promiseKeeper[hash] = null;\n          throw err;\n        })\n      );\n    }\n    return promiseKeeper[hash];\n  };\n}\n\nfunction cacheRequest(func, funcName, funcScope, self) {\n  // tslint:disable-next-line: only-arrow-functions\n  return function() {\n    if (!self.cache[funcName]) {\n      self.cache[funcName] = {};\n    }\n\n    const cacheObject = self.cache[funcName];\n    const hash = getRequestHash(arguments);\n    if (self.cacheEnabled && !self._isExpired(cacheObject[hash])) {\n      return Promise.resolve(cacheObject[hash].value);\n    } else {\n      return func.apply(funcScope, arguments)\n      .then(result => {\n        if (result !== undefined) {\n          cacheObject[hash] = {\n            value: result,\n            timestamp: Date.now()\n          };\n        }\n        return result;\n      });\n    }\n  };\n}\n\nfunction getRequestHash(args) {\n  const argsJson = JSON.stringify(args);\n  return getHash(argsJson);\n}\n\nfunction getHash(str: string): number {\n  let hash = 0, i, chr, len;\n  if (str.length !== 0) {\n    for (i = 0, len = str.length; i < len; i++) {\n      chr   = str.charCodeAt(i);\n      hash  = ((hash << 5) - hash) + chr;\n      hash |= 0; // Convert to 32bit integer\n    }\n  }\n  return hash;\n}\n","import _ from 'lodash';\nimport { getDataSourceSrv } from '@grafana/runtime';\n\nexport const DEFAULT_QUERY_LIMIT = 10000;\n\nexport const HISTORY_TO_TABLE_MAP = {\n  '0': 'history',\n  '1': 'history_str',\n  '2': 'history_log',\n  '3': 'history_uint',\n  '4': 'history_text'\n};\n\nexport const TREND_TO_TABLE_MAP = {\n  '0': 'trends',\n  '3': 'trends_uint'\n};\n\nexport const consolidateByFunc = {\n  'avg': 'AVG',\n  'min': 'MIN',\n  'max': 'MAX',\n  'sum': 'SUM',\n  'count': 'COUNT'\n};\n\nexport const consolidateByTrendColumns = {\n  'avg': 'value_avg',\n  'min': 'value_min',\n  'max': 'value_max',\n  'sum': 'num*value_avg' // sum of sums inside the one-hour trend period\n};\n\nexport interface IDBConnector {\n  getHistory(): any;\n\n  getTrends(): any;\n\n  testDataSource(): any;\n}\n\n/**\n * Base class for external history database connectors. Subclasses should implement `getHistory()`, `getTrends()` and\n * `testDataSource()` methods, which describe how to fetch data from source other than Zabbix API.\n */\nexport class DBConnector {\n  protected datasourceId: any;\n  private datasourceName: any;\n  protected datasourceTypeId: any;\n  private datasourceTypeName: any;\n\n  constructor(options) {\n    this.datasourceId = options.datasourceId;\n    this.datasourceName = options.datasourceName;\n    this.datasourceTypeId = null;\n    this.datasourceTypeName = null;\n  }\n\n  static loadDatasource(dsId, dsName) {\n    if (!dsName && dsId !== undefined) {\n      const ds = _.find(getDataSourceSrv().getList(), { 'id': dsId });\n      if (!ds) {\n        return Promise.reject(`Data Source with ID ${dsId} not found`);\n      }\n      dsName = ds.name;\n    }\n    if (dsName) {\n      return getDataSourceSrv().get(dsName);\n    } else {\n      return Promise.reject(`Data Source name should be specified`);\n    }\n  }\n\n  loadDBDataSource() {\n    return DBConnector.loadDatasource(this.datasourceId, this.datasourceName)\n    .then(ds => {\n      this.datasourceTypeId = ds.meta.id;\n      this.datasourceTypeName = ds.meta.name;\n      if (!this.datasourceName) {\n        this.datasourceName = ds.name;\n      }\n      if (!this.datasourceId) {\n        this.datasourceId = ds.id;\n      }\n      return ds;\n    });\n  }\n}\n\nexport default {\n  DBConnector,\n  DEFAULT_QUERY_LIMIT,\n  HISTORY_TO_TABLE_MAP,\n  TREND_TO_TABLE_MAP,\n  consolidateByFunc,\n  consolidateByTrendColumns\n};\n","import _ from 'lodash';\nimport semver from 'semver';\nimport kbn from 'grafana/app/core/utils/kbn';\nimport * as utils from '../../../utils';\nimport { MIN_SLA_INTERVAL, ZBX_ACK_ACTION_ADD_MESSAGE, ZBX_ACK_ACTION_NONE } from '../../../constants';\nimport { ShowProblemTypes, ZBXProblem } from '../../../types';\nimport { APIExecuteScriptResponse, JSONRPCError, ZBXScript } from './types';\nimport { BackendSrvRequest, getBackendSrv } from '@grafana/runtime';\nimport { rangeUtil } from '@grafana/data';\n\nconst DEFAULT_ZABBIX_VERSION = '3.0.0';\n\n// Backward compatibility. Since Grafana 7.2 roundInterval() func was moved to @grafana/data package\nconst roundInterval: (interval: number) => number = rangeUtil?.roundInterval || kbn.roundInterval || kbn.round_interval;\n\n/**\n * Zabbix API Wrapper.\n * Creates Zabbix API instance with given parameters (url, credentials and other).\n * Wraps API calls and provides high-level methods.\n */\nexport class ZabbixAPIConnector {\n  backendAPIUrl: string;\n  requestOptions: { basicAuth: any; withCredentials: boolean; };\n  getTrend: (items: any, timeFrom: any, timeTill: any) => Promise<any[]>;\n  version: string;\n  getVersionPromise: Promise<string>;\n  datasourceId: number;\n\n  constructor(basicAuth: any, withCredentials: boolean, datasourceId: number) {\n    this.datasourceId = datasourceId;\n    this.backendAPIUrl = `/api/datasources/${this.datasourceId}/resources/zabbix-api`;\n\n    this.requestOptions = {\n      basicAuth: basicAuth,\n      withCredentials: withCredentials\n    };\n\n    this.getTrend = this.getTrend_ZBXNEXT1193;\n    //getTrend = getTrend_30;\n\n    this.initVersion();\n  }\n\n  //////////////////////////\n  // Core method wrappers //\n  //////////////////////////\n\n  request(method: string, params?: any) {\n    if (!this.version) {\n      return this.initVersion().then(() => this.request(method, params));\n    }\n\n    return this.backendAPIRequest(method, params);\n  }\n\n  async backendAPIRequest(method: string, params: any = {}) {\n    const requestOptions: BackendSrvRequest = {\n      url: this.backendAPIUrl,\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      hideFromInspector: false,\n      data: {\n        datasourceId: this.datasourceId,\n        method,\n        params,\n      },\n    };\n\n    // Set request options for basic auth\n    if (this.requestOptions.basicAuth || this.requestOptions.withCredentials) {\n      requestOptions.withCredentials = true;\n    }\n    if (this.requestOptions.basicAuth) {\n      requestOptions.headers.Authorization = this.requestOptions.basicAuth;\n    }\n\n    const response = await getBackendSrv().fetch<any>(requestOptions).toPromise();\n    return response?.data?.result;\n  }\n\n  /**\n   * Get Zabbix API version\n   */\n  getVersion() {\n    return this.backendAPIRequest('apiinfo.version');\n  }\n\n  initVersion(): Promise<string> {\n    if (!this.getVersionPromise) {\n      this.getVersionPromise = Promise.resolve(\n        this.getVersion().then(version => {\n          if (version) {\n            console.log(`Zabbix version detected: ${version}`);\n          } else {\n            console.log(`Failed to detect Zabbix version, use default ${DEFAULT_ZABBIX_VERSION}`);\n          }\n\n          this.version = version || DEFAULT_ZABBIX_VERSION;\n          this.getVersionPromise = null;\n          return version;\n        })\n      );\n    }\n    return this.getVersionPromise;\n  }\n\n  isZabbix54OrHigher() {\n    return semver.gte(this.version, '5.4.0');\n  }\n\n  ////////////////////////////////\n  // Zabbix API method wrappers //\n  ////////////////////////////////\n\n  acknowledgeEvent(eventid: string, message: string, action?: number, severity?: number) {\n    if (!action) {\n      action = semver.gte(this.version, '4.0.0') ? ZBX_ACK_ACTION_ADD_MESSAGE : ZBX_ACK_ACTION_NONE;\n    }\n\n    const params: any = {\n      eventids: eventid,\n      message: message,\n      action: action\n    };\n\n    if (severity !== undefined) {\n      params.severity = severity;\n    }\n\n    return this.request('event.acknowledge', params);\n  }\n\n  getGroups() {\n    const params = {\n      output: ['name'],\n      sortfield: 'name',\n      real_hosts: true\n    };\n\n    return this.request('hostgroup.get', params);\n  }\n\n  getHosts(groupids) {\n    const params: any = {\n      output: ['name', 'host'],\n      sortfield: 'name'\n    };\n    if (groupids) {\n      params.groupids = groupids;\n    }\n\n    return this.request('host.get', params);\n  }\n\n  async getApps(hostids): Promise<any[]> {\n    if (this.isZabbix54OrHigher()) {\n      return [];\n    }\n\n    const params = {\n      output: 'extend',\n      hostids: hostids\n    };\n\n    return this.request('application.get', params);\n  }\n\n  /**\n   * Get Zabbix items\n   * @param  {[type]} hostids  host ids\n   * @param  {[type]} appids   application ids\n   * @param  {String} itemtype 'num' or 'text'\n   * @return {[type]}          array of items\n   */\n  getItems(hostids, appids, itemtype) {\n    const params: any = {\n      output: [\n        'name',\n        'key_',\n        'value_type',\n        'hostid',\n        'status',\n        'state',\n        'units',\n        'valuemapid',\n        'delay'\n      ],\n      sortfield: 'name',\n      webitems: true,\n      filter: {},\n      selectHosts: ['hostid', 'name', 'host']\n    };\n    if (hostids) {\n      params.hostids = hostids;\n    }\n    if (appids) {\n      params.applicationids = appids;\n    }\n    if (itemtype === 'num') {\n      // Return only numeric metrics\n      params.filter.value_type = [0, 3];\n    }\n    if (itemtype === 'text') {\n      // Return only text metrics\n      params.filter.value_type = [1, 2, 4];\n    }\n\n    if (this.isZabbix54OrHigher()) {\n      params.selectTags = 'extend';\n    }\n\n    return this.request('item.get', params)\n    .then(utils.expandItems);\n  }\n\n  getItemsByIDs(itemids) {\n    const params: any = {\n      itemids: itemids,\n      output: [\n        'name',\n        'key_',\n        'value_type',\n        'hostid',\n        'status',\n        'state',\n        'units',\n        'valuemapid',\n        'delay'\n      ],\n      webitems: true,\n      selectHosts: ['hostid', 'name']\n    };\n\n    if (this.isZabbix54OrHigher()) {\n      params.selectTags = 'extend';\n    }\n\n    return this.request('item.get', params)\n    .then(items => utils.expandItems(items));\n  }\n\n  getMacros(hostids) {\n    const params = {\n      output: 'extend',\n      hostids: hostids\n    };\n\n    return this.request('usermacro.get', params);\n  }\n\n  getGlobalMacros() {\n    const params = {\n      output: 'extend',\n      globalmacro: true\n    };\n\n    return this.request('usermacro.get', params);\n  }\n\n  getLastValue(itemid) {\n    const params = {\n      output: ['lastvalue'],\n      itemids: itemid\n    };\n    return this.request('item.get', params)\n    .then(items => items.length ? items[0].lastvalue : null);\n  }\n\n  /**\n   * Perform history query from Zabbix API\n   *\n   * @param  {Array}  items       Array of Zabbix item objects\n   * @param  {Number} timeFrom   Time in seconds\n   * @param  {Number} timeTill   Time in seconds\n   * @return {Array}  Array of Zabbix history objects\n   */\n  getHistory(items, timeFrom, timeTill) {\n\n    // Group items by value type and perform request for each value type\n    const grouped_items = _.groupBy(items, 'value_type');\n    const promises = _.map(grouped_items, (items, value_type) => {\n      const itemids = _.map(items, 'itemid');\n      const params: any = {\n        output: 'extend',\n        history: value_type,\n        itemids: itemids,\n        sortfield: 'clock',\n        sortorder: 'ASC',\n        time_from: timeFrom\n      };\n\n      // Relative queries (e.g. last hour) don't include an end time\n      if (timeTill) {\n        params.time_till = timeTill;\n      }\n\n      return this.request('history.get', params);\n    });\n\n    return Promise.all(promises).then(_.flatten);\n  }\n\n  /**\n   * Perform trends query from Zabbix API\n   * Use trends api extension from ZBXNEXT-1193 patch.\n   *\n   * @param  {Array}  items       Array of Zabbix item objects\n   * @param  {Number} time_from   Time in seconds\n   * @param  {Number} time_till   Time in seconds\n   * @return {Array}  Array of Zabbix trend objects\n   */\n  getTrend_ZBXNEXT1193(items, timeFrom, timeTill) {\n\n    // Group items by value type and perform request for each value type\n    const grouped_items = _.groupBy(items, 'value_type');\n    const promises = _.map(grouped_items, (items, value_type) => {\n      const itemids = _.map(items, 'itemid');\n      const params: any = {\n        output: 'extend',\n        trend: value_type,\n        itemids: itemids,\n        sortfield: 'clock',\n        sortorder: 'ASC',\n        time_from: timeFrom\n      };\n\n      // Relative queries (e.g. last hour) don't include an end time\n      if (timeTill) {\n        params.time_till = timeTill;\n      }\n\n      return this.request('trend.get', params);\n    });\n\n    return Promise.all(promises).then(_.flatten);\n  }\n\n  getTrend_30(items, time_from, time_till, value_type) {\n    const self = this;\n    const itemids = _.map(items, 'itemid');\n\n    const params: any = {\n      output: [\"itemid\",\n        \"clock\",\n        value_type\n      ],\n      itemids: itemids,\n      time_from: time_from\n    };\n\n    // Relative queries (e.g. last hour) don't include an end time\n    if (time_till) {\n      params.time_till = time_till;\n    }\n\n    return self.request('trend.get', params);\n  }\n\n  getITService(serviceids?) {\n    const params = {\n      output: 'extend',\n      serviceids: serviceids\n    };\n    return this.request('service.get', params);\n  }\n\n  getSLA(serviceids, timeRange, options) {\n    const [timeFrom, timeTo] = timeRange;\n    let intervals = [{ from: timeFrom, to: timeTo }];\n    if (options.slaInterval === 'auto') {\n      const interval = getSLAInterval(options.intervalMs);\n      intervals = buildSLAIntervals(timeRange, interval);\n    } else if (options.slaInterval !== 'none') {\n      const interval = utils.parseInterval(options.slaInterval) / 1000;\n      intervals = buildSLAIntervals(timeRange, interval);\n    }\n\n    const params: any = {\n      serviceids,\n      intervals\n    };\n\n    return this.request('service.getsla', params);\n  }\n\n  getProblems(groupids, hostids, applicationids, options): Promise<ZBXProblem[]> {\n    const { timeFrom, timeTo, recent, severities, limit, acknowledged, tags } = options;\n\n    const params: any = {\n      output: 'extend',\n      selectAcknowledges: 'extend',\n      selectSuppressionData: 'extend',\n      selectTags: 'extend',\n      source: '0',\n      object: '0',\n      sortfield: ['eventid'],\n      sortorder: 'DESC',\n      evaltype: '0',\n      // preservekeys: '1',\n      groupids,\n      hostids,\n      applicationids,\n      recent,\n    };\n\n    if (severities) {\n      params.severities = severities;\n    }\n\n    if (acknowledged !== undefined) {\n      params.acknowledged = acknowledged;\n    }\n\n    if (tags) {\n      params.tags = tags;\n    }\n\n    if (limit) {\n      params.limit = limit;\n    }\n\n    if (timeFrom || timeTo) {\n      params.time_from = timeFrom;\n      params.time_till = timeTo;\n    }\n\n    return this.request('problem.get', params).then(utils.mustArray);\n  }\n\n  getTriggersByIds(triggerids: string[]) {\n    const params: any = {\n      output: 'extend',\n      triggerids: triggerids,\n      expandDescription: true,\n      expandData: true,\n      expandComment: true,\n      monitored: true,\n      skipDependent: true,\n      selectGroups: ['name'],\n      selectHosts: ['name', 'host', 'maintenance_status', 'proxy_hostid'],\n      selectItems: ['name', 'key_', 'lastvalue'],\n      // selectLastEvent: 'extend',\n      // selectTags: 'extend',\n      preservekeys: '1',\n    };\n\n    return this.request('trigger.get', params).then(utils.mustArray);\n  }\n\n  getTriggers(groupids, hostids, applicationids, options) {\n    const { showTriggers, maintenance, timeFrom, timeTo } = options;\n\n    const params: any = {\n      output: 'extend',\n      groupids: groupids,\n      hostids: hostids,\n      applicationids: applicationids,\n      expandDescription: true,\n      expandData: true,\n      expandComment: true,\n      monitored: true,\n      skipDependent: true,\n      //only_true: true,\n      filter: {\n        value: 1\n      },\n      selectGroups: ['name'],\n      selectHosts: ['name', 'host', 'maintenance_status', 'proxy_hostid'],\n      selectItems: ['name', 'key_', 'lastvalue'],\n      selectLastEvent: 'extend',\n      selectTags: 'extend'\n    };\n\n    if (showTriggers === ShowProblemTypes.Problems) {\n      params.filter.value = 1;\n    } else if (showTriggers === ShowProblemTypes.Recent || showTriggers === ShowProblemTypes.History) {\n      params.filter.value = [0, 1];\n    }\n\n    if (maintenance) {\n      params.maintenance = true;\n    }\n\n    if (timeFrom || timeTo) {\n      params.lastChangeSince = timeFrom;\n      params.lastChangeTill = timeTo;\n    }\n\n    return this.request('trigger.get', params);\n  }\n\n  getEvents(objectids, timeFrom, timeTo, showEvents, limit) {\n    const params: any = {\n      output: 'extend',\n      time_from: timeFrom,\n      time_till: timeTo,\n      objectids: objectids,\n      select_acknowledges: 'extend',\n      selectHosts: 'extend',\n      value: showEvents,\n    };\n\n    if (limit) {\n      params.limit = limit;\n      params.sortfield = 'clock';\n      params.sortorder = 'DESC';\n    }\n\n    return this.request('event.get', params).then(utils.mustArray);\n  }\n\n  getEventsHistory(groupids, hostids, applicationids, options) {\n    const { timeFrom, timeTo, severities, limit, value } = options;\n\n    const params: any = {\n      output: 'extend',\n      time_from: timeFrom,\n      time_till: timeTo,\n      value: '1',\n      source: '0',\n      object: '0',\n      evaltype: '0',\n      sortfield: ['eventid'],\n      sortorder: 'DESC',\n      select_acknowledges: 'extend',\n      selectTags: 'extend',\n      selectSuppressionData: ['maintenanceid', 'suppress_until'],\n      groupids,\n      hostids,\n      applicationids,\n    };\n\n    if (limit) {\n      params.limit = limit;\n    }\n\n    if (severities) {\n      params.severities = severities;\n    }\n\n    if (value) {\n      params.value = value;\n    }\n\n    return this.request('event.get', params).then(utils.mustArray);\n  }\n\n  getExtendedEventData(eventids) {\n    const params = {\n      output: 'extend',\n      eventids: eventids,\n      preservekeys: true,\n      select_acknowledges: 'extend',\n      selectTags: 'extend',\n      sortfield: 'clock',\n      sortorder: 'DESC'\n    };\n\n    return this.request('event.get', params);\n  }\n\n  getEventAlerts(eventids) {\n    const params = {\n      eventids: eventids,\n      output: [\n        'eventid',\n        'message',\n        'clock',\n        'error'\n      ],\n      selectUsers: true,\n    };\n\n    return this.request('alert.get', params);\n  }\n\n  getAcknowledges(eventids) {\n    const params = {\n      output: 'extend',\n      eventids: eventids,\n      preservekeys: true,\n      select_acknowledges: 'extend',\n      sortfield: 'clock',\n      sortorder: 'DESC'\n    };\n\n    return this.request('event.get', params)\n    .then(events => {\n      return _.filter(events, (event) => event.acknowledges.length);\n    });\n  }\n\n  getAlerts(itemids, timeFrom, timeTo) {\n    const params: any = {\n      output: 'extend',\n      itemids: itemids,\n      expandDescription: true,\n      expandData: true,\n      expandComment: true,\n      monitored: true,\n      skipDependent: true,\n      //only_true: true,\n      // filter: {\n      //   value: 1\n      // },\n      selectLastEvent: 'extend'\n    };\n\n    if (timeFrom || timeTo) {\n      params.lastChangeSince = timeFrom;\n      params.lastChangeTill = timeTo;\n    }\n\n    return this.request('trigger.get', params);\n  }\n\n  getHostAlerts(hostids, applicationids, options) {\n    const { minSeverity, acknowledged, count, timeFrom, timeTo } = options;\n    const params: any = {\n      output: 'extend',\n      hostids: hostids,\n      min_severity: minSeverity,\n      filter: { value: 1 },\n      expandDescription: true,\n      expandData: true,\n      expandComment: true,\n      monitored: true,\n      skipDependent: true,\n      selectLastEvent: 'extend',\n      selectGroups: 'extend',\n      selectHosts: ['host', 'name']\n    };\n\n    if (count && acknowledged !== 0 && acknowledged !== 1) {\n      params.countOutput = true;\n    }\n\n    if (applicationids && applicationids.length) {\n      params.applicationids = applicationids;\n    }\n\n    if (timeFrom || timeTo) {\n      params.lastChangeSince = timeFrom;\n      params.lastChangeTill = timeTo;\n    }\n\n    return this.request('trigger.get', params)\n    .then((triggers) => {\n      if (!count || acknowledged === 0 || acknowledged === 1) {\n        triggers = filterTriggersByAcknowledge(triggers, acknowledged);\n        if (count) {\n          triggers = triggers.length;\n        }\n      }\n      return triggers;\n    });\n  }\n\n  getProxies() {\n    const params = {\n      output: ['proxyid', 'host'],\n    };\n\n    return this.request('proxy.get', params);\n  }\n\n  getScripts(hostids: string[], options?: any): Promise<ZBXScript[]> {\n    const params: any = {\n      output: 'extend',\n      hostids,\n    };\n\n    return this.request('script.get', params).then(utils.mustArray);\n  }\n\n  executeScript(hostid: string, scriptid: string): Promise<APIExecuteScriptResponse> {\n    const params: any = {\n      hostid,\n      scriptid,\n    };\n\n    return this.request('script.execute', params);\n  }\n\n  getValueMappings() {\n    const params = {\n      output: 'extend',\n      selectMappings: \"extend\",\n    };\n\n    return this.request('valuemap.get', params);\n  }\n}\n\nfunction filterTriggersByAcknowledge(triggers, acknowledged) {\n  if (acknowledged === 0) {\n    return _.filter(triggers, (trigger) => trigger.lastEvent.acknowledged === \"0\");\n  } else if (acknowledged === 1) {\n    return _.filter(triggers, (trigger) => trigger.lastEvent.acknowledged === \"1\");\n  } else {\n    return triggers;\n  }\n}\n\nfunction getSLAInterval(intervalMs) {\n  // Too many intervals may cause significant load on the database, so decrease number of resulting points\n  const resolutionRatio = 100;\n  const interval = roundInterval(intervalMs * resolutionRatio) / 1000;\n  return Math.max(interval, MIN_SLA_INTERVAL);\n}\n\nfunction buildSLAIntervals(timeRange, interval) {\n  let [timeFrom, timeTo] = timeRange;\n  const intervals = [];\n\n  // Align time range with calculated interval\n  timeFrom = Math.floor(timeFrom / interval) * interval;\n  timeTo = Math.ceil(timeTo / interval) * interval;\n\n  for (let i = timeFrom; i <= timeTo - interval; i += interval) {\n    intervals.push({\n      from: i,\n      to: (i + interval)\n    });\n\n  }\n\n  return intervals;\n}\n\n// Define zabbix API exception type\nexport class ZabbixAPIError {\n  code: number;\n  name: string;\n  data: string;\n  message: string;\n\n  constructor(error: JSONRPCError) {\n    this.code = error.code || null;\n    this.name = error.message || \"\";\n    this.data = error.data || \"\";\n    this.message = \"Zabbix API Error: \" + this.name + \" \" + this.data;\n  }\n\n  toString() {\n    return this.name + \" \" + this.data;\n  }\n}\n","/**\n * MySQL queries\n */\n\nfunction historyQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction) {\n  const time_expression = `clock DIV ${intervalSec} * ${intervalSec}`;\n  return `\n      SELECT CAST(itemid AS CHAR) AS metric, ${time_expression} AS time_sec, ${aggFunction}(value) AS value\n      FROM ${table}\n      WHERE itemid IN (${itemids})\n        AND clock\n          > ${timeFrom}\n        AND clock\n          < ${timeTill}\n      GROUP BY ${time_expression}, metric\n      ORDER BY time_sec ASC\n  `;\n}\n\nfunction trendsQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction, valueColumn) {\n  const time_expression = `clock DIV ${intervalSec} * ${intervalSec}`;\n  return `\n      SELECT CAST(itemid AS CHAR) AS metric, ${time_expression} AS time_sec, ${aggFunction}(${valueColumn}) AS value\n      FROM ${table}\n      WHERE itemid IN (${itemids})\n        AND clock\n          > ${timeFrom}\n        AND clock\n          < ${timeTill}\n      GROUP BY ${time_expression}, metric\n      ORDER BY time_sec ASC\n  `;\n}\n\nfunction testQuery() {\n  return `SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value\n          FROM trends_uint LIMIT 1`;\n}\n\nconst mysql = {\n  historyQuery,\n  trendsQuery,\n  testQuery\n};\n\nexport default mysql;\n","/**\n * Postgres queries\n */\n\nconst ITEMID_FORMAT = 'FM99999999999999999999';\n\nfunction historyQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction) {\n  const time_expression = `clock / ${intervalSec} * ${intervalSec}`;\n  return `\n      SELECT to_char(itemid, '${ITEMID_FORMAT}') AS metric, ${time_expression} AS time, ${aggFunction}(value) AS value\n      FROM ${table}\n      WHERE itemid IN (${itemids})\n        AND clock\n          > ${timeFrom}\n        AND clock\n          < ${timeTill}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `;\n}\n\nfunction trendsQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction, valueColumn) {\n  const time_expression = `clock / ${intervalSec} * ${intervalSec}`;\n  return `\n      SELECT to_char(itemid, '${ITEMID_FORMAT}') AS metric, ${time_expression} AS time, ${aggFunction}(${valueColumn}) AS value\n      FROM ${table}\n      WHERE itemid IN (${itemids})\n        AND clock\n          > ${timeFrom}\n        AND clock\n          < ${timeTill}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `;\n}\n\nconst TEST_QUERY = `\n    SELECT to_char(itemid, '${ITEMID_FORMAT}') AS metric, clock AS time, value_avg AS value\n    FROM trends_uint LIMIT 1\n`;\n\nfunction testQuery() {\n  return TEST_QUERY;\n}\n\nconst postgres = {\n  historyQuery,\n  trendsQuery,\n  testQuery\n};\n\nexport default postgres;\n","import _ from 'lodash';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { compactQuery } from '../../../utils';\nimport mysql from './mysql';\nimport postgres from './postgres';\nimport dbConnector, { DBConnector, DEFAULT_QUERY_LIMIT, HISTORY_TO_TABLE_MAP, TREND_TO_TABLE_MAP } from '../dbConnector';\n\nconst supportedDatabases = {\n  mysql: 'mysql',\n  postgres: 'postgres'\n};\n\nexport class SQLConnector extends DBConnector {\n  private limit: number;\n  private sqlDialect: any;\n\n  constructor(options) {\n    super(options);\n\n    this.limit = options.limit || DEFAULT_QUERY_LIMIT;\n    this.sqlDialect = null;\n\n    super.loadDBDataSource()\n    .then(() => {\n      this.loadSQLDialect();\n    });\n  }\n\n  loadSQLDialect() {\n    if (this.datasourceTypeId === supportedDatabases.postgres) {\n      this.sqlDialect = postgres;\n    } else {\n      this.sqlDialect = mysql;\n    }\n  }\n\n  /**\n   * Try to invoke test query for one of Zabbix database tables.\n   */\n  testDataSource() {\n    const testQuery = this.sqlDialect.testQuery();\n    return this.invokeSQLQuery(testQuery);\n  }\n\n  getHistory(items, timeFrom, timeTill, options) {\n    const { aggFunction, intervalSec } = getAggFunc(timeFrom, timeTill, options);\n\n    // Group items by value type and perform request for each value type\n    const grouped_items = _.groupBy(items, 'value_type');\n    const promises = _.map(grouped_items, (items, value_type) => {\n      const itemids = _.map(items, 'itemid').join(', ');\n      const table = HISTORY_TO_TABLE_MAP[value_type];\n      let query = this.sqlDialect.historyQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction);\n\n      query = compactQuery(query);\n      return this.invokeSQLQuery(query);\n    });\n\n    return Promise.all(promises).then(results => {\n      return _.flatten(results);\n    });\n  }\n\n  getTrends(items, timeFrom, timeTill, options) {\n    const { consolidateBy } = options;\n    const { aggFunction, intervalSec } = getAggFunc(timeFrom, timeTill, options);\n\n    // Group items by value type and perform request for each value type\n    const grouped_items = _.groupBy(items, 'value_type');\n    const promises = _.map(grouped_items, (items, value_type) => {\n      const itemids = _.map(items, 'itemid').join(', ');\n      const table = TREND_TO_TABLE_MAP[value_type];\n      let valueColumn = _.includes(['avg', 'min', 'max', 'sum'], consolidateBy) ? consolidateBy : 'avg';\n      valueColumn = dbConnector.consolidateByTrendColumns[valueColumn];\n      let query = this.sqlDialect.trendsQuery(itemids, table, timeFrom, timeTill, intervalSec, aggFunction, valueColumn);\n\n      query = compactQuery(query);\n      return this.invokeSQLQuery(query);\n    });\n\n    return Promise.all(promises).then(results => {\n      return _.flatten(results);\n    });\n  }\n\n  invokeSQLQuery(query) {\n    const queryDef = {\n      refId: 'A',\n      format: 'time_series',\n      datasourceId: this.datasourceId,\n      rawSql: query,\n      maxDataPoints: this.limit\n    };\n\n    return getBackendSrv().datasourceRequest({\n      url: '/api/ds/query',\n      method: 'POST',\n      data: {\n        queries: [queryDef],\n      }\n    })\n    .then(response => {\n      const results = response.data.results;\n      if (results['A']) {\n        return results['A'].frames;\n      } else {\n        return null;\n      }\n    });\n  }\n}\n\nfunction getAggFunc(timeFrom, timeTill, options) {\n  const { intervalMs } = options;\n  let { consolidateBy } = options;\n  let intervalSec = Math.ceil(intervalMs / 1000);\n\n  // The interval must match the time range exactly n times, otherwise\n  // the resulting first and last data points will yield invalid values in the\n  // calculated average value in downsampleSeries - when using consolidateBy(avg)\n  const numOfIntervals = Math.ceil((timeTill - timeFrom) / intervalSec);\n  intervalSec = (timeTill - timeFrom) / numOfIntervals;\n\n  consolidateBy = consolidateBy || 'avg';\n  const aggFunction = dbConnector.consolidateByFunc[consolidateBy];\n  return { aggFunction, intervalSec };\n}\n","import _ from 'lodash';\nimport { compactQuery } from '../../../utils';\nimport { consolidateByTrendColumns, DBConnector, HISTORY_TO_TABLE_MAP } from '../dbConnector';\n\nconst consolidateByFunc = {\n  'avg': 'MEAN',\n  'min': 'MIN',\n  'max': 'MAX',\n  'sum': 'SUM',\n  'count': 'COUNT'\n};\n\nexport class InfluxDBConnector extends DBConnector {\n  private retentionPolicy: any;\n  private influxDS: any;\n\n  constructor(options) {\n    super(options);\n    this.retentionPolicy = options.retentionPolicy;\n    super.loadDBDataSource().then(ds => {\n      this.influxDS = ds;\n      return ds;\n    });\n  }\n\n  /**\n   * Try to invoke test query for one of Zabbix database tables.\n   */\n  testDataSource() {\n    return this.influxDS.testDatasource().then(result => {\n      if (result.status && result.status === 'error') {\n        return Promise.reject({\n          data: {\n            message: `InfluxDB connection error: ${result.message}`\n          }\n        });\n      }\n      return result;\n    });\n  }\n\n  getHistory(items, timeFrom, timeTill, options) {\n    const { intervalMs, retentionPolicy } = options;\n    let { consolidateBy } = options;\n    const intervalSec = Math.ceil(intervalMs / 1000);\n\n    const range = { timeFrom, timeTill };\n    consolidateBy = consolidateBy || 'avg';\n\n    // Group items by value type and perform request for each value type\n    const grouped_items = _.groupBy(items, 'value_type');\n    const promises = _.map(grouped_items, (items, value_type) => {\n      const itemids = _.map(items, 'itemid');\n      const table = HISTORY_TO_TABLE_MAP[value_type];\n      const query = this.buildHistoryQuery(itemids, table, range, intervalSec, consolidateBy, retentionPolicy);\n      return this.invokeInfluxDBQuery(query);\n    });\n\n    return Promise.all(promises)\n    .then(_.flatten)\n    .then(results => {\n      return handleInfluxHistoryResponse(results);\n    });\n  }\n\n  getTrends(items, timeFrom, timeTill, options) {\n    options.retentionPolicy = this.retentionPolicy;\n    return this.getHistory(items, timeFrom, timeTill, options);\n  }\n\n  buildHistoryQuery(itemids, table, range, intervalSec, aggFunction, retentionPolicy) {\n    const { timeFrom, timeTill } = range;\n    const measurement = retentionPolicy ? `\"${retentionPolicy}\".\"${table}\"` : `\"${table}\"`;\n    let value = 'value';\n    if (retentionPolicy) {\n      value = consolidateByTrendColumns[aggFunction] || 'value_avg';\n    }\n    const aggregation = consolidateByFunc[aggFunction] || aggFunction;\n    const where_clause = this.buildWhereClause(itemids);\n    const query = `SELECT ${aggregation}(\"${value}\")\n                   FROM ${measurement}\n                   WHERE ${where_clause}\n                     AND \"time\" >= ${timeFrom}s\n                     AND \"time\" <= ${timeTill}s\n                   GROUP BY time(${intervalSec}s), \"itemid\" fill(none)`;\n    return compactQuery(query);\n  }\n\n  buildWhereClause(itemids) {\n    const itemidsWhere = itemids.map(itemid => `\"itemid\" = '${itemid}'`).join(' OR ');\n    return `(${itemidsWhere})`;\n  }\n\n  invokeInfluxDBQuery(query) {\n    return this.influxDS._seriesQuery(query)\n    .then(data => data && data.results ? data.results : []);\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\nfunction handleInfluxHistoryResponse(results) {\n  if (!results) {\n    return [];\n  }\n\n  const seriesList = [];\n  for (let i = 0; i < results.length; i++) {\n    const result = results[i];\n\n    if (result.error) {\n      const error = `InfluxDB error: ${result.error}`;\n      return Promise.reject(new Error(error));\n    }\n\n    if (!result || !result.series) {\n      continue;\n    }\n\n    const influxSeriesList = results[i].series;\n\n    for (let y = 0; y < influxSeriesList.length; y++) {\n      const influxSeries = influxSeriesList[y];\n      const datapoints = [];\n      if (influxSeries.values) {\n        for (i = 0; i < influxSeries.values.length; i++) {\n          datapoints[i] = [influxSeries.values[i][1], influxSeries.values[i][0]];\n        }\n      }\n      const timeSeries = {\n        name: influxSeries.tags.itemid,\n        points: datapoints\n      };\n      seriesList.push(timeSeries);\n    }\n  }\n\n  return seriesList;\n}\n","import _ from 'lodash';\nimport moment from 'moment';\nimport semver from 'semver';\nimport * as utils from '../utils';\nimport responseHandler from '../responseHandler';\nimport { CachingProxy } from './proxy/cachingProxy';\nimport { DBConnector } from './connectors/dbConnector';\nimport { ZabbixAPIConnector } from './connectors/zabbix_api/zabbixAPIConnector';\nimport { SQLConnector } from './connectors/sql/sqlConnector';\nimport { InfluxDBConnector } from './connectors/influxdb/influxdbConnector';\nimport { ZabbixConnector } from './types';\nimport { joinTriggersWithEvents, joinTriggersWithProblems } from '../problemsHandler';\nimport { ProblemDTO, ZBXItem, ZBXItemTag } from '../types';\n\ninterface AppsResponse extends Array<any> {\n  appFilterEmpty?: boolean;\n  hostids?: any[];\n}\n\nconst REQUESTS_TO_PROXYFY = [\n  'getHistory', 'getTrend', 'getGroups', 'getHosts', 'getApps', 'getItems', 'getMacros', 'getItemsByIDs',\n  'getEvents', 'getAlerts', 'getHostAlerts', 'getAcknowledges', 'getITService', 'getSLA', 'getProxies',\n  'getEventAlerts', 'getExtendedEventData', 'getProblems', 'getEventsHistory', 'getTriggersByIds', 'getScripts', 'getValueMappings'\n];\n\nconst REQUESTS_TO_CACHE = [\n  'getGroups', 'getHosts', 'getApps', 'getItems', 'getMacros', 'getItemsByIDs', 'getITService', 'getProxies', 'getValueMappings'\n];\n\nconst REQUESTS_TO_BIND = [\n  'getHistory', 'getTrend', 'getMacros', 'getItemsByIDs', 'getEvents', 'getAlerts', 'getHostAlerts',\n  'getAcknowledges', 'getITService', 'acknowledgeEvent', 'getProxies', 'getEventAlerts',\n  'getExtendedEventData', 'getScripts', 'executeScript', 'getValueMappings'\n];\n\nexport class Zabbix implements ZabbixConnector {\n  enableDirectDBConnection: boolean;\n  cachingProxy: CachingProxy;\n  zabbixAPI: ZabbixAPIConnector;\n  getHistoryDB: any;\n  dbConnector: any;\n  getTrendsDB: any;\n  version: string;\n\n  getHistory: (items, timeFrom, timeTill) => Promise<any>;\n  getTrend: (items, timeFrom, timeTill) => Promise<any>;\n  getItemsByIDs: (itemids) => Promise<any>;\n  getEvents: (objectids, timeFrom, timeTo, showEvents, limit?) => Promise<any>;\n  getAlerts: (itemids, timeFrom?, timeTo?) => Promise<any>;\n  getHostAlerts: (hostids, applicationids, options?) => Promise<any>;\n  getAcknowledges: (eventids) => Promise<any>;\n  getITService: (serviceids?) => Promise<any>;\n  acknowledgeEvent: (eventid, message) => Promise<any>;\n  getProxies: () => Promise<any>;\n  getEventAlerts: (eventids) => Promise<any>;\n  getExtendedEventData: (eventids) => Promise<any>;\n  getMacros: (hostids: any[]) => Promise<any>;\n  getValueMappings: () => Promise<any>;\n\n  constructor(options) {\n    const {\n      basicAuth,\n      withCredentials,\n      cacheTTL,\n      enableDirectDBConnection,\n      dbConnectionDatasourceId,\n      dbConnectionDatasourceName,\n      dbConnectionRetentionPolicy,\n      datasourceId,\n    } = options;\n\n    this.enableDirectDBConnection = enableDirectDBConnection;\n\n    // Initialize caching proxy for requests\n    const cacheOptions = {\n      enabled: true,\n      ttl: cacheTTL\n    };\n    this.cachingProxy = new CachingProxy(cacheOptions);\n\n    this.zabbixAPI = new ZabbixAPIConnector(basicAuth, withCredentials, datasourceId);\n\n    this.proxifyRequests();\n    this.cacheRequests();\n    this.bindRequests();\n\n    if (enableDirectDBConnection) {\n      const connectorOptions: any = { dbConnectionRetentionPolicy };\n      this.initDBConnector(dbConnectionDatasourceId, dbConnectionDatasourceName, connectorOptions)\n      .then(() => {\n        this.getHistoryDB = this.cachingProxy.proxifyWithCache(this.dbConnector.getHistory, 'getHistory', this.dbConnector);\n        this.getTrendsDB = this.cachingProxy.proxifyWithCache(this.dbConnector.getTrends, 'getTrends', this.dbConnector);\n      });\n    }\n  }\n\n  initDBConnector(datasourceId, datasourceName, options) {\n    return DBConnector.loadDatasource(datasourceId, datasourceName)\n    .then(ds => {\n      const connectorOptions: any = { datasourceId, datasourceName };\n      if (ds.type === 'influxdb') {\n        connectorOptions.retentionPolicy = options.dbConnectionRetentionPolicy;\n        this.dbConnector = new InfluxDBConnector(connectorOptions);\n      } else {\n        this.dbConnector = new SQLConnector(connectorOptions);\n      }\n      return this.dbConnector;\n    });\n  }\n\n  proxifyRequests() {\n    for (const request of REQUESTS_TO_PROXYFY) {\n      this.zabbixAPI[request] = this.cachingProxy.proxify(this.zabbixAPI[request], request, this.zabbixAPI);\n    }\n  }\n\n  cacheRequests() {\n    for (const request of REQUESTS_TO_CACHE) {\n      this.zabbixAPI[request] = this.cachingProxy.cacheRequest(this.zabbixAPI[request], request, this.zabbixAPI);\n    }\n  }\n\n  bindRequests() {\n    for (const request of REQUESTS_TO_BIND) {\n      this[request] = this.zabbixAPI[request].bind(this.zabbixAPI);\n    }\n  }\n\n  /**\n   * Perform test query for Zabbix API and external history DB.\n   * @return {object} test result object:\n   * ```\n   *    {\n   *      zabbixVersion,\n   *      dbConnectorStatus: {\n   *        dsType,\n   *        dsName\n   *      }\n   *    }\n   * ```\n   */\n  testDataSource() {\n    let zabbixVersion;\n    let dbConnectorStatus;\n    return this.getVersion()\n    .then(version => {\n      zabbixVersion = version;\n      return this.getAllGroups();\n    })\n    .then(() => {\n      if (this.enableDirectDBConnection) {\n        return this.dbConnector.testDataSource();\n      } else {\n        return Promise.resolve();\n      }\n    })\n    .catch(error => {\n      return Promise.reject(error);\n    })\n    .then(testResult => {\n      if (testResult) {\n        dbConnectorStatus = {\n          dsType: this.dbConnector.datasourceTypeName,\n          dsName: this.dbConnector.datasourceName\n        };\n      }\n      return { zabbixVersion, dbConnectorStatus };\n    });\n  }\n\n  async getVersion() {\n    if (!this.version) {\n      if (this.zabbixAPI.version) {\n        this.version = this.zabbixAPI.version;\n      } else {\n        this.version = await this.zabbixAPI.initVersion();\n      }\n    }\n    return this.version;\n  }\n\n  supportsApplications() {\n    const version = this.version || this.zabbixAPI.version;\n    return version ? semver.lt(version, '5.4.0') : true;\n  }\n\n  isZabbix54OrHigher() {\n    const version = this.version || this.zabbixAPI.version;\n    return version ? semver.gte(version, '5.4.0') : false;\n  }\n\n  getItemsFromTarget(target, options) {\n    const parts = ['group', 'host', 'application', 'itemTag', 'item'];\n    const filters = _.map(parts, p => target[p].filter);\n    return this.getItems(...filters, options);\n  }\n\n  getHostsFromTarget(target) {\n    const parts = ['group', 'host', 'application'];\n    const filters = _.map(parts, p => target[p].filter);\n    return Promise.all([\n      this.getHosts(...filters),\n      this.getApps(...filters),\n    ]).then(results => {\n      const hosts = results[0];\n      let apps: AppsResponse = results[1];\n      if (apps.appFilterEmpty) {\n        apps = [];\n      }\n      return [hosts, apps];\n    });\n  }\n\n  getAllGroups() {\n    return this.zabbixAPI.getGroups();\n  }\n\n  getGroups(groupFilter) {\n    return this.getAllGroups()\n    .then(groups => findByFilter(groups, groupFilter));\n  }\n\n  /**\n   * Get list of host belonging to given groups.\n   */\n  getAllHosts(groupFilter) {\n    return this.getGroups(groupFilter)\n    .then(groups => {\n      const groupids = _.map(groups, 'groupid');\n      return this.zabbixAPI.getHosts(groupids);\n    });\n  }\n\n  getHosts(groupFilter?, hostFilter?) {\n    return this.getAllHosts(groupFilter)\n    .then(hosts => findByFilter(hosts, hostFilter));\n  }\n\n  /**\n   * Get list of applications belonging to given groups and hosts.\n   */\n  async getAllApps(groupFilter, hostFilter) {\n    await this.getVersion();\n    if (!this.supportsApplications()) {\n      return [];\n    }\n\n    return this.getHosts(groupFilter, hostFilter)\n    .then(hosts => {\n      const hostids = _.map(hosts, 'hostid');\n      return this.zabbixAPI.getApps(hostids);\n    });\n  }\n\n  async getApps(groupFilter?, hostFilter?, appFilter?): Promise<AppsResponse> {\n    await this.getVersion();\n    const skipAppFilter = !this.supportsApplications();\n\n    return this.getHosts(groupFilter, hostFilter)\n    .then(hosts => {\n      const hostids = _.map(hosts, 'hostid');\n      if (appFilter && !skipAppFilter) {\n        return this.zabbixAPI.getApps(hostids)\n        .then(apps => filterByQuery(apps, appFilter));\n      } else {\n        const appsResponse: AppsResponse = hostids;\n        appsResponse.hostids = hostids;\n        appsResponse.appFilterEmpty = true;\n        return Promise.resolve(appsResponse);\n      }\n    });\n  }\n\n  async getItemTags(groupFilter?, hostFilter?, itemTagFilter?) {\n    const items = await this.getAllItems(groupFilter, hostFilter, null, null, {});\n    let tags: ZBXItemTag[] = _.flatten(items.map((item: ZBXItem) => {\n      if (item.tags) {\n        return item.tags;\n      } else {\n        return [];\n      }\n    }));\n    tags = _.uniqBy(tags, t => t.tag + t.value || '');\n    const tagsStr = tags.map(t => ({ name: utils.itemTagToString(t) }));\n    return findByFilter(tagsStr, itemTagFilter);\n  }\n\n  async getAllItems(groupFilter, hostFilter, appFilter, itemTagFilter, options: any = {}) {\n    const apps = await this.getApps(groupFilter, hostFilter, appFilter);\n    let items: any[];\n\n    if (this.isZabbix54OrHigher()) {\n      items = await this.zabbixAPI.getItems(apps.hostids, undefined, options.itemtype);\n      if (itemTagFilter) {\n        items = filterItemsByTag(items, itemTagFilter);\n      }\n    } else {\n      if (apps.appFilterEmpty) {\n        items = await this.zabbixAPI.getItems(apps.hostids, undefined, options.itemtype);\n      } else {\n        const appids = _.map(apps, 'applicationid');\n        items = await this.zabbixAPI.getItems(undefined, appids, options.itemtype);\n      }\n    }\n\n    if (!options.showDisabledItems) {\n      items = _.filter(items, { 'status': '0' });\n    }\n\n    return await this.expandUserMacro(items, false);\n  }\n\n  expandUserMacro(items, isTriggerItem) {\n    const hostids = getHostIds(items);\n    return this.getMacros(hostids)\n    .then(macros => {\n      _.forEach(items, item => {\n        if (utils.containsMacro(isTriggerItem ? item.url : item.name)) {\n          if (isTriggerItem) {\n            item.url = utils.replaceMacro(item, macros, isTriggerItem);\n          } else {\n            item.name = utils.replaceMacro(item, macros);\n          }\n        }\n      });\n      return items;\n    });\n  }\n\n  getItems(groupFilter?, hostFilter?, appFilter?, itemTagFilter?, itemFilter?, options = {}) {\n    return this.getAllItems(groupFilter, hostFilter, appFilter, itemTagFilter, options)\n    .then(items => filterByQuery(items, itemFilter));\n  }\n\n  getItemValues(groupFilter?, hostFilter?, appFilter?, itemFilter?, options: any = {}) {\n    return this.getItems(groupFilter, hostFilter, appFilter, null, itemFilter, options).then(items => {\n      let timeRange = [moment().subtract(2, 'h').unix(), moment().unix()];\n      if (options.range) {\n        timeRange = [options.range.from.unix(), options.range.to.unix()];\n      }\n      const [timeFrom, timeTo] = timeRange;\n\n      return this.zabbixAPI.getHistory(items, timeFrom, timeTo).then(history => {\n        if (history) {\n          const values = _.uniq(history.map(v => v.value));\n          return values.map(value => ({ name: value }));\n        } else {\n          return [];\n        }\n      });\n    });\n  }\n\n  getITServices(itServiceFilter) {\n    return this.zabbixAPI.getITService()\n    .then(itServices => findByFilter(itServices, itServiceFilter));\n  }\n\n  getProblems(groupFilter, hostFilter, appFilter, proxyFilter?, options?): Promise<ProblemDTO[]> {\n    const promises = [\n      this.getGroups(groupFilter),\n      this.getHosts(groupFilter, hostFilter),\n      this.getApps(groupFilter, hostFilter, appFilter)\n    ];\n\n    return Promise.all(promises)\n    .then(results => {\n      const [filteredGroups, filteredHosts, filteredApps] = results;\n      const query: any = {};\n\n      if (appFilter) {\n        query.applicationids = _.flatten(_.map(filteredApps, 'applicationid'));\n      }\n      if (hostFilter && hostFilter !== '/.*/') {\n        query.hostids = _.map(filteredHosts, 'hostid');\n      }\n      if (groupFilter) {\n        query.groupids = _.map(filteredGroups, 'groupid');\n      }\n\n      return query;\n    })\n    .then(query => this.zabbixAPI.getProblems(query.groupids, query.hostids, query.applicationids, options))\n    .then(problems => {\n      const triggerids = problems?.map(problem => problem.objectid);\n      return Promise.all([\n        Promise.resolve(problems),\n        this.zabbixAPI.getTriggersByIds(triggerids)\n      ]);\n    })\n    .then(([problems, triggers]) => joinTriggersWithProblems(problems, triggers))\n    .then(triggers => this.filterTriggersByProxy(triggers, proxyFilter));\n    // .then(triggers => this.expandUserMacro.bind(this)(triggers, true));\n  }\n\n  getProblemsHistory(groupFilter, hostFilter, appFilter, proxyFilter?, options?): Promise<ProblemDTO[]> {\n    const { valueFromEvent } = options;\n\n    const promises = [\n      this.getGroups(groupFilter),\n      this.getHosts(groupFilter, hostFilter),\n      this.getApps(groupFilter, hostFilter, appFilter)\n    ];\n\n    return Promise.all(promises)\n    .then(results => {\n      const [filteredGroups, filteredHosts, filteredApps] = results;\n      const query: any = {};\n\n      if (appFilter) {\n        query.applicationids = _.flatten(_.map(filteredApps, 'applicationid'));\n      }\n      if (hostFilter) {\n        query.hostids = _.map(filteredHosts, 'hostid');\n      }\n      if (groupFilter) {\n        query.groupids = _.map(filteredGroups, 'groupid');\n      }\n\n      return query;\n    })\n    .then(query => this.zabbixAPI.getEventsHistory(query.groupids, query.hostids, query.applicationids, options))\n    .then(problems => {\n      const triggerids = problems?.map(problem => problem.objectid);\n      return Promise.all([Promise.resolve(problems), this.zabbixAPI.getTriggersByIds(triggerids)]);\n    })\n    .then(([problems, triggers]) => joinTriggersWithEvents(problems, triggers, { valueFromEvent }))\n    .then(triggers => this.filterTriggersByProxy(triggers, proxyFilter));\n    // .then(triggers => this.expandUserMacro.bind(this)(triggers, true));\n  }\n\n  filterTriggersByProxy(triggers, proxyFilter) {\n    return this.getFilteredProxies(proxyFilter)\n    .then(proxies => {\n      if (proxyFilter && proxyFilter !== '/.*/' && triggers) {\n        const proxy_ids = proxies.map(proxy => proxy.proxyid);\n        triggers = triggers.filter(trigger => {\n          for (let i = 0; i < trigger.hosts.length; i++) {\n            const host = trigger.hosts[i];\n            if (proxy_ids.includes(host.proxy_hostid)) {\n              return true;\n            }\n          }\n          return false;\n        });\n      }\n      return triggers;\n    });\n  }\n\n  getFilteredProxies(proxyFilter) {\n    return this.zabbixAPI.getProxies()\n    .then(proxies => {\n      proxies.forEach(proxy => proxy.name = proxy.host);\n      return findByFilter(proxies, proxyFilter);\n    });\n  }\n\n  getHistoryTS(items, timeRange, request) {\n    const [timeFrom, timeTo] = timeRange;\n    if (this.enableDirectDBConnection) {\n      return this.getHistoryDB(items, timeFrom, timeTo, request)\n      .then(history => responseHandler.dataResponseToTimeSeries(history, items, request));\n    } else {\n      return this.zabbixAPI.getHistory(items, timeFrom, timeTo)\n      .then(history => responseHandler.handleHistory(history, items));\n    }\n  }\n\n  getTrends(items, timeRange, request) {\n    const [timeFrom, timeTo] = timeRange;\n    if (this.enableDirectDBConnection) {\n      return this.getTrendsDB(items, timeFrom, timeTo, request)\n      .then(history => responseHandler.dataResponseToTimeSeries(history, items, request));\n    } else {\n      const valueType = request.consolidateBy || request.valueType;\n      return this.zabbixAPI.getTrend(items, timeFrom, timeTo)\n      .then(history => responseHandler.handleTrends(history, items, valueType))\n      .then(responseHandler.sortTimeseries); // Sort trend data, issue #202\n    }\n  }\n\n  getHistoryText(items, timeRange, target) {\n    const [timeFrom, timeTo] = timeRange;\n    if (items.length) {\n      return this.zabbixAPI.getHistory(items, timeFrom, timeTo)\n      .then(history => {\n        if (target.resultFormat === 'table') {\n          return responseHandler.handleHistoryAsTable(history, items, target);\n        } else {\n          return responseHandler.handleText(history, items, target);\n        }\n      });\n    } else {\n      return Promise.resolve([]);\n    }\n  }\n\n  getSLA(itservices, timeRange, target, options) {\n    const itServiceIds = _.map(itservices, 'serviceid');\n    return this.zabbixAPI.getSLA(itServiceIds, timeRange, options)\n    .then(slaResponse => {\n      return _.map(itServiceIds, serviceid => {\n        const itservice = _.find(itservices, { 'serviceid': serviceid });\n        return responseHandler.handleSLAResponse(itservice, target.slaProperty, slaResponse);\n      });\n    });\n  }\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Find group, host, app or item by given name.\n * @param  list list of groups, apps or other\n * @param  name visible name\n * @return      array with finded element or empty array\n */\nfunction findByName(list, name) {\n  const finded = _.find(list, { 'name': name });\n  if (finded) {\n    return [finded];\n  } else {\n    return [];\n  }\n}\n\n/**\n * Different hosts can contains applications and items with same name.\n * For this reason use _.filter, which return all elements instead _.find,\n * which return only first finded.\n * @param  {[type]} list list of elements\n * @param  {[type]} name app name\n * @return {[type]}      array with finded element or empty array\n */\nfunction filterByName(list, name) {\n  const finded = _.filter(list, { 'name': name });\n  if (finded) {\n    return finded;\n  } else {\n    return [];\n  }\n}\n\nfunction filterByRegex(list, regex) {\n  const filterPattern = utils.buildRegex(regex);\n  return _.filter(list, (zbx_obj) => {\n    return filterPattern.test(zbx_obj.name);\n  });\n}\n\nfunction findByFilter(list, filter) {\n  if (utils.isRegex(filter)) {\n    return filterByRegex(list, filter);\n  } else {\n    return findByName(list, filter);\n  }\n}\n\nfunction filterByQuery(list, filter) {\n  if (utils.isRegex(filter)) {\n    return filterByRegex(list, filter);\n  } else {\n    return filterByName(list, filter);\n  }\n}\n\nfunction getHostIds(items) {\n  const hostIds = _.map(items, item => {\n    return _.map(item.hosts, 'hostid');\n  });\n  return _.uniq(_.flatten(hostIds));\n}\n\nfunction filterItemsByTag(items: any[], itemTagFilter: string) {\n  if (utils.isRegex(itemTagFilter)) {\n    const filterPattern = utils.buildRegex(itemTagFilter);\n    return items.filter((item) => {\n      if (item.tags) {\n        const tags: string[] = item.tags.map(t => utils.itemTagToString(t));\n        return tags.some((tag) => {\n          return filterPattern.test(tag);\n        });\n      } else {\n        return false;\n      }\n    });\n  } else {\n    return items.filter(item => {\n      if (item.tags) {\n        const tags: string[] = item.tags.map(t => utils.itemTagToString(t));\n        return tags.includes(itemTagFilter);\n      } else {\n        return false;\n      }\n    });\n  }\n}\n","import _ from 'lodash';\nimport { Observable } from 'rxjs';\nimport config from 'grafana/app/core/config';\nimport { contextSrv } from 'grafana/app/core/core';\nimport * as dateMath from 'grafana/app/core/utils/datemath';\nimport * as utils from './utils';\nimport * as migrations from './migrations';\nimport * as metricFunctions from './metricFunctions';\nimport * as c from './constants';\nimport dataProcessor from './dataProcessor';\nimport responseHandler from './responseHandler';\nimport problemsHandler from './problemsHandler';\nimport { Zabbix } from './zabbix/zabbix';\nimport { ZabbixAPIError } from './zabbix/connectors/zabbix_api/zabbixAPIConnector';\nimport { ProblemDTO, ShowProblemTypes, VariableQueryTypes, ZabbixDSOptions, ZabbixMetricsQuery } from './types';\nimport { BackendSrvRequest, getBackendSrv, getTemplateSrv, toDataQueryResponse } from '@grafana/runtime';\nimport {\n  DataFrame,\n  dataFrameFromJSON,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  DataSourceInstanceSettings,\n  FieldType,\n  isDataFrame,\n  LoadingState\n} from '@grafana/data';\n\nexport class ZabbixDatasource extends DataSourceApi<ZabbixMetricsQuery, ZabbixDSOptions> {\n  name: string;\n  basicAuth: any;\n  withCredentials: any;\n\n  trends: boolean;\n  trendsFrom: string;\n  trendsRange: string;\n  cacheTTL: any;\n  disableReadOnlyUsersAck: boolean;\n  disableDataAlignment: boolean;\n  enableDirectDBConnection: boolean;\n  dbConnectionDatasourceId: number;\n  dbConnectionDatasourceName: string;\n  dbConnectionRetentionPolicy: string;\n  enableDebugLog: boolean;\n  datasourceId: number;\n  zabbix: Zabbix;\n\n  replaceTemplateVars: (target: any, scopedVars?: any) => any;\n\n  /** @ngInject */\n  constructor(instanceSettings: DataSourceInstanceSettings<ZabbixDSOptions>, private templateSrv) {\n    super(instanceSettings);\n\n    this.templateSrv = templateSrv;\n    this.enableDebugLog = config.buildInfo.env === 'development';\n\n    // Use custom format for template variables\n    this.replaceTemplateVars = _.partial(replaceTemplateVars, this.templateSrv);\n\n    // General data source settings\n    this.datasourceId = instanceSettings.id;\n    this.name = instanceSettings.name;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.withCredentials = instanceSettings.withCredentials;\n\n    const jsonData = migrations.migrateDSConfig(instanceSettings.jsonData);\n\n    // Use trends instead history since specified time\n    this.trends = jsonData.trends;\n    this.trendsFrom = jsonData.trendsFrom || '7d';\n    this.trendsRange = jsonData.trendsRange || '4d';\n\n    // Set cache update interval\n    const ttl = jsonData.cacheTTL || '1h';\n    this.cacheTTL = utils.parseInterval(ttl);\n\n    // Other options\n    this.disableReadOnlyUsersAck = jsonData.disableReadOnlyUsersAck;\n    this.disableDataAlignment = jsonData.disableDataAlignment;\n\n    // Direct DB Connection options\n    this.enableDirectDBConnection = jsonData.dbConnectionEnable || false;\n    this.dbConnectionDatasourceId = jsonData.dbConnectionDatasourceId;\n    this.dbConnectionDatasourceName = jsonData.dbConnectionDatasourceName;\n    this.dbConnectionRetentionPolicy = jsonData.dbConnectionRetentionPolicy;\n\n    const zabbixOptions = {\n      basicAuth: this.basicAuth,\n      withCredentials: this.withCredentials,\n      cacheTTL: this.cacheTTL,\n      enableDirectDBConnection: this.enableDirectDBConnection,\n      dbConnectionDatasourceId: this.dbConnectionDatasourceId,\n      dbConnectionDatasourceName: this.dbConnectionDatasourceName,\n      dbConnectionRetentionPolicy: this.dbConnectionRetentionPolicy,\n      datasourceId: this.datasourceId,\n    };\n\n    this.zabbix = new Zabbix(zabbixOptions);\n  }\n\n  ////////////////////////\n  // Datasource methods //\n  ////////////////////////\n\n  /**\n   * Query panel data. Calls for each panel in dashboard.\n   * @param  {Object} request   Contains time range, targets and other info.\n   * @return {Object} Grafana metrics object with timeseries data for each target.\n   */\n  query(request: DataQueryRequest<any>): Promise<DataQueryResponse> | Observable<DataQueryResponse> {\n    // Migrate old targets\n    const requestTargets = request.targets.map(t => {\n      // Prevent changes of original object\n      const target = _.cloneDeep(t);\n      return migrations.migrate(target);\n    });\n\n    const backendResponsePromise = this.backendQuery({ ...request, targets: requestTargets });\n    const dbConnectionResponsePromise = this.dbConnectionQuery({ ...request, targets: requestTargets });\n    const frontendResponsePromise = this.frontendQuery({ ...request, targets: requestTargets });\n\n    return Promise.all([backendResponsePromise, dbConnectionResponsePromise, frontendResponsePromise])\n    .then(rsp => {\n      // Merge backend and frontend queries results\n      const [backendRes, dbConnectionRes, frontendRes] = rsp;\n      if (dbConnectionRes.data) {\n        backendRes.data = backendRes.data.concat(dbConnectionRes.data);\n      }\n      if (frontendRes.data) {\n        backendRes.data = backendRes.data.concat(frontendRes.data);\n      }\n\n      return {\n        data: backendRes.data,\n        state: LoadingState.Done,\n        key: request.requestId,\n      };\n    });\n  }\n\n  async backendQuery(request: DataQueryRequest<any>): Promise<DataQueryResponse> {\n    const { intervalMs, maxDataPoints, range, requestId } = request;\n    const targets = request.targets.filter(this.isBackendTarget);\n\n    // Add range variables\n    request.scopedVars = Object.assign({}, request.scopedVars, utils.getRangeScopedVars(request.range));\n\n    const queries = _.compact(targets.map((query) => {\n      // Don't request for hidden targets\n      if (query.hide) {\n        return null;\n      }\n\n      this.replaceTargetVariables(query, request);\n\n      return {\n        ...query,\n        datasourceId: this.datasourceId,\n        intervalMs,\n        maxDataPoints,\n      };\n    }));\n\n    // Return early if no queries exist\n    if (!queries.length) {\n      return Promise.resolve({ data: [] });\n    }\n\n    const body: any = { queries };\n\n    if (range) {\n      body.range = range;\n      body.from = range.from.valueOf().toString();\n      body.to = range.to.valueOf().toString();\n    }\n\n    let rsp: any;\n    try {\n      rsp = await getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: body,\n        requestId,\n      }).toPromise();\n    } catch (err) {\n      return toDataQueryResponse(err);\n    }\n\n    const resp = toDataQueryResponse(rsp);\n    this.sortByRefId(resp);\n    this.applyFrontendFunctions(resp, request);\n    if (responseHandler.isConvertibleToWide(resp.data)) {\n      console.log('Converting response to the wide format');\n      resp.data = responseHandler.convertToWide(resp.data);\n    }\n\n    return resp;\n  }\n\n  async frontendQuery(request: DataQueryRequest<any>): Promise<DataQueryResponse> {\n    const frontendTargets = request.targets.filter(t => !(this.isBackendTarget(t) || this.isDBConnectionTarget(t)));\n    const promises = _.map(frontendTargets, target => {\n      // Don't request for hidden targets\n      if (target.hide) {\n        return [];\n      }\n\n      // Add range variables\n      request.scopedVars = Object.assign({}, request.scopedVars, utils.getRangeScopedVars(request.range));\n      this.replaceTargetVariables(target, request);\n      const timeRange = this.buildTimeRange(request, target);\n\n      if (target.queryType === c.MODE_TEXT) {\n        // Text query\n        // Don't request undefined targets\n        if (!target.group || !target.host || !target.item) {\n          return [];\n        }\n        return this.queryTextData(target, timeRange);\n      } else if (target.queryType === c.MODE_ITSERVICE) {\n        // IT services query\n        return this.queryITServiceData(target, timeRange, request);\n      } else if (target.queryType === c.MODE_TRIGGERS) {\n        // Triggers query\n        return this.queryTriggersData(target, timeRange);\n      } else if (target.queryType === c.MODE_PROBLEMS) {\n        // Problems query\n        return this.queryProblems(target, timeRange, request);\n      } else {\n        return [];\n      }\n    });\n\n    // Data for panel (all targets)\n    return Promise.all(_.flatten(promises))\n    .then(_.flatten)\n    .then(data => {\n      if (data && data.length > 0 && isDataFrame(data[0]) && !utils.isProblemsDataFrame(data[0])) {\n        data = responseHandler.alignFrames(data);\n        if (responseHandler.isConvertibleToWide(data)) {\n          console.log('Converting response to the wide format');\n          data = responseHandler.convertToWide(data);\n        }\n      }\n      return { data };\n    });\n  }\n\n  async dbConnectionQuery(request: DataQueryRequest<any>): Promise<DataQueryResponse> {\n    const targets = request.targets.filter(this.isDBConnectionTarget);\n\n    const queries = _.compact(targets.map((target) => {\n      // Don't request for hidden targets\n      if (target.hide) {\n        return [];\n      }\n\n      // Add range variables\n      request.scopedVars = Object.assign({}, request.scopedVars, utils.getRangeScopedVars(request.range));\n      this.replaceTargetVariables(target, request);\n      const timeRange = this.buildTimeRange(request, target);\n      const useTrends = this.isUseTrends(timeRange);\n\n      if (!target.queryType || target.queryType === c.MODE_METRICS) {\n        return this.queryNumericData(target, timeRange, useTrends, request);\n      } else if (target.queryType === c.MODE_ITEMID) {\n        // Item ID query\n        if (!target.itemids) {\n          return [];\n        }\n        return this.queryItemIdData(target, timeRange, useTrends, request);\n      } else {\n        return [];\n      }\n    }));\n\n    const promises: Promise<DataQueryResponse> = Promise.all(queries)\n    .then(_.flatten)\n    .then(data => ({ data }));\n\n    return promises;\n  }\n\n  buildTimeRange(request, target) {\n    let timeFrom = Math.ceil(dateMath.parse(request.range.from) / 1000);\n    let timeTo = Math.ceil(dateMath.parse(request.range.to) / 1000);\n\n    // Apply Time-related functions (timeShift(), etc)\n    const timeFunctions = bindFunctionDefs(target.functions, 'Time');\n    if (timeFunctions.length) {\n      const [time_from, time_to] = utils.sequence(timeFunctions)([timeFrom, timeTo]);\n      timeFrom = time_from;\n      timeTo = time_to;\n    }\n    return [timeFrom, timeTo];\n  }\n\n  /**\n   * Query target data for Metrics\n   */\n  async queryNumericData(target, timeRange, useTrends, request): Promise<any> {\n    const getItemOptions = {\n      itemtype: 'num'\n    };\n\n    const items = await this.zabbix.getItemsFromTarget(target, getItemOptions);\n\n    const queryStart = new Date().getTime();\n    const result = await this.queryNumericDataForItems(items, target, timeRange, useTrends, request);\n    const queryEnd = new Date().getTime();\n\n    if (this.enableDebugLog) {\n      console.log(`Datasource::Performance Query Time (${this.name}): ${queryEnd - queryStart}`);\n    }\n\n    return this.handleBackendPostProcessingResponse(result, request, target);\n  }\n\n  /**\n   * Query history for numeric items\n   */\n  async queryNumericDataForItems(items, target: ZabbixMetricsQuery, timeRange, useTrends, request) {\n    let history;\n    request.valueType = this.getTrendValueType(target);\n    request.consolidateBy = getConsolidateBy(target) || request.valueType;\n\n    if (useTrends) {\n      history = await this.zabbix.getTrends(items, timeRange, request);\n    } else {\n      history = await this.zabbix.getHistoryTS(items, timeRange, request);\n    }\n\n    const range = {\n      from: timeRange[0],\n      to: timeRange[1],\n    };\n    return await this.invokeDataProcessingQuery(history, target, range);\n  }\n\n  async invokeDataProcessingQuery(timeSeriesData, query, timeRange) {\n    // Request backend for data processing\n    const requestOptions: BackendSrvRequest = {\n      url: `/api/datasources/${this.datasourceId}/resources/db-connection-post`,\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      hideFromInspector: false,\n      data: {\n        series: timeSeriesData,\n        query,\n        timeRange,\n      },\n    };\n\n    const response: any = await getBackendSrv().fetch<any>(requestOptions).toPromise();\n    return response.data;\n  }\n\n  handleBackendPostProcessingResponse(response, request, target) {\n    const frames = [];\n    for (const frameJSON of response) {\n      const frame = dataFrameFromJSON(frameJSON);\n      frame.refId = target.refId;\n      frames.push(frame);\n    }\n\n    const resp = { data: frames };\n    this.sortByRefId(resp);\n    this.applyFrontendFunctions(resp, request);\n    if (responseHandler.isConvertibleToWide(resp.data)) {\n      console.log('Converting response to the wide format');\n      resp.data = responseHandler.convertToWide(resp.data);\n    }\n\n    return resp.data;\n  }\n\n  getTrendValueType(target) {\n    // Find trendValue() function and get specified trend value\n    const trendFunctions = _.map(metricFunctions.getCategories()['Trends'], 'name');\n    const trendValueFunc = _.find(target.functions, func => {\n      return _.includes(trendFunctions, func.def.name);\n    });\n    return trendValueFunc ? trendValueFunc.params[0] : \"avg\";\n  }\n\n  sortByRefId(response: DataQueryResponse) {\n    response.data.sort((a, b) => {\n      if (a.refId < b.refId) {\n        return -1;\n      } else if (a.refId > b.refId) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  applyFrontendFunctions(response: DataQueryResponse, request: DataQueryRequest<any>) {\n    for (let i = 0; i < response.data.length; i++) {\n      const frame: DataFrame = response.data[i];\n      const target = getRequestTarget(request, frame.refId);\n\n      // Apply alias functions\n      const aliasFunctions = bindFunctionDefs(target.functions, 'Alias');\n      utils.sequence(aliasFunctions)(frame);\n    }\n    return response;\n  }\n\n  /**\n   * Query target data for Text\n   */\n  queryTextData(target, timeRange) {\n    const options = {\n      itemtype: 'text'\n    };\n    return this.zabbix.getItemsFromTarget(target, options)\n    .then(items => {\n      return this.zabbix.getHistoryText(items, timeRange, target);\n    })\n    .then(result => {\n      if (target.resultFormat !== 'table') {\n        return result.map(s => responseHandler.seriesToDataFrame(s, target, [], FieldType.string));\n      }\n      return result;\n    });\n  }\n\n  /**\n   * Query target data for Item ID\n   */\n  queryItemIdData(target, timeRange, useTrends, options) {\n    let itemids = target.itemids;\n    itemids = this.templateSrv.replace(itemids, options.scopedVars, zabbixItemIdsTemplateFormat);\n    itemids = _.map(itemids.split(','), itemid => itemid.trim());\n\n    if (!itemids) {\n      return [];\n    }\n\n    return this.zabbix.getItemsByIDs(itemids)\n    .then(items => {\n      return this.queryNumericDataForItems(items, target, timeRange, useTrends, options);\n    });\n  }\n\n  /**\n   * Query target data for IT Services\n   */\n  async queryITServiceData(target, timeRange, request) {\n    // Don't show undefined and hidden targets\n    if (target.hide || (!target.itservice && !target.itServiceFilter) || !target.slaProperty) {\n      return [];\n    }\n\n    let itServiceFilter;\n    request.isOldVersion = target.itservice && !target.itServiceFilter;\n\n    if (request.isOldVersion) {\n      // Backward compatibility\n      itServiceFilter = '/.*/';\n    } else {\n      itServiceFilter = this.replaceTemplateVars(target.itServiceFilter, request.scopedVars);\n    }\n\n    request.slaInterval = target.slaInterval;\n\n    let itservices = await this.zabbix.getITServices(itServiceFilter);\n    if (request.isOldVersion) {\n      itservices = _.filter(itservices, { 'serviceid': target.itservice?.serviceid });\n    }\n    const itservicesdp = await this.zabbix.getSLA(itservices, timeRange, target, request);\n    const backendRequest = responseHandler.itServiceResponseToTimeSeries(itservicesdp, target.slaInterval);\n    const processedResponse = await this.invokeDataProcessingQuery(backendRequest, target, {});\n    return this.handleBackendPostProcessingResponse(processedResponse, request, target);\n  }\n\n  queryTriggersData(target, timeRange) {\n    const [timeFrom, timeTo] = timeRange;\n    return this.zabbix.getHostsFromTarget(target)\n    .then(results => {\n      const [hosts, apps] = results;\n      if (hosts.length) {\n        const hostids = _.map(hosts, 'hostid');\n        const appids = _.map(apps, 'applicationid');\n        const options = {\n          minSeverity: target.triggers.minSeverity,\n          acknowledged: target.triggers.acknowledged,\n          count: target.triggers.count,\n          timeFrom: timeFrom,\n          timeTo: timeTo\n        };\n        const groupFilter = target.group.filter;\n        return Promise.all([\n          this.zabbix.getHostAlerts(hostids, appids, options),\n          this.zabbix.getGroups(groupFilter)\n        ])\n        .then(([triggers, groups]) => {\n          return responseHandler.handleTriggersResponse(triggers, groups, timeRange);\n        });\n      } else {\n        return Promise.resolve([]);\n      }\n    });\n  }\n\n  queryProblems(target: ZabbixMetricsQuery, timeRange, options) {\n    const [timeFrom, timeTo] = timeRange;\n    const userIsEditor = contextSrv.isEditor || contextSrv.isGrafanaAdmin;\n\n    let proxies;\n    let showAckButton = true;\n\n    const showProblems = target.showProblems || ShowProblemTypes.Problems;\n    const showProxy = target.options.hostProxy;\n\n    const getProxiesPromise = showProxy ? this.zabbix.getProxies() : () => [];\n    showAckButton = !this.disableReadOnlyUsersAck || userIsEditor;\n\n    // Replace template variables\n    const groupFilter = this.replaceTemplateVars(target.group?.filter, options.scopedVars);\n    const hostFilter = this.replaceTemplateVars(target.host?.filter, options.scopedVars);\n    const appFilter = this.replaceTemplateVars(target.application?.filter, options.scopedVars);\n    const proxyFilter = this.replaceTemplateVars(target.proxy?.filter, options.scopedVars);\n\n    const triggerFilter = this.replaceTemplateVars(target.trigger?.filter, options.scopedVars);\n    const tagsFilter = this.replaceTemplateVars(target.tags?.filter, options.scopedVars);\n\n    const replacedTarget = {\n      ...target,\n      trigger: { filter: triggerFilter },\n      tags: { filter: tagsFilter },\n    };\n\n    // replaceTemplateVars() builds regex-like string, so we should trim it.\n    const tagsFilterStr = tagsFilter.replace('/^', '').replace('$/', '');\n    const tags = utils.parseTags(tagsFilterStr);\n    tags.forEach(tag => {\n      // Zabbix uses {\"tag\": \"<tag>\", \"value\": \"<value>\", \"operator\": \"<operator>\"} format, where 1 means Equal\n      tag.operator = 1;\n    });\n\n    const problemsOptions: any = {\n      recent: showProblems === ShowProblemTypes.Recent,\n      minSeverity: target.options?.minSeverity,\n      limit: target.options?.limit,\n    };\n\n    if (tags && tags.length) {\n      problemsOptions.tags = tags;\n    }\n\n    if (target.options?.acknowledged === 0 || target.options?.acknowledged === 1) {\n      problemsOptions.acknowledged = !!target.options?.acknowledged;\n    }\n\n    if (target.options?.minSeverity) {\n      let severities = [0, 1, 2, 3, 4, 5].filter(v => v >= target.options?.minSeverity);\n      if (target.options?.severities) {\n        severities = severities.filter(v => target.options?.severities.includes(v));\n      }\n      problemsOptions.severities = severities;\n    }\n\n    let getProblemsPromise: Promise<ProblemDTO[]>;\n    if (showProblems === ShowProblemTypes.History || target.options?.useTimeRange) {\n      problemsOptions.timeFrom = timeFrom;\n      problemsOptions.timeTo = timeTo;\n      getProblemsPromise = this.zabbix.getProblemsHistory(groupFilter, hostFilter, appFilter, proxyFilter, problemsOptions);\n    } else {\n      getProblemsPromise = this.zabbix.getProblems(groupFilter, hostFilter, appFilter, proxyFilter, problemsOptions);\n    }\n\n    const problemsPromises = Promise.all([\n      getProblemsPromise,\n      getProxiesPromise\n    ])\n    .then(([problems, sourceProxies]) => {\n      proxies = _.keyBy(sourceProxies, 'proxyid');\n      return problems;\n    })\n    .then(problems => problemsHandler.setMaintenanceStatus(problems))\n    .then(problems => problemsHandler.setAckButtonStatus(problems, showAckButton))\n    .then(problems => problemsHandler.filterTriggersPre(problems, replacedTarget))\n    .then(problems => problemsHandler.sortProblems(problems, target))\n    .then(problems => problemsHandler.addTriggerDataSource(problems, target))\n    .then(problems => problemsHandler.addTriggerHostProxy(problems, proxies));\n\n    return problemsPromises.then(problems => {\n      const problemsDataFrame = problemsHandler.toDataFrame(problems);\n      return problemsDataFrame;\n    });\n  }\n\n  /**\n   * Test connection to Zabbix API and external history DB.\n   */\n  async testDatasource() {\n    try {\n      const { zabbixVersion, dbConnectorStatus } = await this.zabbix.testDataSource();\n      let message = `Zabbix API version: ${zabbixVersion}`;\n      if (dbConnectorStatus) {\n        message += `, DB connector type: ${dbConnectorStatus.dsType}`;\n      }\n      return {\n        status: \"success\",\n        title: \"Success\",\n        message: message\n      };\n    } catch (error) {\n      if (error instanceof ZabbixAPIError) {\n        return {\n          status: \"error\",\n          title: error.message,\n          message: error.message\n        };\n      } else if (error.data && error.data.message) {\n        return {\n          status: \"error\",\n          title: \"Zabbix Client Error\",\n          message: error.data.message\n        };\n      } else if (typeof (error) === 'string') {\n        return {\n          status: \"error\",\n          title: \"Unknown Error\",\n          message: error\n        };\n      } else {\n        console.log(error);\n        return {\n          status: \"error\",\n          title: \"Connection failed\",\n          message: \"Could not connect to given url\"\n        };\n      }\n    }\n  }\n\n  ////////////////\n  // Templating //\n  ////////////////\n\n  /**\n   * Find metrics from templated request.\n   *\n   * @param  {string} query Query from Templating\n   * @param options\n   * @return {string}       Metric name - group, host, app or item or list\n   *                        of metrics in \"{metric1, metric2,..., metricN}\" format.\n   */\n  metricFindQuery(query, options) {\n    let resultPromise;\n    let queryModel = _.cloneDeep(query);\n\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    if (typeof query === 'string') {\n      // Backward compatibility\n      queryModel = utils.parseLegacyVariableQuery(query);\n    }\n\n    for (const prop of ['group', 'host', 'application', 'itemTag', 'item']) {\n      queryModel[prop] = this.replaceTemplateVars(queryModel[prop], {});\n    }\n\n    const { group, host, application, item } = queryModel;\n\n    switch (queryModel.queryType) {\n      case VariableQueryTypes.Group:\n        resultPromise = this.zabbix.getGroups(queryModel.group);\n        break;\n      case VariableQueryTypes.Host:\n        resultPromise = this.zabbix.getHosts(queryModel.group, queryModel.host);\n        break;\n      case VariableQueryTypes.Application:\n        resultPromise = this.zabbix.getApps(queryModel.group, queryModel.host, queryModel.application);\n        break;\n      case VariableQueryTypes.ItemTag:\n        resultPromise = this.zabbix.getItemTags(queryModel.group, queryModel.host, queryModel.itemTag);\n        break;\n      case VariableQueryTypes.Item:\n        resultPromise = this.zabbix.getItems(queryModel.group, queryModel.host, queryModel.application, null, queryModel.item);\n        break;\n      case VariableQueryTypes.ItemValues:\n        const range = options?.range;\n        resultPromise = this.zabbix.getItemValues(group, host, application, item, { range });\n        break;\n      default:\n        resultPromise = Promise.resolve([]);\n        break;\n    }\n\n    return resultPromise.then(metrics => {\n      return _.map(metrics, formatMetric);\n    });\n  }\n\n  targetContainsTemplate(target: ZabbixMetricsQuery): boolean {\n    const templateSrv = getTemplateSrv() as any;\n    return (\n      templateSrv.variableExists(target.group?.filter) ||\n      templateSrv.variableExists(target.host?.filter) ||\n      templateSrv.variableExists(target.application?.filter) ||\n      templateSrv.variableExists(target.itemTag?.filter) ||\n      templateSrv.variableExists(target.item?.filter) ||\n      templateSrv.variableExists(target.proxy?.filter) ||\n      templateSrv.variableExists(target.trigger?.filter) ||\n      templateSrv.variableExists(target.textFilter) ||\n      templateSrv.variableExists(target.itServiceFilter)\n    );\n  }\n\n  /////////////////\n  // Annotations //\n  /////////////////\n\n  annotationQuery(options) {\n    const timeRange = options.range || options.rangeRaw;\n    const timeFrom = Math.ceil(dateMath.parse(timeRange.from) / 1000);\n    const timeTo = Math.ceil(dateMath.parse(timeRange.to) / 1000);\n    const annotation = options.annotation;\n\n    // Show all triggers\n    const problemsOptions: any = {\n      value: annotation.showOkEvents ? ['0', '1'] : '1',\n      valueFromEvent: true,\n      timeFrom,\n      timeTo,\n    };\n\n    if (annotation.minseverity) {\n      const severities = [0, 1, 2, 3, 4, 5].filter(v => v >= Number(annotation.minseverity));\n      problemsOptions.severities = severities;\n    }\n\n    const groupFilter = this.replaceTemplateVars(annotation.group, {});\n    const hostFilter = this.replaceTemplateVars(annotation.host, {});\n    const appFilter = this.replaceTemplateVars(annotation.application, {});\n    const proxyFilter = undefined;\n\n    return this.zabbix.getProblemsHistory(groupFilter, hostFilter, appFilter, proxyFilter, problemsOptions)\n    .then(problems => {\n      // Filter triggers by description\n      const problemName = this.replaceTemplateVars(annotation.trigger, {});\n      if (utils.isRegex(problemName)) {\n        problems = _.filter(problems, p => {\n          return utils.buildRegex(problemName).test(p.description);\n        });\n      } else if (problemName) {\n        problems = _.filter(problems, p => {\n          return p.description === problemName;\n        });\n      }\n\n      // Hide acknowledged events if option enabled\n      if (annotation.hideAcknowledged) {\n        problems = _.filter(problems, p => {\n          return !p.acknowledges?.length;\n        });\n      }\n\n      return _.map(problems, p => {\n        const formattedAcknowledges = utils.formatAcknowledges(p.acknowledges);\n\n        let annotationTags: string[] = [];\n        if (annotation.showHostname) {\n          annotationTags = _.map(p.hosts, 'name');\n        }\n\n        return {\n          title: p.value === '1' ? 'Problem' : 'OK',\n          time: p.timestamp * 1000,\n          annotation: annotation,\n          text: p.name + formattedAcknowledges,\n          tags: annotationTags,\n        };\n      });\n    });\n  }\n\n  // Replace template variables\n  replaceTargetVariables(target, options) {\n    const parts = ['group', 'host', 'application', 'itemTag', 'item'];\n    _.forEach(parts, p => {\n      if (target[p] && target[p].filter) {\n        target[p].filter = this.replaceTemplateVars(target[p].filter, options.scopedVars);\n      }\n    });\n\n    if (target.textFilter) {\n      target.textFilter = this.replaceTemplateVars(target.textFilter, options.scopedVars);\n    }\n\n    if (target.itemids) {\n      target.itemids = this.templateSrv.replace(target.itemids, options.scopedVars, zabbixItemIdsTemplateFormat);\n    }\n\n    _.forEach(target.functions, func => {\n      func.params = _.map(func.params, param => {\n        if (typeof param === 'number') {\n          return +this.templateSrv.replace(param.toString(), options.scopedVars);\n        } else {\n          return this.templateSrv.replace(param, options.scopedVars);\n        }\n      });\n    });\n  }\n\n  isUseTrends(timeRange) {\n    const [timeFrom, timeTo] = timeRange;\n    const useTrendsFrom = Math.ceil(dateMath.parse('now-' + this.trendsFrom) / 1000);\n    const useTrendsRange = Math.ceil(utils.parseInterval(this.trendsRange) / 1000);\n    const useTrends = this.trends && (\n      (timeFrom < useTrendsFrom) ||\n      (timeTo - timeFrom > useTrendsRange)\n    );\n    return useTrends;\n  }\n\n  isBackendTarget = (target: any): boolean => {\n    if (this.enableDirectDBConnection) {\n      return false;\n    }\n\n    return target.queryType === c.MODE_METRICS ||\n      target.queryType === c.MODE_ITEMID;\n  };\n\n  isDBConnectionTarget = (target: any): boolean => {\n    return this.enableDirectDBConnection &&\n      (target.queryType === c.MODE_METRICS || target.queryType === c.MODE_ITEMID);\n  };\n}\n\nfunction bindFunctionDefs(functionDefs, category) {\n  const aggregationFunctions = _.map(metricFunctions.getCategories()[category], 'name');\n  const aggFuncDefs = _.filter(functionDefs, func => {\n    return _.includes(aggregationFunctions, func.def.name);\n  });\n\n  return _.map(aggFuncDefs, func => {\n    const funcInstance = metricFunctions.createFuncInstance(func.def, func.params);\n    return funcInstance.bindFunction(dataProcessor.metricFunctions);\n  });\n}\n\nfunction getConsolidateBy(target) {\n  let consolidateBy;\n  const funcDef = _.find(target.functions, func => {\n    return func.def.name === 'consolidateBy';\n  });\n  if (funcDef && funcDef.params && funcDef.params.length) {\n    consolidateBy = funcDef.params[0];\n  }\n  return consolidateBy;\n}\n\nfunction formatMetric(metricObj) {\n  return {\n    text: metricObj.name,\n    expandable: false\n  };\n}\n\n/**\n * Custom formatter for template variables.\n * Default Grafana \"regex\" formatter returns\n * value1|value2\n * This formatter returns\n * (value1|value2)\n * This format needed for using in complex regex with\n * template variables, for example\n * /CPU $cpu_item.*time/ where $cpu_item is system,user,iowait\n */\nexport function zabbixTemplateFormat(value) {\n  if (typeof value === 'string') {\n    return utils.escapeRegex(value);\n  }\n\n  const escapedValues = _.map(value, utils.escapeRegex);\n  return '(' + escapedValues.join('|') + ')';\n}\n\nfunction zabbixItemIdsTemplateFormat(value) {\n  if (typeof value === 'string') {\n    return value;\n  }\n  return value.join(',');\n}\n\n/**\n * If template variables are used in request, replace it using regex format\n * and wrap with '/' for proper multi-value work. Example:\n * $variable selected as a, b, c\n * We use filter $variable\n * $variable    -> a|b|c    -> /a|b|c/\n * /$variable/  -> /a|b|c/  -> /a|b|c/\n */\nfunction replaceTemplateVars(templateSrv, target, scopedVars) {\n  let replacedTarget = templateSrv.replace(target, scopedVars, zabbixTemplateFormat);\n  if (target && target !== replacedTarget && !utils.isRegex(replacedTarget)) {\n    replacedTarget = '/^' + replacedTarget + '$/';\n  }\n  return replacedTarget;\n}\n\nexport function base64StringToArrowTable(text: string) {\n  const b64 = atob(text);\n  const arr = Uint8Array.from(b64, (c) => {\n    return c.charCodeAt(0);\n  });\n  return arr;\n}\n\nfunction getRequestTarget(request: DataQueryRequest<any>, refId: string): any {\n  for (let i = 0; i < request.targets.length; i++) {\n    const target = request.targets[i];\n    if (target.refId === refId) {\n      return target;\n    }\n  }\n  return null;\n}\n","import { QueryCtrl } from 'grafana/app/plugins/sdk';\nimport _ from 'lodash';\nimport * as c from './constants';\nimport * as utils from './utils';\nimport { itemTagToString } from './utils';\nimport * as metricFunctions from './metricFunctions';\nimport * as migrations from './migrations';\nimport { ShowProblemTypes, ZBXItem, ZBXItemTag } from './types';\nimport { CURRENT_SCHEMA_VERSION } from '../panel-triggers/migrations';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\n\n\nfunction getTargetDefaults() {\n  return {\n    queryType: c.MODE_METRICS,\n    group: { 'filter': \"\" },\n    host: { 'filter': \"\" },\n    application: { 'filter': \"\" },\n    itemTag: { 'filter': \"\" },\n    item: { 'filter': \"\" },\n    functions: [],\n    triggers: {\n      'count': true,\n      'minSeverity': 3,\n      'acknowledged': 2\n    },\n    trigger: { filter: \"\" },\n    tags: { filter: \"\" },\n    proxy: { filter: \"\" },\n    options: {\n      showDisabledItems: false,\n      skipEmptyValues: false,\n      disableDataAlignment: false,\n      useZabbixValueMapping: false,\n    },\n    table: {\n      'skipEmptyValues': false\n    },\n  };\n}\n\nfunction getSLATargetDefaults() {\n  return {\n    slaProperty: { name: \"SLA\", property: \"sla\" },\n    slaInterval: 'none',\n  };\n}\n\nfunction getProblemsTargetDefaults() {\n  return {\n    showProblems: ShowProblemTypes.Problems,\n    options: {\n      minSeverity: 0,\n      sortProblems: 'default',\n      acknowledged: 2,\n      hostsInMaintenance: false,\n      hostProxy: false,\n      limit: c.DEFAULT_ZABBIX_PROBLEMS_LIMIT,\n    },\n  };\n}\n\nfunction getSeverityOptions() {\n  return c.TRIGGER_SEVERITY;\n}\n\nfunction mapSeverityOptionsFromPanel(severityOptions: any[]) {\n  if (!severityOptions) {\n    return [0, 1, 2, 3, 4, 5];\n  }\n\n  const severities = [];\n  for (const sevOption of severityOptions) {\n    if (sevOption.show) {\n      severities.push(sevOption.priority);\n    }\n  }\n  return severities;\n}\n\nexport class ZabbixQueryController extends QueryCtrl {\n  static templateUrl: string;\n\n  zabbix: any;\n  replaceTemplateVars: any;\n  templateSrv: TemplateSrv;\n  editorModes: Array<{ value: string; text: string; queryType: string; }>;\n  slaPropertyList: Array<{ name: string; property: string; }>;\n  slaIntervals: Array<{ text: string; value: string; }>;\n  ackFilters: Array<{ text: string; value: number; }>;\n  problemAckFilters: string[];\n  sortByFields: Array<{ text: string; value: string; }>;\n  showEventsFields: Array<{ text: string; value: number[]; } | { text: string; value: number; }>;\n  showProblemsOptions: Array<{ text: string; value: string; }>;\n  resultFormats: Array<{ text: string; value: string; }>;\n  severityOptions: Array<{ val: number; text: string; }>;\n  getGroupNames: (...args: any[]) => any;\n  getHostNames: (...args: any[]) => any;\n  getApplicationNames: (...args: any[]) => any;\n  getItemNames: (...args: any[]) => any;\n  getITServices: (...args: any[]) => any;\n  getProxyNames: (...args: any[]) => any;\n  getVariables: (...args: any[]) => any;\n  init: () => void;\n  queryOptionsText: string;\n  metric: any;\n  showQueryOptions: boolean;\n  oldTarget: any;\n\n  /** @ngInject */\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.zabbix = this.datasource.zabbix;\n\n    // Use custom format for template variables\n    this.replaceTemplateVars = this.datasource.replaceTemplateVars;\n    this.templateSrv = getTemplateSrv();\n\n    this.editorModes = [\n      { value: 'num', text: 'Metrics', queryType: c.MODE_METRICS },\n      { value: 'text', text: 'Text', queryType: c.MODE_TEXT },\n      { value: 'itservice', text: 'IT Services', queryType: c.MODE_ITSERVICE },\n      { value: 'itemid', text: 'Item ID', queryType: c.MODE_ITEMID },\n      { value: 'triggers', text: 'Triggers', queryType: c.MODE_TRIGGERS },\n      { value: 'problems', text: 'Problems', queryType: c.MODE_PROBLEMS },\n    ];\n\n    this.$scope.editorMode = {\n      METRICS: c.MODE_METRICS,\n      TEXT: c.MODE_TEXT,\n      ITSERVICE: c.MODE_ITSERVICE,\n      ITEMID: c.MODE_ITEMID,\n      TRIGGERS: c.MODE_TRIGGERS,\n      PROBLEMS: c.MODE_PROBLEMS,\n    };\n\n    this.slaPropertyList = [\n      { name: \"Status\", property: \"status\" },\n      { name: \"SLA\", property: \"sla\" },\n      { name: \"OK time\", property: \"okTime\" },\n      { name: \"Problem time\", property: \"problemTime\" },\n      { name: \"Down time\", property: \"downtimeTime\" }\n    ];\n\n    this.slaIntervals = [\n      { text: 'No interval', value: 'none' },\n      { text: 'Auto', value: 'auto' },\n      { text: '1 hour', value: '1h' },\n      { text: '12 hours', value: '12h' },\n      { text: '24 hours', value: '1d' },\n      { text: '1 week', value: '1w' },\n      { text: '1 month', value: '1M' },\n    ];\n\n    this.ackFilters = [\n      { text: 'all triggers', value: 2 },\n      { text: 'unacknowledged', value: 0 },\n      { text: 'acknowledged', value: 1 },\n    ];\n\n    this.problemAckFilters = [\n      'all triggers',\n      'unacknowledged',\n      'acknowledged'\n    ];\n\n    this.sortByFields = [\n      { text: 'Default', value: 'default' },\n      { text: 'Last change', value: 'lastchange' },\n      { text: 'Severity', value: 'severity' },\n    ];\n\n    this.showEventsFields = [\n      { text: 'All', value: [0, 1] },\n      { text: 'OK', value: [0] },\n      { text: 'Problems', value: 1 }\n    ];\n\n    this.showProblemsOptions = [\n      { text: 'Problems', value: 'problems' },\n      { text: 'Recent problems', value: 'recent' },\n      { text: 'History', value: 'history' },\n    ];\n\n    this.resultFormats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n\n    this.severityOptions = getSeverityOptions();\n\n    // Map functions for bs-typeahead\n    this.getGroupNames = _.bind(this.getMetricNames, this, 'groupList');\n    this.getHostNames = _.bind(this.getMetricNames, this, 'hostList', true);\n    this.getApplicationNames = _.bind(this.getMetricNames, this, 'appList');\n    this.getItemNames = _.bind(this.getMetricNames, this, 'itemList');\n    this.getITServices = _.bind(this.getMetricNames, this, 'itServiceList');\n    this.getProxyNames = _.bind(this.getMetricNames, this, 'proxyList');\n    this.getVariables = _.bind(this.getTemplateVariables, this);\n\n    // Update metric suggestion when template variable was changed\n    $rootScope.$on('template-variable-value-updated', () => this.onVariableChange());\n\n    // Update metrics when item selected from dropdown\n    $scope.$on('typeahead-updated', () => {\n      this.onTargetBlur();\n    });\n\n    this.init = () => {\n      let target = this.target;\n\n      // Migrate old targets\n      target = migrations.migrate(target);\n      this.refresh();\n\n      const scopeDefaults = {\n        metric: {},\n        oldTarget: _.cloneDeep(this.target),\n        queryOptionsText: this.renderQueryOptionsText()\n      };\n      _.defaults(this, scopeDefaults);\n\n      // Load default values\n      const targetDefaults = getTargetDefaults();\n      _.defaultsDeep(target, targetDefaults);\n      this.initDefaultQueryMode(target);\n\n      if (this.panel.type === c.ZABBIX_PROBLEMS_PANEL_ID) {\n        target.queryType = c.MODE_PROBLEMS;\n        target.options.severities = mapSeverityOptionsFromPanel(this.panel.triggerSeverity);\n      }\n\n      // Create function instances from saved JSON\n      target.functions = _.map(target.functions, func => {\n        return metricFunctions.createFuncInstance(func.def, func.params);\n      });\n\n      if (target.queryType === c.MODE_ITSERVICE) {\n        _.defaultsDeep(target, getSLATargetDefaults());\n      }\n\n      if (target.queryType === c.MODE_PROBLEMS) {\n        _.defaultsDeep(target, getProblemsTargetDefaults());\n      }\n\n      if (target.queryType === c.MODE_METRICS ||\n        target.queryType === c.MODE_TEXT ||\n        target.queryType === c.MODE_TRIGGERS ||\n        target.queryType === c.MODE_PROBLEMS) {\n        this.initFilters();\n      } else if (target.queryType === c.MODE_ITSERVICE) {\n        this.suggestITServices();\n      }\n    };\n\n    // Update panel schema version to prevent unnecessary migrations\n    if (this.panel.type === c.ZABBIX_PROBLEMS_PANEL_ID) {\n      this.panel.schemaVersion = CURRENT_SCHEMA_VERSION;\n    }\n\n    this.init();\n    this.queryOptionsText = this.renderQueryOptionsText();\n  }\n\n  initFilters() {\n    const mode = _.find(this.editorModes, { 'queryType': this.target.queryType });\n    const itemtype = mode ? mode.value : null;\n    const promises = [\n      this.suggestGroups(),\n      this.suggestHosts(),\n      this.suggestApps(),\n    ];\n\n    if (this.target.queryType === c.MODE_METRICS || this.target.queryType === c.MODE_TEXT) {\n      promises.push(this.suggestItems(itemtype));\n    }\n\n    if (this.target.queryType === c.MODE_PROBLEMS) {\n      promises.push(this.suggestProxies());\n    }\n\n    return Promise.all(promises).then(() => {\n      if (this.zabbix.isZabbix54OrHigher()) {\n        this.suggestItemTags()\n        .then(() => this.$scope.$apply());\n      }\n    });\n  }\n\n  initDefaultQueryMode(target) {\n    if (!(target.queryType === c.MODE_METRICS ||\n      target.queryType === c.MODE_TEXT ||\n      target.queryType === c.MODE_ITSERVICE ||\n      target.queryType === c.MODE_ITEMID ||\n      target.queryType === c.MODE_TRIGGERS ||\n      target.queryType === c.MODE_PROBLEMS)) {\n      target.queryType = c.MODE_METRICS;\n    }\n  }\n\n  // Get list of metric names for bs-typeahead directive\n  getMetricNames(metricList, addAllValue) {\n    const metrics = _.uniq(_.map(this.metric[metricList], 'name'));\n\n    // Add template variables\n    _.forEach(this.templateSrv.getVariables(), variable => {\n      metrics.unshift('$' + variable.name);\n    });\n\n    if (addAllValue) {\n      metrics.unshift('/.*/');\n    }\n\n    return metrics;\n  }\n\n  getItemTags = () => {\n    if (!this.metric?.tagList) {\n      return [];\n    }\n    const tags = this.metric.tagList.map(t => itemTagToString(t));\n\n    // Add template variables\n    _.forEach(this.templateSrv.getVariables(), variable => {\n      tags.unshift('$' + variable.name);\n    });\n\n    return tags;\n  };\n\n  getTemplateVariables() {\n    return _.map(this.templateSrv.getVariables(), variable => {\n      return '$' + variable.name;\n    });\n  }\n\n  isZabbix54OrHigher() {\n    return this.zabbix.isZabbix54OrHigher();\n  }\n\n  suggestGroups() {\n    return this.zabbix.getAllGroups()\n    .then(groups => {\n      this.metric.groupList = groups;\n      return groups;\n    });\n  }\n\n  suggestHosts() {\n    const groupFilter = this.replaceTemplateVars(this.target.group.filter);\n    return this.zabbix.getAllHosts(groupFilter)\n    .then(hosts => {\n      this.metric.hostList = hosts;\n      return hosts;\n    });\n  }\n\n  suggestApps() {\n    const groupFilter = this.replaceTemplateVars(this.target.group.filter);\n    const hostFilter = this.replaceTemplateVars(this.target.host.filter);\n    return this.zabbix.getAllApps(groupFilter, hostFilter)\n    .then(apps => {\n      this.metric.appList = apps;\n      return apps;\n    });\n  }\n\n  suggestItems(itemtype = 'num') {\n    const groupFilter = this.replaceTemplateVars(this.target.group.filter);\n    const hostFilter = this.replaceTemplateVars(this.target.host.filter);\n    const appFilter = this.replaceTemplateVars(this.target.application.filter);\n    const itemTagFilter = this.replaceTemplateVars(this.target.itemTag.filter);\n    const options = {\n      itemtype: itemtype,\n      showDisabledItems: this.target.options.showDisabledItems\n    };\n\n    return this.zabbix\n    .getAllItems(groupFilter, hostFilter, appFilter, itemTagFilter, options)\n    .then(items => {\n      this.metric.itemList = items;\n      return items;\n    });\n  }\n\n  async suggestItemTags() {\n    const groupFilter = this.replaceTemplateVars(this.target.group.filter);\n    const hostFilter = this.replaceTemplateVars(this.target.host.filter);\n    const items = await this.zabbix.getAllItems(groupFilter, hostFilter, null, null, {});\n    const tags: ZBXItemTag[] = _.flatten(items.map((item: ZBXItem) => {\n      if (item.tags) {\n        return item.tags;\n      } else {\n        return [];\n      }\n    }));\n    this.metric.tagList = _.uniqBy(tags, t => t.tag + t.value || '');\n  }\n\n  suggestITServices() {\n    return this.zabbix.getITService()\n    .then(itservices => {\n      this.metric.itServiceList = itservices;\n      return itservices;\n    });\n  }\n\n  suggestProxies() {\n    return this.zabbix.getProxies()\n    .then(response => {\n      const proxies = _.map(response, 'host');\n      this.metric.proxyList = proxies;\n      return proxies;\n    });\n  }\n\n  isRegex(str) {\n    return utils.isRegex(str);\n  }\n\n  isVariable(str) {\n    return utils.isTemplateVariable(str, this.templateSrv.getVariables());\n  }\n\n  onTargetBlur() {\n    const newTarget = _.cloneDeep(this.target);\n    if (!_.isEqual(this.oldTarget, this.target)) {\n      this.oldTarget = newTarget;\n      this.targetChanged();\n    }\n  }\n\n  onVariableChange() {\n    if (this.isContainsVariables()) {\n      this.targetChanged();\n    }\n  }\n\n  /**\n   * Check query for template variables\n   */\n  isContainsVariables() {\n    return _.some(['group', 'host', 'application'], field => {\n      if (this.target[field] && this.target[field].filter) {\n        return utils.isTemplateVariable(this.target[field].filter, this.templateSrv.getVariables());\n      } else {\n        return false;\n      }\n    });\n  }\n\n  parseTarget() {\n    // Parse target\n  }\n\n  // Validate target and set validation info\n  validateTarget() {\n    // validate\n  }\n\n  targetChanged() {\n    this.initFilters();\n    this.parseTarget();\n    this.refresh();\n  }\n\n  addFunction(funcDef) {\n    const newFunc = metricFunctions.createFuncInstance(funcDef);\n    newFunc.added = true;\n    this.target.functions.push(newFunc);\n\n    this.moveAliasFuncLast();\n\n    if (newFunc.params.length && newFunc.added ||\n      newFunc.def.params.length === 0) {\n      this.targetChanged();\n    }\n  }\n\n  removeFunction(func) {\n    this.target.functions = _.without(this.target.functions, func);\n    this.targetChanged();\n  }\n\n  moveFunction(func, offset) {\n    const index = this.target.functions.indexOf(func);\n    // @ts-ignore\n    _.move(this.target.functions, index, index + offset);\n    this.targetChanged();\n  }\n\n  moveAliasFuncLast() {\n    const aliasFunc = _.find(this.target.functions, func => {\n      return func.def.category === 'Alias';\n    });\n\n    if (aliasFunc) {\n      this.target.functions = _.without(this.target.functions, aliasFunc);\n      this.target.functions.push(aliasFunc);\n    }\n  }\n\n  toggleQueryOptions() {\n    this.showQueryOptions = !this.showQueryOptions;\n  }\n\n  onQueryOptionChange() {\n    this.queryOptionsText = this.renderQueryOptionsText();\n    this.onTargetBlur();\n  }\n\n  renderQueryOptionsText() {\n    const metricOptionsMap = {\n      showDisabledItems: \"Show disabled items\",\n      disableDataAlignment: \"Disable data alignment\",\n      useZabbixValueMapping: \"Use Zabbix value mapping\",\n    };\n\n    const problemsOptionsMap = {\n      sortProblems: \"Sort problems\",\n      acknowledged: \"Acknowledged\",\n      skipEmptyValues: \"Skip empty values\",\n      hostsInMaintenance: \"Show hosts in maintenance\",\n      limit: \"Limit problems\",\n      hostProxy: \"Show proxy\",\n      useTimeRange: \"Use time range\",\n    };\n\n    let optionsMap = {};\n\n    if (this.target.queryType === c.MODE_METRICS) {\n      optionsMap = metricOptionsMap;\n    } else if (this.target.queryType === c.MODE_PROBLEMS || this.target.queryType === c.MODE_TRIGGERS) {\n      optionsMap = problemsOptionsMap;\n    }\n\n    const options = [];\n    _.forOwn(this.target.options, (value, key) => {\n      if (value && optionsMap[key]) {\n        if (value === true) {\n          // Show only option name (if enabled) for boolean options\n          options.push(optionsMap[key]);\n        } else {\n          // Show \"option = value\" for another options\n          let optionValue = value;\n          if (value && value.text) {\n            optionValue = value.text;\n          } else if (value && value.value) {\n            optionValue = value.value;\n          }\n          options.push(optionsMap[key] + \" = \" + optionValue);\n        }\n      }\n    });\n    return \"Options: \" + options.join(', ');\n  }\n\n  /**\n   * Switch query editor to specified mode.\n   * Modes:\n   *  0 - items\n   *  1 - IT services\n   *  2 - Text metrics\n   */\n  switchEditorMode(mode) {\n    this.target.queryType = mode;\n    this.queryOptionsText = this.renderQueryOptionsText();\n    this.init();\n    this.targetChanged();\n  }\n\n  appFilterDisabled() {\n    return !this.zabbix.supportsApplications();\n  }\n}\n","import React, { FC } from 'react';\nimport { css, cx } from '@emotion/css';\nimport { EventsWithValidation, ValidationEvents, useTheme } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\nimport { isRegex, variableRegex } from '../utils';\n\nimport * as grafanaUi from '@grafana/ui';\nconst Input = (grafanaUi as any).LegacyForms?.Input || (grafanaUi as any).Input;\n\nconst variablePattern = RegExp(`^${variableRegex.source}`);\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  inputRegex: css`\n    color: ${theme.palette.orange}\n  `,\n  inputVariable: css`\n    color: ${theme.colors.textBlue}\n  `,\n});\n\nconst zabbixInputValidationEvents: ValidationEvents = {\n  [EventsWithValidation.onBlur]: [\n    {\n      rule: value => {\n        if (!value) {\n          return true;\n        }\n        if (value.length > 1 && value[0] === '/') {\n          if (value[value.length - 1] !== '/') {\n            return false;\n          }\n        }\n        return true;\n      },\n      errorMessage: 'Not a valid regex',\n    },\n    {\n      rule: value => {\n        if (value === '*') {\n          return false;\n        }\n        return true;\n      },\n      errorMessage: 'Wildcards not supported. Use /.*/ instead',\n    },\n  ],\n};\n\nexport const ZabbixInput: FC<any> = ({ value, ref, validationEvents, ...restProps }) => {\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  let inputClass = styles.inputRegex;\n  if (variablePattern.test(value as string)) {\n    inputClass = styles.inputVariable;\n  } else if (isRegex(value)) {\n    inputClass = styles.inputRegex;\n  }\n\n  return (\n    <Input\n      className={inputClass}\n      value={value}\n      validationEvents={zabbixInputValidationEvents}\n      {...restProps}\n    />\n  );\n};\n","import React, { PureComponent } from 'react';\nimport { parseLegacyVariableQuery } from '../utils';\nimport { SelectableValue } from '@grafana/data';\nimport { VariableQuery, VariableQueryData, VariableQueryProps, VariableQueryTypes } from '../types';\nimport { ZabbixInput } from './ZabbixInput';\nimport { InlineFormLabel, Input, Select } from '@grafana/ui';\n\nexport class ZabbixVariableQueryEditor extends PureComponent<VariableQueryProps, VariableQueryData> {\n  queryTypes: Array<SelectableValue<VariableQueryTypes>> = [\n    { value: VariableQueryTypes.Group, label: 'Group' },\n    { value: VariableQueryTypes.Host, label: 'Host' },\n    { value: VariableQueryTypes.Application, label: 'Application' },\n    { value: VariableQueryTypes.ItemTag, label: 'Item tag' },\n    { value: VariableQueryTypes.Item, label: 'Item' },\n    { value: VariableQueryTypes.ItemValues, label: 'Item values' },\n  ];\n\n  defaults: VariableQueryData = {\n    selectedQueryType: { value: VariableQueryTypes.Group, label: 'Group' },\n    queryType: VariableQueryTypes.Group,\n    group: '/.*/',\n    host: '',\n    application: '',\n    itemTag: '',\n    item: '',\n  };\n\n  constructor(props: VariableQueryProps) {\n    super(props);\n\n    if (this.props.query && typeof this.props.query === 'string') {\n      // Backward compatibility\n      const query = parseLegacyVariableQuery(this.props.query);\n      const selectedQueryType = this.getSelectedQueryType(query.queryType);\n      this.state = {\n        selectedQueryType,\n        legacyQuery: this.props.query,\n        ...query\n      };\n    } else if (this.props.query) {\n      const query = (this.props.query as VariableQuery);\n      const selectedQueryType = this.getSelectedQueryType(query.queryType);\n      this.state = {\n        ...this.defaults,\n        ...query,\n        selectedQueryType,\n      };\n    } else {\n      this.state = this.defaults;\n    }\n  }\n\n  getSelectedQueryType(queryType: VariableQueryTypes) {\n    return this.queryTypes.find(q => q.value === queryType);\n  }\n\n  handleQueryUpdate = (evt: React.ChangeEvent<HTMLInputElement>, prop: string) => {\n    const value = evt.currentTarget.value;\n    this.setState((prevState: VariableQueryData) => {\n      const newQuery = {\n        ...prevState,\n      };\n      newQuery[prop] = value;\n\n      return {\n        ...newQuery,\n      };\n    });\n  };\n\n  handleQueryChange = () => {\n    const { queryType, group, host, application, itemTag, item } = this.state;\n    const queryModel = { queryType, group, host, application, itemTag, item };\n    this.props.onChange(queryModel, `Zabbix - ${queryType}`);\n  };\n\n  handleQueryTypeChange = (selectedItem: SelectableValue<VariableQueryTypes>) => {\n    this.setState({\n      ...this.state,\n      selectedQueryType: selectedItem,\n      queryType: selectedItem.value,\n    });\n\n    const { group, host, application, itemTag, item } = this.state;\n    const queryType = selectedItem.value;\n    const queryModel = { queryType, group, host, application, itemTag, item };\n    this.props.onChange(queryModel, `Zabbix - ${queryType}`);\n  };\n\n  render() {\n    const { selectedQueryType, legacyQuery, group, host, application, itemTag, item } = this.state;\n    const { datasource } = this.props;\n    const supportsItemTags = datasource?.zabbix?.isZabbix54OrHigher() || false;\n\n    return (\n      <>\n        <div className=\"gf-form max-width-21\">\n          <InlineFormLabel width={10}>Query Type</InlineFormLabel>\n          <Select\n            width={11}\n            value={selectedQueryType}\n            options={this.queryTypes}\n            onChange={this.handleQueryTypeChange}\n          />\n        </div>\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form max-width-30\">\n            <InlineFormLabel width={10}>Group</InlineFormLabel>\n            <ZabbixInput\n              value={group}\n              onChange={evt => this.handleQueryUpdate(evt, 'group')}\n              onBlur={this.handleQueryChange}\n            />\n          </div>\n          {selectedQueryType.value !== VariableQueryTypes.Group &&\n          <div className=\"gf-form max-width-30\">\n            <InlineFormLabel width={10}>Host</InlineFormLabel>\n            <ZabbixInput\n              value={host}\n              onChange={evt => this.handleQueryUpdate(evt, 'host')}\n              onBlur={this.handleQueryChange}\n            />\n          </div>\n          }\n        </div>\n        {(selectedQueryType.value === VariableQueryTypes.Application ||\n          selectedQueryType.value === VariableQueryTypes.ItemTag ||\n          selectedQueryType.value === VariableQueryTypes.Item ||\n          selectedQueryType.value === VariableQueryTypes.ItemValues) &&\n        <div className=\"gf-form-inline\">\n          {supportsItemTags && (\n            <div className=\"gf-form max-width-30\">\n              <InlineFormLabel width={10}>Item tag</InlineFormLabel>\n              <ZabbixInput\n                value={itemTag}\n                onChange={evt => this.handleQueryUpdate(evt, 'itemTag')}\n                onBlur={this.handleQueryChange}\n              />\n            </div>\n          )}\n          {!supportsItemTags && (\n            <div className=\"gf-form max-width-30\">\n              <InlineFormLabel width={10}>Application</InlineFormLabel>\n              <ZabbixInput\n                value={application}\n                onChange={evt => this.handleQueryUpdate(evt, 'application')}\n                onBlur={this.handleQueryChange}\n              />\n            </div>\n          )}\n          {(selectedQueryType.value === VariableQueryTypes.Item ||\n            selectedQueryType.value === VariableQueryTypes.ItemValues) &&\n          <div className=\"gf-form max-width-30\">\n            <InlineFormLabel width={10}>Item</InlineFormLabel>\n            <ZabbixInput\n              value={item}\n              onChange={evt => this.handleQueryUpdate(evt, 'item')}\n              onBlur={this.handleQueryChange}\n            />\n          </div>\n          }\n        </div>\n        }\n\n        {legacyQuery &&\n        <div className=\"gf-form\">\n          <InlineFormLabel width={10} tooltip=\"Original query string, read-only\">Legacy Query</InlineFormLabel>\n          <Input\n            css=\"\"\n            value={legacyQuery}\n            readOnly={true}\n          />\n        </div>\n        }\n      </>\n    );\n  }\n}\n","import React, { useEffect, useState } from 'react';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { DataSourcePluginOptionsEditorProps, DataSourceSettings, SelectableValue } from '@grafana/data';\nimport { Button, DataSourceHttpSettings, InlineFormLabel, LegacyForms, Select } from '@grafana/ui';\nimport { ZabbixDSOptions, ZabbixSecureJSONData } from '../types';\n\nconst { FormField, Switch } = LegacyForms;\n\nconst SUPPORTED_SQL_DS = ['mysql', 'postgres', 'influxdb'];\n\nexport type Props = DataSourcePluginOptionsEditorProps<ZabbixDSOptions, ZabbixSecureJSONData>;\nexport const ConfigEditor = (props: Props) => {\n  const { options, onOptionsChange } = props;\n\n  const [selectedDBDatasource, setSelectedDBDatasource] = useState(null);\n  const [currentDSType, setCurrentDSType] = useState('');\n\n  // Apply some defaults on initial render\n  useEffect(() => {\n    const { jsonData, secureJsonFields } = options;\n\n    // Set secureJsonFields.password to password and then remove it from config\n    const { password, ...restJsonData } = jsonData;\n    if (!secureJsonFields?.password) {\n      if (!options.secureJsonData) {\n        options.secureJsonData = {};\n      }\n      options.secureJsonData.password = password;\n    }\n\n    onOptionsChange({\n      ...options,\n      jsonData: {\n        trends: true,\n        trendsFrom: '',\n        trendsRange: '',\n        cacheTTL: '',\n        timeout: undefined,\n        disableDataAlignment: false,\n        ...restJsonData,\n      },\n    });\n\n    if (options.jsonData.dbConnectionEnable) {\n      if (!options.jsonData.dbConnectionDatasourceId) {\n        const dsName = options.jsonData.dbConnectionDatasourceName;\n        getDataSourceSrv().get(dsName)\n        .then(ds => {\n          if (ds) {\n            const selectedDs = getDirectDBDatasources().find(dsOption => dsOption.id === ds.id);\n            setSelectedDBDatasource({ label: selectedDs.name, value: selectedDs.id });\n            setCurrentDSType(selectedDs.type);\n            onOptionsChange({\n              ...options,\n              jsonData: {\n                ...options.jsonData,\n                dbConnectionDatasourceId: ds.id,\n              },\n            });\n          }\n        });\n      } else {\n        const selectedDs = getDirectDBDatasources().find(dsOption => dsOption.id === options.jsonData.dbConnectionDatasourceId);\n        setSelectedDBDatasource({ label: selectedDs.name, value: selectedDs.id });\n        setCurrentDSType(selectedDs.type);\n      }\n    }\n  }, []);\n\n  return (\n    <>\n      <DataSourceHttpSettings\n        defaultUrl={'http://localhost/zabbix/api_jsonrpc.php'}\n        dataSourceConfig={options}\n        showAccessOptions={true}\n        onChange={onOptionsChange}\n      />\n\n      <div className=\"gf-form-group\">\n        <h3 className=\"page-heading\">Zabbix API details</h3>\n        <div className=\"gf-form max-width-25\">\n          <FormField\n            labelWidth={7}\n            inputWidth={15}\n            label=\"Username\"\n            value={options.jsonData.username || ''}\n            onChange={jsonDataChangeHandler('username', options, onOptionsChange)}\n            required\n          />\n        </div>\n        <div className=\"gf-form max-width-25\">\n          {options.secureJsonFields?.password ?\n            <>\n              <FormField\n                labelWidth={7}\n                inputWidth={15}\n                label=\"Password\"\n                disabled={true}\n                value=\"\"\n                placeholder=\"Configured\"\n              />\n              <Button onClick={resetSecureJsonField('password', options, onOptionsChange)}>Reset</Button>\n            </> :\n            <FormField\n              labelWidth={7}\n              inputWidth={15}\n              label=\"Password\"\n              type=\"password\"\n              value={options.secureJsonData?.password || options.jsonData.password || ''}\n              onChange={secureJsonDataChangeHandler('password', options, onOptionsChange)}\n              required\n            />\n          }\n        </div>\n        <Switch\n          label=\"Trends\"\n          labelClass=\"width-7\"\n          checked={options.jsonData.trends}\n          onChange={jsonDataSwitchHandler('trends', options, onOptionsChange)}\n        />\n        {options.jsonData.trends &&\n        <>\n          <div className=\"gf-form\">\n            <FormField\n              labelWidth={7}\n              inputWidth={4}\n              label=\"After\"\n              value={options.jsonData.trendsFrom || ''}\n              placeholder=\"7d\"\n              onChange={jsonDataChangeHandler('trendsFrom', options, onOptionsChange)}\n              tooltip=\"Time after which trends will be used.\n                  Best practice is to set this value to your history storage period (7d, 30d, etc).\"\n            />\n          </div>\n          <div className=\"gf-form\">\n            <FormField\n              labelWidth={7}\n              inputWidth={4}\n              label=\"Range\"\n              value={options.jsonData.trendsRange || ''}\n              placeholder=\"4d\"\n              onChange={jsonDataChangeHandler('trendsRange', options, onOptionsChange)}\n              tooltip=\"Time range width after which trends will be used instead of history.\n                  It's better to set this value in range of 4 to 7 days to prevent loading large amount of history data.\"\n            />\n          </div>\n        </>\n        }\n        <div className=\"gf-form\">\n          <FormField\n            labelWidth={7}\n            inputWidth={4}\n            label=\"Cache TTL\"\n            value={options.jsonData.cacheTTL || ''}\n            placeholder=\"1h\"\n            onChange={jsonDataChangeHandler('cacheTTL', options, onOptionsChange)}\n            tooltip=\"Zabbix data source caches metric names in memory. Specify how often data will be updated.\"\n          />\n        </div>\n        <div className=\"gf-form\">\n          <FormField\n            labelWidth={7}\n            inputWidth={4}\n            type=\"number\"\n            label=\"Timeout\"\n            value={options.jsonData.timeout}\n            onChange={(event) => {\n              onOptionsChange({\n                ...options,\n                jsonData: { ...options.jsonData, timeout: parseInt(event.currentTarget.value, 10) },\n              });\n            }}\n            tooltip=\"Zabbix API connection timeout in seconds. Default is 30.\"\n          />\n        </div>\n      </div>\n\n      <div className=\"gf-form-group\">\n        <h3 className=\"page-heading\">Direct DB Connection</h3>\n        <Switch\n          label=\"Enable\"\n          labelClass=\"width-9\"\n          checked={options.jsonData.dbConnectionEnable}\n          onChange={jsonDataSwitchHandler('dbConnectionEnable', options, onOptionsChange)}\n        />\n        {options.jsonData.dbConnectionEnable &&\n        <>\n          <div className=\"gf-form\">\n            <InlineFormLabel width={9}>Data Source</InlineFormLabel>\n            <Select\n              width={32}\n              options={getDirectDBDSOptions()}\n              value={selectedDBDatasource}\n              onChange={directDBDatasourceChanegeHandler(options, onOptionsChange, setSelectedDBDatasource, setCurrentDSType)}\n            />\n          </div>\n          {currentDSType === 'influxdb' &&\n          <div className=\"gf-form\">\n            <FormField\n              labelWidth={9}\n              inputWidth={16}\n              label=\"Retention Policy\"\n              value={options.jsonData.dbConnectionRetentionPolicy || ''}\n              placeholder=\"Retention policy name\"\n              onChange={jsonDataChangeHandler('dbConnectionRetentionPolicy', options, onOptionsChange)}\n              tooltip=\"Specify retention policy name for fetching long-term stored data (optional).\n                    Leave it blank if only default retention policy used.\"\n            />\n          </div>\n          }\n        </>\n        }\n      </div>\n\n      <div className=\"gf-form-group\">\n        <h3 className=\"page-heading\">Other</h3>\n        <Switch\n          label=\"Disable acknowledges for read-only users\"\n          labelClass=\"width-16\"\n          checked={options.jsonData.disableReadOnlyUsersAck}\n          onChange={jsonDataSwitchHandler('disableReadOnlyUsersAck', options, onOptionsChange)}\n        />\n        <Switch\n          label=\"Disable data alignment\"\n          labelClass=\"width-16\"\n          checked={!!options.jsonData.disableDataAlignment}\n          onChange={jsonDataSwitchHandler('disableDataAlignment', options, onOptionsChange)}\n          tooltip=\"Data alignment feature aligns points based on item update interval.\n            For instance, if value collected once per minute, then timestamp of the each point will be set to the start of corresponding minute.\n            This alignment required for proper work of the stacked graphs.\n            If you don't need stacked graphs and want to get exactly the same timestamps as in Zabbix, then you can disable this feature.\"\n        />\n      </div>\n    </>\n  );\n};\n\nconst jsonDataChangeHandler = (\n  key: keyof ZabbixDSOptions,\n  value: DataSourceSettings<ZabbixDSOptions, ZabbixSecureJSONData>,\n  onChange: Props['onOptionsChange']\n) => (\n  event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>\n) => {\n  onChange({\n    ...value,\n    jsonData: {\n      ...value.jsonData,\n      [key]: event.currentTarget.value,\n    },\n  });\n};\n\nconst jsonDataSwitchHandler = (\n  key: keyof ZabbixDSOptions,\n  value: DataSourceSettings<ZabbixDSOptions, ZabbixSecureJSONData>,\n  onChange: Props['onOptionsChange']\n) => (\n  event: React.SyntheticEvent<HTMLInputElement>\n) => {\n  onChange({\n    ...value,\n    jsonData: {\n      ...value.jsonData,\n      [key]: (event.target as HTMLInputElement).checked,\n    },\n  });\n};\n\nconst secureJsonDataChangeHandler = (\n  key: keyof ZabbixDSOptions,\n  value: DataSourceSettings<ZabbixDSOptions, ZabbixSecureJSONData>,\n  onChange: Props['onOptionsChange']\n) => (\n  event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>\n) => {\n  onChange({\n    ...value,\n    secureJsonData: {\n      ...value.secureJsonData,\n      [key]: event.currentTarget.value,\n    },\n  });\n};\n\nconst resetSecureJsonField = (\n  key: keyof ZabbixDSOptions,\n  value: DataSourceSettings<ZabbixDSOptions, ZabbixSecureJSONData>,\n  onChange: Props['onOptionsChange']\n) => (\n  event: React.SyntheticEvent<HTMLButtonElement>\n) => {\n  onChange({\n    ...value,\n    secureJsonFields: {\n      ...value.secureJsonFields,\n      [key]: false,\n    },\n  });\n};\n\nconst directDBDatasourceChanegeHandler = (\n  options: DataSourceSettings<ZabbixDSOptions, ZabbixSecureJSONData>,\n  onChange: Props['onOptionsChange'],\n  setSelectedDS: React.Dispatch<any>,\n  setSelectedDSType: React.Dispatch<any>,\n) => (\n  value: SelectableValue<number>\n) => {\n  const selectedDs = getDirectDBDatasources().find(dsOption => dsOption.id === value.value);\n  setSelectedDS({ label: selectedDs.name, value: selectedDs.id });\n  setSelectedDSType(selectedDs.type);\n  onChange({\n    ...options,\n    jsonData: {\n      ...options.jsonData,\n      dbConnectionDatasourceId: value.value\n    },\n  });\n};\n\nconst getDirectDBDatasources = () => {\n  let dsList = (getDataSourceSrv() as any).getAll();\n  dsList = dsList.filter(ds => SUPPORTED_SQL_DS.includes(ds.type));\n  return dsList;\n};\n\nconst getDirectDBDSOptions = () => {\n  const dsList = getDirectDBDatasources();\n  const dsOpts: Array<SelectableValue<number>> = dsList.map(ds => ({ label: ds.name, value: ds.id, description: ds.type }));\n  return dsOpts;\n};\n","import angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport * as metricFunctions from './metricFunctions';\n\nangular\n  .module('grafana.directives')\n  .directive('addMetricFunction',\n\n  /** @ngInject */\n  function($compile) {\n    var inputTemplate = '<input type=\"text\"'+\n                          ' class=\"gf-form-input\"' +\n                          ' spellcheck=\"false\" style=\"display:none\"></input>';\n\n    var buttonTemplate = '<a  class=\"gf-form-label tight-form-func dropdown-toggle query-part\"' +\n                            ' tabindex=\"1\" gf-dropdown=\"functionMenu\" data-toggle=\"dropdown\">' +\n                            '<i class=\"fa fa-plus\"></i></a>';\n\n    return {\n      link: function($scope, elem) {\n        var categories = metricFunctions.getCategories();\n        var allFunctions = getAllFunctionNames(categories);\n\n        $scope.functionMenu = createFunctionDropDownMenu(categories);\n\n        var $input = $(inputTemplate);\n        var $button = $(buttonTemplate);\n        $input.appendTo(elem);\n        $button.appendTo(elem);\n\n        $input.attr('data-provide', 'typeahead');\n        $input.typeahead({\n          source: allFunctions,\n          minLength: 1,\n          items: 10,\n          updater: function (value) {\n            var funcDef = metricFunctions.getFuncDef(value);\n            if (!funcDef) {\n              // try find close match\n              value = value.toLowerCase();\n              funcDef = _.find(allFunctions, function(funcName) {\n                return funcName.toLowerCase().indexOf(value) === 0;\n              });\n\n              if (!funcDef) { return; }\n            }\n\n            $scope.$apply(function() {\n              $scope.ctrl.addFunction(funcDef);\n            });\n\n            $input.trigger('blur');\n            return '';\n          }\n        });\n\n        $button.click(function() {\n          $button.hide();\n          $input.show();\n          $input.focus();\n        });\n\n        $input.keyup(function() {\n          elem.toggleClass('open', $input.val() === '');\n        });\n\n        $input.blur(function() {\n          // clicking the function dropdown menu won't\n          // work if you remove class at once\n          setTimeout(function() {\n            $input.val('');\n            $input.hide();\n            $button.show();\n            elem.removeClass('open');\n          }, 200);\n        });\n\n        $compile(elem.contents())($scope);\n      }\n    };\n  });\n\nfunction getAllFunctionNames(categories) {\n  return _.reduce(categories, function(list, category) {\n    _.each(category, function(func) {\n      list.push(func.name);\n    });\n    return list;\n  }, []);\n}\n\nfunction createFunctionDropDownMenu(categories) {\n  return _.map(categories, function(list, category) {\n    return {\n      text: category,\n      submenu: _.map(list, function(value) {\n        return {\n          text: value.name,\n          click: \"ctrl.addFunction('\" + value.name + \"')\",\n        };\n      })\n    };\n  });\n}\n\n","import React from 'react';\n\nconst DOCS_FUNC_REF_URL = 'https://alexanderzobnin.github.io/grafana-zabbix/reference/functions/';\n\nexport interface FunctionDescriptor {\n  text: string;\n  params: string[];\n  def: {\n    category: string;\n    defaultParams: string[];\n    description?: string;\n    fake: boolean;\n    name: string;\n    params: string[];\n  };\n}\n\nexport interface FunctionEditorControlsProps {\n  onMoveLeft: (func: FunctionDescriptor) => void;\n  onMoveRight: (func: FunctionDescriptor) => void;\n  onRemove: (func: FunctionDescriptor) => void;\n}\n\nconst FunctionHelpButton = (props: { description: string; name: string; onDescriptionShow: () => void }) => {\n  if (props.description) {\n    return <span className=\"pointer fa fa-question-circle\" onClick={props.onDescriptionShow} />;\n  }\n\n  return (\n    <span\n      className=\"pointer fa fa-question-circle\"\n      onClick={() => {\n        window.open(\n          DOCS_FUNC_REF_URL + '#' + props.name,\n          '_blank'\n        );\n      }}\n    />\n  );\n};\n\nexport const FunctionEditorControls = (\n  props: FunctionEditorControlsProps & {\n    func: FunctionDescriptor;\n    onDescriptionShow: () => void;\n  }\n) => {\n  const { func, onMoveLeft, onMoveRight, onRemove, onDescriptionShow } = props;\n  return (\n    <div\n      style={{\n        display: 'flex',\n        width: '60px',\n        justifyContent: 'space-between',\n      }}\n    >\n      <span className=\"pointer fa fa-arrow-left\" onClick={() => onMoveLeft(func)} />\n      <FunctionHelpButton\n        name={func.def.name}\n        description={func.def.description}\n        onDescriptionShow={onDescriptionShow}\n      />\n      <span className=\"pointer fa fa-remove\" onClick={() => onRemove(func)} />\n      <span className=\"pointer fa fa-arrow-right\" onClick={() => onMoveRight(func)} />\n    </div>\n  );\n};\n","import React from 'react';\n// import rst2html from 'rst2html';\nimport { FunctionDescriptor, FunctionEditorControlsProps, FunctionEditorControls } from './FunctionEditorControls';\n\n// @ts-ignore\nimport { PopoverController, Popover } from '@grafana/ui';\n\ninterface FunctionEditorProps extends FunctionEditorControlsProps {\n  func: FunctionDescriptor;\n}\n\ninterface FunctionEditorState {\n  showingDescription: boolean;\n}\n\nclass FunctionEditor extends React.PureComponent<FunctionEditorProps, FunctionEditorState> {\n  private triggerRef = React.createRef<HTMLSpanElement>();\n\n  constructor(props: FunctionEditorProps) {\n    super(props);\n\n    this.state = {\n      showingDescription: false,\n    };\n  }\n\n  renderContent = ({ updatePopperPosition }) => {\n    const {\n      onMoveLeft,\n      onMoveRight,\n      func: {\n        def: { name, description },\n      },\n    } = this.props;\n    const { showingDescription } = this.state;\n\n    if (showingDescription) {\n      return (\n        <div style={{ overflow: 'auto', maxHeight: '30rem', textAlign: 'left', fontWeight: 'normal' }}>\n          <h4 style={{ color: 'white' }}> {name} </h4>\n          <div>{description}</div>\n        </div>\n      );\n    }\n\n    return (\n      <FunctionEditorControls\n        {...this.props}\n        onMoveLeft={() => {\n          onMoveLeft(this.props.func);\n          updatePopperPosition();\n        }}\n        onMoveRight={() => {\n          onMoveRight(this.props.func);\n          updatePopperPosition();\n        }}\n        onDescriptionShow={() => {\n          this.setState({ showingDescription: true }, () => {\n            updatePopperPosition();\n          });\n        }}\n      />\n    );\n  };\n\n  render() {\n    return (\n      <PopoverController content={this.renderContent} placement=\"top\" hideAfter={300}>\n        {(showPopper, hidePopper, popperProps) => {\n          return (\n            <>\n              {this.triggerRef && (\n                <Popover\n                  {...popperProps}\n                  referenceElement={this.triggerRef.current}\n                  wrapperClassName=\"popper\"\n                  className=\"popper__background\"\n                  onMouseLeave={() => {\n                    this.setState({ showingDescription: false });\n                    hidePopper();\n                  }}\n                  onMouseEnter={showPopper}\n                  renderArrow={({ arrowProps, placement }) => (\n                    <div className=\"popper__arrow\" data-placement={placement} {...arrowProps} />\n                  )}\n                />\n              )}\n\n              <span\n                ref={this.triggerRef}\n                onClick={popperProps.show ? hidePopper : showPopper}\n                onMouseLeave={() => {\n                  hidePopper();\n                  this.setState({ showingDescription: false });\n                }}\n                style={{ cursor: 'pointer' }}\n              >\n                {this.props.func.def.name}\n              </span>\n            </>\n          );\n        }}\n      </PopoverController>\n    );\n  }\n}\n\nexport { FunctionEditor };\n","import coreModule from 'grafana/app/core/core_module';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport { react2AngularDirective } from './react2angular';\nimport { FunctionEditor } from './components/FunctionEditor';\n\n/** @ngInject */\nexport function zabbixFunctionEditor($compile, templateSrv) {\n  const funcSpanTemplate = `\n    <zbx-function-editor\n      func=\"func\"\n      onRemove=\"ctrl.handleRemoveFunction\"\n      onMoveLeft=\"ctrl.handleMoveLeft\"\n      onMoveRight=\"ctrl.handleMoveRight\">\n    </zbx-function-editor>\n    <span>(</span>\n  `;\n  const paramTemplate =\n    '<input type=\"text\" style=\"display:none\"' + ' class=\"input-small tight-form-func-param\"></input>';\n\n  return {\n    restrict: 'A',\n    link: function postLink($scope, elem) {\n      const $funcLink = $(funcSpanTemplate);\n      const ctrl = $scope.ctrl;\n      const func = $scope.func;\n      let scheduledRelink = false;\n      let paramCountAtLink = 0;\n      let cancelBlur = null;\n\n      ctrl.handleRemoveFunction = func => {\n        ctrl.removeFunction(func);\n      };\n\n      ctrl.handleMoveLeft = func => {\n        ctrl.moveFunction(func, -1);\n      };\n\n      ctrl.handleMoveRight = func => {\n        ctrl.moveFunction(func, 1);\n      };\n\n      function clickFuncParam(this: any, paramIndex) {\n        /*jshint validthis:true */\n\n        const $link = $(this);\n        const $comma = $link.prev('.comma');\n        const $input = $link.next();\n\n        $input.val(func.params[paramIndex]);\n\n        $comma.removeClass('query-part__last');\n        $link.hide();\n        $input.show();\n        $input.focus();\n        $input.select();\n\n        const typeahead = $input.data('typeahead');\n        if (typeahead) {\n          $input.val('');\n          typeahead.lookup();\n        }\n      }\n\n      function scheduledRelinkIfNeeded() {\n        if (paramCountAtLink === func.params.length) {\n          return;\n        }\n\n        if (!scheduledRelink) {\n          scheduledRelink = true;\n          setTimeout(() => {\n            relink();\n            scheduledRelink = false;\n          }, 200);\n        }\n      }\n\n      function paramDef(index) {\n        if (index < func.def.params.length) {\n          return func.def.params[index];\n        }\n        if ((_.last(func.def.params) as any).multiple) {\n          return _.assign({}, _.last(func.def.params), { optional: true });\n        }\n        return {};\n      }\n\n      function switchToLink(inputElem, paramIndex) {\n        /*jshint validthis:true */\n        const $input = $(inputElem);\n\n        clearTimeout(cancelBlur);\n        cancelBlur = null;\n\n        const $link = $input.prev();\n        const $comma = $link.prev('.comma');\n        const newValue = $input.val();\n\n        // remove optional empty params\n        if (newValue !== '' || paramDef(paramIndex).optional) {\n          func.updateParam(newValue, paramIndex);\n          $link.html(newValue ? templateSrv.highlightVariablesAsHtml(newValue) : '&nbsp;');\n        }\n\n        scheduledRelinkIfNeeded();\n\n        $scope.$apply(() => {\n          ctrl.targetChanged();\n        });\n\n        if ($link.hasClass('query-part__last') && newValue === '') {\n          $comma.addClass('query-part__last');\n        } else {\n          $link.removeClass('query-part__last');\n        }\n\n        $input.hide();\n        $link.show();\n      }\n\n      // this = input element\n      function inputBlur(this: any, paramIndex) {\n        /*jshint validthis:true */\n        const inputElem = this;\n        // happens long before the click event on the typeahead options\n        // need to have long delay because the blur\n        cancelBlur = setTimeout(() => {\n          switchToLink(inputElem, paramIndex);\n        }, 200);\n      }\n\n      function inputKeyPress(this: any, paramIndex, e) {\n        /*jshint validthis:true */\n        if (e.which === 13) {\n          $(this).blur();\n        }\n      }\n\n      function inputKeyDown(this: any) {\n        /*jshint validthis:true */\n        this.style.width = (3 + this.value.length) * 8 + 'px';\n      }\n\n      function addTypeahead($input, paramIndex) {\n        $input.attr('data-provide', 'typeahead');\n\n        let options = paramDef(paramIndex).options;\n        if (paramDef(paramIndex).type === 'int' || paramDef(paramIndex).type === 'float') {\n          options = _.map(options, val => {\n            return val.toString();\n          });\n        }\n\n        $input.typeahead({\n          source: options,\n          minLength: 0,\n          items: 20,\n          updater: value => {\n            $input.val(value);\n            switchToLink($input[0], paramIndex);\n            return value;\n          },\n        });\n\n        const typeahead = $input.data('typeahead');\n        typeahead.lookup = function() {\n          this.query = this.$element.val() || '';\n          return this.process(this.source);\n        };\n      }\n\n      function addElementsAndCompile() {\n        $funcLink.appendTo(elem);\n\n        const defParams: any = _.clone(func.def.params);\n        const lastParam: any = _.last(func.def.params);\n\n        while (func.params.length >= defParams.length && lastParam && lastParam.multiple) {\n          defParams.push(_.assign({}, lastParam, { optional: true }));\n        }\n\n        _.each(defParams, (param: any, index: number) => {\n          if (param.optional && func.params.length < index) {\n            return false;\n          }\n\n          let paramValue = templateSrv.highlightVariablesAsHtml(func.params[index]);\n          const hasValue = paramValue !== null && paramValue !== undefined;\n\n          const last = index >= func.params.length - 1 && param.optional && !hasValue;\n          if (last && param.multiple) {\n            paramValue = '+';\n          }\n\n          if (index > 0) {\n            $('<span class=\"comma' + (last ? ' query-part__last' : '') + '\">,&nbsp; </span>').appendTo(elem);\n          }\n\n          const $paramLink = $(\n            '<a ng-click=\"\" class=\"graphite-func-param-link' +\n              (last ? ' query-part__last' : '') +\n              '\">' +\n              (hasValue ? paramValue : '&nbsp;') +\n              '</a>'\n          );\n          const $input = $(paramTemplate);\n          $input.attr('placeholder', param.name);\n\n          paramCountAtLink++;\n\n          $paramLink.appendTo(elem);\n          $input.appendTo(elem);\n\n          $input.blur(_.partial(inputBlur, index));\n          $input.keyup(inputKeyDown);\n          $input.keypress(_.partial(inputKeyPress, index));\n          $paramLink.click(_.partial(clickFuncParam, index));\n\n          if (param.options) {\n            addTypeahead($input, index);\n          }\n\n          return true;\n        });\n\n        $('<span>)</span>').appendTo(elem);\n\n        $compile(elem.contents())($scope);\n      }\n\n      function ifJustAddedFocusFirstParam() {\n        if ($scope.func.added) {\n          $scope.func.added = false;\n          setTimeout(() => {\n            elem\n              .find('.graphite-func-param-link')\n              .first()\n              .click();\n          }, 10);\n        }\n      }\n\n      function relink() {\n        elem.children().remove();\n        addElementsAndCompile();\n        ifJustAddedFocusFirstParam();\n      }\n\n      relink();\n    },\n  };\n}\n\ncoreModule.directive('zabbixFunctionEditor', zabbixFunctionEditor);\n\nreact2AngularDirective('zbxFunctionEditor', FunctionEditor, ['func', 'onRemove', 'onMoveLeft', 'onMoveRight']);\n","import coreModule from 'grafana/app/core/core_module';\n\nexport function react2AngularDirective(name: string, component: any, options: any) {\n  coreModule.directive(name, [\n    'reactDirective',\n    reactDirective => {\n      return reactDirective(component, options);\n    },\n  ]);\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { loadPluginCss } from '@grafana/runtime';\nimport { ZabbixDatasource } from './datasource';\nimport { ZabbixQueryController } from './query.controller';\nimport { ZabbixVariableQueryEditor } from './components/VariableQueryEditor';\nimport { ConfigEditor } from './components/ConfigEditor';\nimport './add-metric-function.directive';\nimport './metric-function-editor.directive';\n\nclass ZabbixAnnotationsQueryController {\n  static templateUrl = 'datasource-zabbix/partials/annotations.editor.html';\n}\n\nZabbixQueryController.templateUrl = 'datasource-zabbix/partials/query.editor.html';\n\nloadPluginCss({\n  dark: 'plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.dark.css',\n  light: 'plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.light.css'\n});\n\nexport const plugin = new DataSourcePlugin(ZabbixDatasource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryCtrl(ZabbixQueryController)\n  .setAnnotationQueryCtrl(ZabbixAnnotationsQueryController)\n  .setVariableQueryEditor(ZabbixVariableQueryEditor);\n"],"sourceRoot":""}